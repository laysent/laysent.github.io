<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[LaySent's Blog]]></title><description><![CDATA[Site where LaySent writes thoughts.]]></description><link>https://laysent.github.io/</link><generator>RSS for Node</generator><lastBuildDate>Tue, 20 Aug 2019 15:44:33 GMT</lastBuildDate><item><title><![CDATA[Inspect Element after MouseEnter]]></title><link>https://laysent.github.io/til/2019/08#2019-08-20</link><guid isPermaLink="false">https://laysent.github.io/til/2019/08#2019-08-20</guid><pubDate>Tue, 20 Aug 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;在前端组件中，有不少组件对鼠标的响应并不是通过 CSS 的 hover 来触发的，而是通过 JavaScript 监听对应的鼠标事件，然后再进一步修改 DOM 的结构。比如，Ant Design 中的 &lt;a href=&quot;https://ant.design/components/popover/&quot;&gt;Popover&lt;/a&gt; 控件，在鼠标移上去后，会在 DOM 中插入一组元素，并在鼠标移开后删除。&lt;/p&gt;
&lt;p&gt;在这种情况下，一旦出现样式上的问题，就不容易在 DevTool 中对样式进行查看了。因为只要一点击右键审查元素，Popover 的内容很可能就会因为触发了鼠标事件而消失不见。&lt;/p&gt;
&lt;p&gt;对于这种情况，没法直接用 DevTool 中的 CSS 模拟来强制样式显示。如果需要通过触发事件来触发 DOM 的修改机制（不论是 &lt;code class=&quot;language-text&quot;&gt;dispatchEvent&lt;/code&gt; 还是在 React Extension 中触发回调），总体上是比较麻烦的。因为组件的层级结构很可能很复杂，知道应该往哪儿触发什么事件，也不是个容易的事情。&lt;/p&gt;
&lt;p&gt;既然从程序的角度触发比较复杂，不如换个思路，考虑从行为的角度来触发。比如，如果是通过鼠标悬停触发的样式修改，那么就直接通过这种行为来触发。唯一的问题是：应该如何保持这种样式，不在鼠标离开的时候被重制（否则就没法在 DevTool 里进行查看了）。&lt;/p&gt;
&lt;p&gt;这种时候，有一个简单的方法可以“暂停”浏览器。在 Console 中输入：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token function&quot;&gt;setTimeout&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;debugger&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;就会在三秒后触发 &lt;code class=&quot;language-text&quot;&gt;debugger&lt;/code&gt;，从而暂停 JavaScript 的执行。这时候，鼠标离开的事件不会得到响应，也就可以安心在 DevTool 中对样式进行仔细的查看和调整了。&lt;/p&gt;
&lt;p&gt;当然，这里触发 &lt;code class=&quot;language-text&quot;&gt;debugger&lt;/code&gt; 的方式可以根据实际情况来写。只要保证在 DOM 改变后触发 &lt;code class=&quot;language-text&quot;&gt;debugger&lt;/code&gt; 就可以了。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Overflow & InlineBlock]]></title><link>https://laysent.github.io/til/2019/08#2019-08-19</link><guid isPermaLink="false">https://laysent.github.io/til/2019/08#2019-08-19</guid><pubDate>Mon, 19 Aug 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;当 &lt;code class=&quot;language-text&quot;&gt;display: inline-block&lt;/code&gt; 和 &lt;code class=&quot;language-text&quot;&gt;overflow: hidden&lt;/code&gt; 一起使用的时候，会发现文字的显示比一般正常的情况要“高”一些。举个例子来说：&lt;/p&gt;
&lt;p&gt;&lt;span&gt;g&lt;span style=&quot;display:inline-block;overflow:hidden;color:#f54a45&quot;&gt;o&lt;/span&gt;od&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;上面的四个文字中，第一个 &lt;code class=&quot;language-text&quot;&gt;o&lt;/code&gt; 被设置为 &lt;code class=&quot;language-text&quot;&gt;display:inline-block&lt;/code&gt; 以及 &lt;code class=&quot;language-text&quot;&gt;overflow:hidden&lt;/code&gt;。最终的显示效果，第一个 &lt;code class=&quot;language-text&quot;&gt;o&lt;/code&gt; 的底部明显高于两边的 &lt;code class=&quot;language-text&quot;&gt;g&lt;/code&gt; 和 &lt;code class=&quot;language-text&quot;&gt;o&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;通过给第一个 &lt;code class=&quot;language-text&quot;&gt;o&lt;/code&gt; 和整行文字画上边框，不难发现，这个文字是整体被抬高了。&lt;/p&gt;
&lt;p&gt;&lt;span style=&quot;border:1px solid #007acc&quot;&gt;g&lt;span style=&quot;display:inline-block;overflow:hidden;color:#f54a45;border:1px solid #ffe564&quot;&gt;o&lt;/span&gt;od&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;在上面的例子中，&lt;code class=&quot;language-text&quot;&gt;inline-block&lt;/code&gt; 的高度是由 &lt;code class=&quot;language-text&quot;&gt;line-height&lt;/code&gt; 决定的，因而看上去会比 &lt;code class=&quot;language-text&quot;&gt;inline&lt;/code&gt; 情况时候的要高（&lt;code class=&quot;language-text&quot;&gt;inline&lt;/code&gt; 情况下 border 画出来的高度是固定的，由 &lt;code class=&quot;language-text&quot;&gt;font-family&lt;/code&gt; 和 &lt;code class=&quot;language-text&quot;&gt;font-size&lt;/code&gt; 决定）；同时，&lt;code class=&quot;language-text&quot;&gt;overflow:hidden&lt;/code&gt; 会让内容的底部和父元素的文字基线（baseline）持平，从而会让整体的显示结果更高（这一点从上面的显示中不难发现，其中 &lt;code class=&quot;language-text&quot;&gt;g&lt;/code&gt; 的部分有少量是低于基线显示的，可以看到也低于第一个 &lt;code class=&quot;language-text&quot;&gt;o&lt;/code&gt; 的底部区域）。&lt;/p&gt;
&lt;p&gt;因此，在这种情况下，&lt;code class=&quot;language-text&quot;&gt;line-height&lt;/code&gt; 越大，会看到这种情况下的文字越是高，高出来的空白区域主要是 &lt;code class=&quot;language-text&quot;&gt;line-height&lt;/code&gt; 本身比文字大的部分，以及对齐方式不同造成的差异距离。&lt;/p&gt;
&lt;p&gt;上述这种情况，想要正确的对齐，只需要修改垂直对齐的方式就可以了。设置 &lt;code class=&quot;language-text&quot;&gt;vertical-align:bottom&lt;/code&gt; 后的结果：&lt;/p&gt;
&lt;p&gt;&lt;span&gt;g&lt;span style=&quot;display:inline-block;overflow:hidden;color:#f54a45;vertical-align:bottom&quot;&gt;o&lt;/span&gt;od&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;符合预期。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Download in HTML]]></title><link>https://laysent.github.io/til/2019/08#2019-08-15</link><guid isPermaLink="false">https://laysent.github.io/til/2019/08#2019-08-15</guid><pubDate>Thu, 15 Aug 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;在 Web 中，如果希望点击一个链接可以进行下载的操作，有以下两种方案可供参考：&lt;/p&gt;
&lt;section&gt;&lt;h2&gt;后端的解决方案&lt;/h2&gt;&lt;p&gt;后端在返回 Response Header 的时候，可以通过指定 &lt;code class=&quot;language-text&quot;&gt;Content-Disposition&lt;/code&gt; 的值，来改变浏览器默认对链接的行为，从而达到让浏览器直接下载某一个资源的目的。这里，&lt;code class=&quot;language-text&quot;&gt;Content-Disposition&lt;/code&gt; 的第一个参数有两种值可写：&lt;code class=&quot;language-text&quot;&gt;inline&lt;/code&gt; 和 &lt;code class=&quot;language-text&quot;&gt;attachment&lt;/code&gt;。其中，&lt;code class=&quot;language-text&quot;&gt;inline&lt;/code&gt; 是默认的值，表示响应中的消息体会以页面的形式展示，而 &lt;code class=&quot;language-text&quot;&gt;attachment&lt;/code&gt; 则会将这个行为改成下载到本地。&lt;/p&gt;&lt;p&gt;设置成 &lt;code class=&quot;language-text&quot;&gt;attachment&lt;/code&gt; 之后，还可以进一步通过配置 &lt;code class=&quot;language-text&quot;&gt;filename&lt;/code&gt; 来指定下载文件的文件名。例子如下：&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Content-Disposition: attachment; filename=&amp;quot;example.jpg&amp;quot;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;如此设置之后，前端在访问到这个 URL 的时候，浏览器就会以 &lt;code class=&quot;language-text&quot;&gt;example.jpg&lt;/code&gt; 为文件名下载当前的资源了。&lt;/p&gt;&lt;p&gt;更多相关的介绍可以参考&lt;a href=&quot;https://juejin.im/post/5d521575f265da03ee6a4bda&quot;&gt;这篇文章&lt;/a&gt;。&lt;/p&gt;&lt;/section&gt;
&lt;section&gt;&lt;h2&gt;前端的解决方案&lt;/h2&gt;&lt;p&gt;除了后端的解决方案之外，前端也可以通过指定 &lt;code class=&quot;language-text&quot;&gt;a&lt;/code&gt; 标签中的 &lt;code class=&quot;language-text&quot;&gt;download&lt;/code&gt; 字段来下载文件。对于使用了 &lt;code class=&quot;language-text&quot;&gt;download&lt;/code&gt; 字段的 &lt;code class=&quot;language-text&quot;&gt;a&lt;/code&gt; 标签，点击后的默认行为将会有跳转浏览改成文件下载。&lt;code class=&quot;language-text&quot;&gt;download&lt;/code&gt; 属性可以跟一个文件名作为值，浏览器会将这个值作为下载文件的文件名来使用。&lt;/p&gt;&lt;p&gt;当然，前端的方案相对来说会有更多的限制，主要是以下几点：&lt;/p&gt;&lt;ol&gt;
&lt;li&gt;文件必须是同域的，对于跨域的资源，&lt;code class=&quot;language-text&quot;&gt;download&lt;/code&gt; 并不会直接触发下载功能，行为上会和在新窗口打开资源一致；&lt;/li&gt;
&lt;li&gt;如果后端在 &lt;code class=&quot;language-text&quot;&gt;Content-Disposition&lt;/code&gt; 指定了不同的文件名，那么会以后端指定的结果为准&lt;/li&gt;
&lt;li&gt;如果后端 &lt;code class=&quot;language-text&quot;&gt;Content-Disposition&lt;/code&gt; 设置为 &lt;code class=&quot;language-text&quot;&gt;inline&lt;/code&gt;，不同的浏览器会有不同的行为：Firefox 会按 &lt;code class=&quot;language-text&quot;&gt;Content-Disposition&lt;/code&gt; 的结果来执行；Chrome 则会按 &lt;code class=&quot;language-text&quot;&gt;download&lt;/code&gt; 字段的设置来执行&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;更多细节可以参考 &lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/HTML/Element/a&quot;&gt;MDN&lt;/a&gt; 文档的相关部分。&lt;/p&gt;&lt;/section&gt;</content:encoded></item><item><title><![CDATA[Replace All Substring]]></title><link>https://laysent.github.io/til/2019/08#2019-08-14</link><guid isPermaLink="false">https://laysent.github.io/til/2019/08#2019-08-14</guid><pubDate>Wed, 14 Aug 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;JavaScript 内建的 &lt;code class=&quot;language-text&quot;&gt;String.prototype.replace&lt;/code&gt; 函数，如果传入的第一个参数是字符串，那么替换行为只会发生一次。如果需要将一个字符串内所有某子字符串都替换掉，往往需要一些额外的操作。以下提供一些可行的方案：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;使用循环进行多次替换&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;最直观的想法，就是替换完成后通过 &lt;code class=&quot;language-text&quot;&gt;indexOf&lt;/code&gt; 等方案查找字符串，如果还有就继续替换：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;replace&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;input&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; to&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;input&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;indexOf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; input &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; input&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;replace&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;input&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; to&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; input&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;当然，这并不是一个优雅的解决方案。&lt;/p&gt;
&lt;ol start=&quot;2&quot;&gt;
&lt;li&gt;使用正则表达式&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;String.prototype.replace&lt;/code&gt; 支持第一个参数传递正则表达式。有了正则表达式，只要设置上 &lt;code class=&quot;language-text&quot;&gt;g&lt;/code&gt; 标签，就可以全局匹配并替换所有的情况了。示例代码如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;replace&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;input&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; to&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; input&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;replace&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;RegExp&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;g&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; to&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这个方案的劣势在于，如果需要替换的内容中含有某些正则表达式特有的匹配符号，可能会导致非预期的结果。举个例子来说，如果希望把 &lt;code class=&quot;language-text&quot;&gt;.+&lt;/code&gt; 这个字符串替换成 &lt;code class=&quot;language-text&quot;&gt;+.&lt;/code&gt; 这样，上面的函数并不能达到预期的效果，因为 &lt;code class=&quot;language-text&quot;&gt;.+&lt;/code&gt; 在正则表达式中可以匹配任意的字符。&lt;code class=&quot;language-text&quot;&gt;replace(&amp;#39;hello.+world&amp;#39;, &amp;#39;.+&amp;#39;, &amp;#39;+.&amp;#39;)&lt;/code&gt; 的执行结果是 &lt;code class=&quot;language-text&quot;&gt;+.&lt;/code&gt;。&lt;/p&gt;
&lt;ol start=&quot;3&quot;&gt;
&lt;li&gt;使用 &lt;code class=&quot;language-text&quot;&gt;split&lt;/code&gt; &amp;#x26; &lt;code class=&quot;language-text&quot;&gt;join&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;这是一个比较取巧的方案，先用 &lt;code class=&quot;language-text&quot;&gt;split&lt;/code&gt; 函数将字符串进行拆分，然后再用 &lt;code class=&quot;language-text&quot;&gt;join&lt;/code&gt; 将拆分后的结果重新拼接起来。示例代码如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;replace&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;input&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; to&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; input&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;split&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;join&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;to&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这个方案代码比较简洁，也不会有正则表达式中提到的问题。虽然计算会产生中间变量（数组），但只要不是频繁或在大规模数据上使用，效率的影响可以忽略不计。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Glob in NPM]]></title><link>https://laysent.github.io/til/2019/08#2019-08-13</link><guid isPermaLink="false">https://laysent.github.io/til/2019/08#2019-08-13</guid><pubDate>Tue, 13 Aug 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;在使用 stylelint 的时候，发现了一个有趣的问题：如果直接使用 stylelint 的 &lt;code class=&quot;language-text&quot;&gt;bin&lt;/code&gt; 文件对批量 LESS 文件进行检查，程序可以如预期的运行；但是如果把同样的命令写到 &lt;code class=&quot;language-text&quot;&gt;package.json&lt;/code&gt; 中，以 npm script 的方式进行运行，最终被检查的文件就少了很多，实际只有一个文件参与了检查。&lt;/p&gt;
&lt;p&gt;具体来说，&lt;code class=&quot;language-text&quot;&gt;./node_modules/.bin/stylelint src/**/*.less&lt;/code&gt; 这个命令可以检查所有的 LESS 文件，但是把 &lt;code class=&quot;language-text&quot;&gt;stylelint src/**/*.less&lt;/code&gt; 写到 &lt;code class=&quot;language-text&quot;&gt;package.josn&lt;/code&gt; 中之后，再运行却只检查了一个文件。&lt;/p&gt;
&lt;p&gt;通过检查 stylelint 的&lt;a href=&quot;https://github.com/stylelint/stylelint/blob/master/docs/user-guide/cli.md&quot;&gt;文档&lt;/a&gt;，发现官方在写命令的时候，写法和上述略有不同，为：&lt;code class=&quot;language-text&quot;&gt;stylelint &amp;quot;src/**/*.less&amp;quot;&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;经过排查问题，发现根源在于：&lt;code class=&quot;language-text&quot;&gt;npm&lt;/code&gt; 使用了 &lt;code class=&quot;language-text&quot;&gt;sh&lt;/code&gt; 来执行代码，而 &lt;code class=&quot;language-text&quot;&gt;sh&lt;/code&gt; 和 &lt;code class=&quot;language-text&quot;&gt;zsh&lt;/code&gt; 在解析 Glob 的时候，行为是不同的。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;npm&lt;/code&gt;，包括其他 Linux 进程，在使用 shell 的时候，默认使用的都是 &lt;code class=&quot;language-text&quot;&gt;sh&lt;/code&gt;，除非有其他明确的指定。这意味着，即使当前正在使用的 shell 是 &lt;code class=&quot;language-text&quot;&gt;zsh&lt;/code&gt;，在运行 &lt;code class=&quot;language-text&quot;&gt;npm&lt;/code&gt; 命令的时候，还是默认使用了 &lt;code class=&quot;language-text&quot;&gt;sh&lt;/code&gt; 对脚本进行执行。也就是说，&lt;code class=&quot;language-text&quot;&gt;./node_modules/.bin/stylelint src/**/*.less&lt;/code&gt; 这个命令执行，使用的是当前打开的 shell 程序（比如 &lt;code class=&quot;language-text&quot;&gt;zsh&lt;/code&gt;）；而当这个命令写到 &lt;code class=&quot;language-text&quot;&gt;package.json&lt;/code&gt; 中，并以 npm script 的方式进行运行的时候，执行 shell 的就是 &lt;code class=&quot;language-text&quot;&gt;sh&lt;/code&gt; 了。&lt;/p&gt;
&lt;p&gt;使用不同的 shell 程序，难免就会在行为上造成不一致。这里的 Glob 解析就是一个例子。在 &lt;code class=&quot;language-text&quot;&gt;zsh&lt;/code&gt; 里面可以简单的做一个实验。执行如下的命令：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;ls&lt;/span&gt; src/**/*.less&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;可以看到，&lt;code class=&quot;language-text&quot;&gt;zsh&lt;/code&gt; 给出了当前 &lt;code class=&quot;language-text&quot;&gt;src&lt;/code&gt; 目录下所有的 LESS 文件， 不管这个文件是在多深的子目录下；而如果先在 &lt;code class=&quot;language-text&quot;&gt;zsh&lt;/code&gt; 中执行 &lt;code class=&quot;language-text&quot;&gt;sh&lt;/code&gt; 或 &lt;code class=&quot;language-text&quot;&gt;bash&lt;/code&gt; 进入到 &lt;code class=&quot;language-text&quot;&gt;sh&lt;/code&gt; 或 &lt;code class=&quot;language-text&quot;&gt;bash&lt;/code&gt; 的工作环境中，再执行同样的命令，可以看到输出的结果可能就是不同的。实际上，对于 &lt;code class=&quot;language-text&quot;&gt;sh&lt;/code&gt; 来说，它本身并不识别 &lt;code class=&quot;language-text&quot;&gt;**&lt;/code&gt; 这个语法，这个表示在 &lt;code class=&quot;language-text&quot;&gt;sh&lt;/code&gt; 中会被简单的识别为 &lt;code class=&quot;language-text&quot;&gt;*&lt;/code&gt;，&lt;code class=&quot;language-text&quot;&gt;src/**/*.less&lt;/code&gt; 在 &lt;code class=&quot;language-text&quot;&gt;sh&lt;/code&gt; 中等价于 &lt;code class=&quot;language-text&quot;&gt;src/*/*.less&lt;/code&gt;。换句话说，在 &lt;code class=&quot;language-text&quot;&gt;sh&lt;/code&gt; 的环境中，上述命令只会寻找所有在 &lt;code class=&quot;language-text&quot;&gt;src&lt;/code&gt; 目录下一级子目录中的 LESS 文件，一旦层级大于一层，就不会被找到了。&lt;/p&gt;
&lt;p&gt;这也是为什么同样的命令，直接执行和在 npm 中执行会有差异的原因。&lt;/p&gt;
&lt;p&gt;最后，加上双引号 &lt;code class=&quot;language-text&quot;&gt;stylelint &amp;quot;src/**/*.less&amp;quot;&lt;/code&gt; 就可以解决这一问题的原因在于：一旦加上了双引号，这一个 Glob 就不会被 shell 直接解析，而是会以字符串的形式直接传递给 stylelint。（具体来说，如果不加双引号，shell 会先将 Glob 解析成一组具体的文件，stylelint 实际拿到的 &lt;code class=&quot;language-text&quot;&gt;process.env.argv&lt;/code&gt; 很可能会是一个很长的字符串数组，每一个元素都是一个具体的文件；而如果加上了双引号，stylelint 拿到的只有一个 Glob 表达式字符串。）有了这个 Glob 的字符串，stylelint 内部就可以使用相应的 package 来进行解析，从而得到一串具体的文件列表。因为使用了 stylelint 内部自带的 Glob 解析，就可以保证在不同的 shell 环境中都得到一致的结果了。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://stackoverflow.com/questions/32017169/npm-glob-pattern-not-matching-subdirectories&quot;&gt;参考&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Chrome DevTools Blackbox]]></title><link>https://laysent.github.io/til/2019/08#2019-08-12</link><guid isPermaLink="false">https://laysent.github.io/til/2019/08#2019-08-12</guid><pubDate>Mon, 12 Aug 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;在 Chrome 调试的构成中，单步执行代码是常有的操作。然而，一般来说，出问题的很可能是业务代码，具体依赖的库（如 React 或者 Mobx 等）相对则是更加稳定的。如果单步调试的过程中，会频繁进出库相关的代码，显然会对调试造成很多的干扰，不利于问题的排查。&lt;/p&gt;
&lt;p&gt;为此，Chrome 提供了 Blackbox 的功能，可以帮助将部分指定的文件从调试中剔除。一旦使用 Blackbox 剔除了某些代码文件，那么：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;从这些文件中造成的报错不会暂停代码（除非开启了 Pause on exception）&lt;/li&gt;
&lt;li&gt;Step in/out/over 不会执行到这部分的代码&lt;/li&gt;
&lt;li&gt;这些文件中的事件监听断点不会触发&lt;/li&gt;
&lt;li&gt;文件中设置的断点也不会被触发（代码不会暂停）&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;有几个方法可以添加 Blackbox：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;打开 DevTools 后按 F1 打开 Settings 界面，然后选择 Blackboxing 并填写&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/cfc690ef64b8fa20f3d7653491ae0c05/b2a12/2019-08-12-blackbox-rule-screenshot.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 40.476190476190474%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABKUlEQVQoz41SXY+DIBD0//+7ez7bplV7/UABAUHUzu3Q9OGSXlKScRYWxtmFKoQJg9aIMWLbNoyjg/cezjkYYwsTn4zH44FKa4P9/gClFJZlRdO0aLsO558LmrYr8fF0QpgmzPOMlJJgLgZiTGVOzjk/BUMI6Pu+JLigJFaqRz9oiQcMwpOI0TmdPtkX99aOcKUajyjnOardbl8EmORgTFHO2QpjrThfsK6CP7xKi9bijKbI3FcZY8TFUMQyS27PxZ22TsqcBVlcxPcIMy7XG+q6hhYdVlLxw/7FOGFZN3w3FodO46osBpvk0P8YfRIzBvf7XVoxPgVplw5ft/x18KjPsjYm3HQsP+JL4OZ34Dn2nzG5Yu2vG5KLh3EZXZ9hfZb5Bi4z9yl+Afj4aleYhfmFAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;DevTools 设置 Blackbox 匹配规则&quot;
        title=&quot;&quot;
        src=&quot;/static/cfc690ef64b8fa20f3d7653491ae0c05/b9e4f/2019-08-12-blackbox-rule-screenshot.png&quot;
        srcset=&quot;/static/cfc690ef64b8fa20f3d7653491ae0c05/cf440/2019-08-12-blackbox-rule-screenshot.png 148w,
/static/cfc690ef64b8fa20f3d7653491ae0c05/d2d38/2019-08-12-blackbox-rule-screenshot.png 295w,
/static/cfc690ef64b8fa20f3d7653491ae0c05/b9e4f/2019-08-12-blackbox-rule-screenshot.png 590w,
/static/cfc690ef64b8fa20f3d7653491ae0c05/b2a12/2019-08-12-blackbox-rule-screenshot.png 630w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;如果网站的标准库是通过 CDN 文件直接引入的，可以把文件名直接写在这里，如 &lt;code class=&quot;language-text&quot;&gt;react.min.js&lt;/code&gt; 或是 &lt;code class=&quot;language-text&quot;&gt;jquery.min.js&lt;/code&gt; 等；类似的，如果页面是通过 Webpack 进行打包的，那么 vendor 的部分很可能也会打包到一个独立的文件中，比如就叫 &lt;code class=&quot;language-text&quot;&gt;vendor.xxx.js&lt;/code&gt;，那么也可以把相应的匹配写在这里。&lt;/p&gt;
&lt;ol start=&quot;2&quot;&gt;
&lt;li&gt;打开 DevTools 后在 Sources 标签下找到需要屏蔽的文件，在文件内容处右键，并选择 Blackbox&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/301011fa6736a78f21b3cd10071e7032/34e8a/2019-08-12-blackbox-file-screenshot.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 75.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAADXklEQVQ4y22UaU8bVxSG/Y+rSpWaECirsWPAJsZmTwihCRE7iVpFaqUqn5CifmlTiPG+jtdZPB7PeOXpmYHkQ9UZvZp7Z3nuec+cc30tVeM2maFYqqBpGrlcllarhaq2KBQKlEpF7747d5/puk61WiWVSlEu33+TzeZQlKr3na9aF0ihQjZfIZ0tCjxNKp2lUCyTyeb5+/M11zcJT/lCiVqtLnAVTdQ2NMy2jmnoNOpVWaCMz+4Y3BQtrm6apDN5EqkSyUyZVLbC9W2OL6kCLcOmpdu0rQH9/oDxaITTH1FRh9T04f1V66HpBr5Ox6RpOFRbHbGXkyhyYjVHLp/xxuVSXqJSUMVOvVaVcc2TLhGWlYaoTrGsU67odHUNX7vdZjjo4TgWxWaJdDVFopL4prSS5rZ8i6IqdO0uw+FQ3h9yJ1GOR0PGD/OBaDQY3AMdp4fV7WLabQzbQLd1fv/4G29PDrn85YKjsyPO3p1y8f6ct0eH7B+85OrTFc7IwepZfD1GsogH7AmwK0Dd0ml2mmhdjZ29bVYiS2xurxN+tsLWzgar0TCPJn/k+x++4+BwH6NneO/2hz36o77k1XkA9nrYti25bJKtZkgpKV7s77AcDrGxHScSXSG+sUY0tkpsPUpoKcj+mz3qao2sIrmuF0iWkqi6KkBTLNsOmpSA0qhIYjvoUltvXr8isOT3QC5wfStGfHONYGiRyZ8mODs7pafZdJumlE4XtWHgGF18pml6ds22SbVd5y/lmkQzzfOfn7MQmCMcXebpSoDlSIgl0Zx/honJRxxLXv97DN0cukDXrmEYNBrSFWJBqyTZfblBUECxzSirsQjP4qtE1sLMLc4yMfWY88szDzIej7m7u/PGg69/2QXqUu1G9h/sP//A+fCaw70t/MuLrMYjhCJPPaA/5GdmYZrHArx4d/H/QNeuK6tjUe+qfG4kuW3lxPIuoXDQizC4HGDGP82sRLcQnOeJ5PD4/NiD3D2cnuWhAN3GtizLa/KW1qDTNmibOjsvNgkE5omuRZhfmOXJ1IT8jEmmpiclhxOcnJ7cRzgYC8ktQrnI2Hd980WaXWCymzRkx2iUa9JKec5/PWX31TYHR/ts7W0Q24kS34190+WHSxKFhGwsGSqFIsVCnqK05L9QZQ5M8/57MAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;DevTools 设置单个文件 Blackbox&quot;
        title=&quot;&quot;
        src=&quot;/static/301011fa6736a78f21b3cd10071e7032/b9e4f/2019-08-12-blackbox-file-screenshot.png&quot;
        srcset=&quot;/static/301011fa6736a78f21b3cd10071e7032/cf440/2019-08-12-blackbox-file-screenshot.png 148w,
/static/301011fa6736a78f21b3cd10071e7032/d2d38/2019-08-12-blackbox-file-screenshot.png 295w,
/static/301011fa6736a78f21b3cd10071e7032/b9e4f/2019-08-12-blackbox-file-screenshot.png 590w,
/static/301011fa6736a78f21b3cd10071e7032/34e8a/2019-08-12-blackbox-file-screenshot.png 600w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://developer.chrome.com/devtools/docs/blackboxing&quot;&gt;参考文档&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[String Manipulation in SQLite]]></title><link>https://laysent.github.io/til/2019/08#2019-08-11</link><guid isPermaLink="false">https://laysent.github.io/til/2019/08#2019-08-11</guid><pubDate>Sun, 11 Aug 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;在 SQLite 中，如果需要对列表的字符串数据做一些简单的变化，可以直接通过 SQLite 内建的函数来完成，而不需要借助外部的程序语言（如 Node.js）。使用内建的操作，转化的效率会远高于使用外部的语言来进行操作。下面通过一些例子来简单介绍一些和字符串相关的操作方法：&lt;/p&gt;
&lt;section&gt;&lt;h2&gt;字符串截取&lt;/h2&gt;&lt;p&gt;可以使用 SQLite 自带的 &lt;code class=&quot;language-text&quot;&gt;substr&lt;/code&gt; 的函数来截取字符串。函数的签名是 &lt;code class=&quot;language-text&quot;&gt;substr(string, start, length)&lt;/code&gt;，其中 &lt;code class=&quot;language-text&quot;&gt;start&lt;/code&gt; 和 &lt;code class=&quot;language-text&quot;&gt;length&lt;/code&gt; 可以是负数，具体的行为可以参考&lt;a href=&quot;http://www.sqlitetutorial.net/sqlite-functions/sqlite-substr/&quot;&gt;这里&lt;/a&gt;的介绍。&lt;/p&gt;&lt;p&gt;假设有一列图像文件相关的数据：&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;xxx.jpg
yyy.gif
zzz.png&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;想要统计文件的格式，一个简单的写法如下（不考虑 &lt;code class=&quot;language-text&quot;&gt;.jpeg&lt;/code&gt; 之类的情况）：&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;select&lt;/span&gt; substr&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;image_column_name&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; suffix &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; table_name &lt;span class=&quot;token keyword&quot;&gt;group&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;by&lt;/span&gt; suffix&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;需要注意的一点是，SQLite 中的 &lt;code class=&quot;language-text&quot;&gt;substr&lt;/code&gt; 函数，记录的 start 下标，是从 1 而不是 0 开始的。&lt;/p&gt;&lt;/section&gt;
&lt;section&gt;&lt;h2&gt;查找字符&lt;/h2&gt;&lt;p&gt;在上例中，如果需要考虑 &lt;code class=&quot;language-text&quot;&gt;.jpeg&lt;/code&gt; 之类的情况，直接写死起始数字的下标就显得不太合适了。这时候，可以使用 &lt;code class=&quot;language-text&quot;&gt;instr&lt;/code&gt; 来配合查找：&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;select&lt;/span&gt; substr&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;column&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; instr&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;column&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;.&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; suffix &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; table_name&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;instr&lt;/code&gt; 的文档可以看&lt;a href=&quot;http://www.sqlitetutorial.net/sqlite-functions/sqlite-instr/&quot;&gt;这里&lt;/a&gt;。&lt;/p&gt;&lt;/section&gt;
&lt;section&gt;&lt;h2&gt;字符串长度&lt;/h2&gt;&lt;p&gt;如果需要删除字符串的最后几位，光有 &lt;code class=&quot;language-text&quot;&gt;substr&lt;/code&gt; 函数就不够用了，还需要知道一个字符串具体的长度，才能确定需要截取的字符串长度是多少（定长字符串除外）。这就需要 SQLite 自带的 &lt;code class=&quot;language-text&quot;&gt;length&lt;/code&gt; 函数了。细节可以参见&lt;a href=&quot;http://www.sqlitetutorial.net/sqlite-functions/sqlite-length/&quot;&gt;文档&lt;/a&gt;，以下举一个实际的例子。&lt;/p&gt;&lt;p&gt;假设有一列身高相关的数据：&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;170cm
168cm
182cm&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;想要截取其中数字的部分，可以使用 &lt;code class=&quot;language-text&quot;&gt;substr&lt;/code&gt; 和 &lt;code class=&quot;language-text&quot;&gt;length&lt;/code&gt; 配合着这么写：&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;select&lt;/span&gt; substr&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;column&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; length&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;column&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;table&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;section&gt;&lt;h3&gt;字符串转数字&lt;/h3&gt;&lt;p&gt;接着上文的例子，如果希望进一步把字符串转化成数字，可以使用 &lt;code class=&quot;language-text&quot;&gt;cast&lt;/code&gt; 函数：&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;select&lt;/span&gt; cast&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;170&apos;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;integer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;结合起来：&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;select&lt;/span&gt; cast&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;substr&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;column&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; length&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;column&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;integer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;table&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;注意，这里 &lt;code class=&quot;language-text&quot;&gt;substr&lt;/code&gt; 和 &lt;code class=&quot;language-text&quot;&gt;cask&lt;/code&gt; 函数在处理 &lt;code class=&quot;language-text&quot;&gt;NULL&lt;/code&gt; 的时候，都是不会做任何操作，直接返回 &lt;code class=&quot;language-text&quot;&gt;NULL&lt;/code&gt; 的。因此，如果上述的列中有数据是 &lt;code class=&quot;language-text&quot;&gt;NULL&lt;/code&gt; 而不是字符串，使用 &lt;code class=&quot;language-text&quot;&gt;cask&lt;/code&gt; + &lt;code class=&quot;language-text&quot;&gt;substr&lt;/code&gt; 的操作也会得到 &lt;code class=&quot;language-text&quot;&gt;NULL&lt;/code&gt; 的结果，不会有报错或其他问题。&lt;/p&gt;&lt;/section&gt;&lt;section&gt;&lt;h3&gt;转化成 NULL&lt;/h3&gt;&lt;p&gt;然而在上例中，如果 &lt;code class=&quot;language-text&quot;&gt;cask&lt;/code&gt; 收到的参数是空字符串，那么转换的结果就是 0。这就不一定符合需求了。可以使用 &lt;code class=&quot;language-text&quot;&gt;nullif&lt;/code&gt; 这个操作符，将这种情况强制转化成 &lt;code class=&quot;language-text&quot;&gt;NULL&lt;/code&gt;：&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;nullif&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;column&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/section&gt;&lt;section&gt;&lt;h3&gt;获取 ASCII 码&lt;/h3&gt;&lt;p&gt;使用字符串存储的成本会比使用整数来的大一些。除了上面提到的将字符串直接转化成数字的例子，对于一些单个字符类型的值，转化成数字存储也不失为一个好方案。比如，将某组 &lt;code class=&quot;language-text&quot;&gt;A&lt;/code&gt; 到 &lt;code class=&quot;language-text&quot;&gt;Z&lt;/code&gt; 的字母转化成 &lt;code class=&quot;language-text&quot;&gt;0&lt;/code&gt; 到 &lt;code class=&quot;language-text&quot;&gt;25&lt;/code&gt; 的数字。这时候，就可以使用 &lt;code class=&quot;language-text&quot;&gt;unicode&lt;/code&gt; 函数了：&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;select&lt;/span&gt; unicode&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;column&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;65&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; table_name&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;这里 &lt;code class=&quot;language-text&quot;&gt;65&lt;/code&gt; 是 &lt;code class=&quot;language-text&quot;&gt;A&lt;/code&gt; 的 ASCII 码。&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;</content:encoded></item><item><title><![CDATA[Big Number in JavaScript]]></title><link>https://laysent.github.io/til/2019/08#2019-08-08</link><guid isPermaLink="false">https://laysent.github.io/til/2019/08#2019-08-08</guid><pubDate>Thu, 08 Aug 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;JavaScript 中可以很方便在字符串和数字之间进行转换，比如：&lt;code class=&quot;language-text&quot;&gt;+&amp;#39;123&amp;#39;&lt;/code&gt; =&gt; &lt;code class=&quot;language-text&quot;&gt;123&lt;/code&gt;，&lt;code class=&quot;language-text&quot;&gt;(123).toString()&lt;/code&gt; =&gt; &lt;code class=&quot;language-text&quot;&gt;&amp;#39;123&amp;#39;&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;然而，需要注意的一点是，JavaScript 中的数字并不是整数，而是浮点数。更确切的说，数字使用的是 64 bit 双精度浮点数来表示的。这意味着，如果服务器存储的数字是一个 Int64，那么在给到前端的时候，很有可能会出现转化上的问题。对于双精度浮点数来说，能够表示的最大的数是 &lt;span class=&quot;katex&quot;&gt;&lt;span class=&quot;katex-mathml&quot;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;msup&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mn&gt;53&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;−&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;annotation encoding=&quot;application/x-tex&quot;&gt;2^{53}-1&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&quot;katex-html&quot; aria-hidden=&quot;true&quot;&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:0.897438em;vertical-align:-0.08333em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mord&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;msupsub&quot;&gt;&lt;span class=&quot;vlist-t&quot;&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.8141079999999999em;&quot;&gt;&lt;span style=&quot;top:-3.063em;margin-right:0.05em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:2.7em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sizing reset-size6 size3 mtight&quot;&gt;&lt;span class=&quot;mord mtight&quot;&gt;&lt;span class=&quot;mord mtight&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;mord mtight&quot;&gt;3&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.2222222222222222em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mbin&quot;&gt;−&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.2222222222222222em;&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:0.64444em;vertical-align:0em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;，超过的部分就会被截断，无法精确表示。&lt;/p&gt;
&lt;p&gt;比如：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;9223372036854775808&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;**&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;63&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// output: 9223372036854776000&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;JavaScript 提供了 &lt;code class=&quot;language-text&quot;&gt;Number.isSafeInteger&lt;/code&gt; 这个 API 来判断一个数字是否是在可表示的安全范围内。比如：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Number&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isSafeInteger&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;**&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;63&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// output: false&lt;/span&gt;
console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Number&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isSafeInteger&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;9223372036854776000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// output: false&lt;/span&gt;
console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Number&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isSafeInteger&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;**&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;53&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// output: true&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这里，&lt;code class=&quot;language-text&quot;&gt;2 ** 53 - 1&lt;/code&gt; 就是 JavaScript 中可以表示的最大整数，&lt;code class=&quot;language-text&quot;&gt;Number.MAX_SAFE_INTEGER&lt;/code&gt; 这个常量也等于这个值。超过这个数值的所有值都会被认为是不安全的，哪怕该值实际表示的结果“凑巧”是正确的。上例中，&lt;code class=&quot;language-text&quot;&gt;9223372036854776000&lt;/code&gt; 这个数字的表示结果“刚好”就是 &lt;code class=&quot;language-text&quot;&gt;9223372036854776000&lt;/code&gt; 本身，但是因为这个数已经超过了 &lt;span class=&quot;katex&quot;&gt;&lt;span class=&quot;katex-mathml&quot;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;msup&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mn&gt;53&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;−&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;annotation encoding=&quot;application/x-tex&quot;&gt;2^{53} - 1&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&quot;katex-html&quot; aria-hidden=&quot;true&quot;&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:0.897438em;vertical-align:-0.08333em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mord&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;msupsub&quot;&gt;&lt;span class=&quot;vlist-t&quot;&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.8141079999999999em;&quot;&gt;&lt;span style=&quot;top:-3.063em;margin-right:0.05em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:2.7em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sizing reset-size6 size3 mtight&quot;&gt;&lt;span class=&quot;mord mtight&quot;&gt;&lt;span class=&quot;mord mtight&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;mord mtight&quot;&gt;3&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.2222222222222222em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mbin&quot;&gt;−&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.2222222222222222em;&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:0.64444em;vertical-align:0em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;，所以依然被判定为是不安全的。&lt;/p&gt;
&lt;p&gt;虽然 JavaScript 本身的数字不支持大数，但是 Chrome 已经集成了 &lt;code class=&quot;language-text&quot;&gt;BigInt&lt;/code&gt; 数据类型，它可以被用于表示任意大的整形数字，可以用于这样的使用场景。（注：&lt;code class=&quot;language-text&quot;&gt;BigInt&lt;/code&gt; 本身还在 staging 3，并不是标准的一部分）&lt;/p&gt;
&lt;p&gt;简单的使用方法如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; num &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;BigInt&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;**&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;63&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// or:&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// const num = BigInt(&apos;9223372036854776000&apos;);&lt;/span&gt;
console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;num&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// output: 9223372036854775808n&lt;/span&gt;
console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;typeof&lt;/span&gt; num&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// output: bigint&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;需要注意的是，&lt;code class=&quot;language-text&quot;&gt;BigInt&lt;/code&gt; 不可以使用 &lt;code class=&quot;language-text&quot;&gt;new&lt;/code&gt; 运算符，否则会报错。直接像函数一样传递参数调用就可以了。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;BigInt&lt;/code&gt; 也是支持数字运算的，运算的结果依然是 &lt;code class=&quot;language-text&quot;&gt;BigInt&lt;/code&gt;：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1n&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2n&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// =&gt; 3n&lt;/span&gt;
console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;3n&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1n&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// =&gt; 2n&lt;/span&gt;
console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2n&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3n&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// =&gt; 6n&lt;/span&gt;
console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;5n&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2n&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// =&gt; 2n&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;特别需要注意的是，因为是整型数字之间的转换，所以在做除法的时候，不会出现小数。在上面的例子中，&lt;code class=&quot;language-text&quot;&gt;5n&lt;/code&gt; 和 &lt;code class=&quot;language-text&quot;&gt;2n&lt;/code&gt; 的除法，结果是 &lt;code class=&quot;language-text&quot;&gt;2n&lt;/code&gt; 而不是 &lt;code class=&quot;language-text&quot;&gt;2.5&lt;/code&gt;，这一个行为和 C 中两个 Integer 之间除法的行为是一致的。&lt;/p&gt;
&lt;p&gt;另外，&lt;code class=&quot;language-text&quot;&gt;BigInt&lt;/code&gt; 不支持和其他的数据类型进行混合计算。比如：&lt;code class=&quot;language-text&quot;&gt;1n + 2&lt;/code&gt; 这样的计算是会报错的，需要显式的进行类型转换后，才可以进行运算。这一点，和 JavaScript 中其他数据类型之间随意混乱的运算行为是不同的（比如，&lt;code class=&quot;language-text&quot;&gt;1 + &amp;#39;2&amp;#39;&lt;/code&gt; 这样的计算 JavaScript 就不会报错，还会得到 &lt;code class=&quot;language-text&quot;&gt;&amp;#39;12&amp;#39;&lt;/code&gt; 这样怪异的结果）。&lt;/p&gt;
&lt;p&gt;虽然 &lt;code class=&quot;language-text&quot;&gt;BigInt&lt;/code&gt; 不允许和一般的 &lt;code class=&quot;language-text&quot;&gt;Number&lt;/code&gt; 进行混合计算，但是比较运算符是可以在两者之间进行比较的。比如：&lt;code class=&quot;language-text&quot;&gt;1n &amp;lt; 2&lt;/code&gt; 或 &lt;code class=&quot;language-text&quot;&gt;2n &amp;gt; 1&lt;/code&gt; 这些都是成立的。&lt;code class=&quot;language-text&quot;&gt;BigInt&lt;/code&gt; 和 &lt;code class=&quot;language-text&quot;&gt;Number&lt;/code&gt; 之间无法取得 &lt;code class=&quot;language-text&quot;&gt;===&lt;/code&gt; 的严格等价关系，但是 &lt;code class=&quot;language-text&quot;&gt;==&lt;/code&gt; 的比较是可能成立的。换句话说：&lt;code class=&quot;language-text&quot;&gt;1n == 1&lt;/code&gt; 是成立的，但是 &lt;code class=&quot;language-text&quot;&gt;1n === 1&lt;/code&gt; 是不成立的。&lt;/p&gt;
&lt;p&gt;更多关于 &lt;code class=&quot;language-text&quot;&gt;BigInt&lt;/code&gt; 的行为，可以参考 &lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/BigInt&quot;&gt;MDN&lt;/a&gt;。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Screen Recording in MacOS]]></title><link>https://laysent.github.io/til/2019/08#2019-08-07</link><guid isPermaLink="false">https://laysent.github.io/til/2019/08#2019-08-07</guid><pubDate>Wed, 07 Aug 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;OSX 自带的 QuickTime Player 支持屏幕的录制功能。具体的操作步骤如下：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;打开 QuickTime Player&lt;/li&gt;
&lt;li&gt;点击菜单中的 File =&gt; New Screen Recording&lt;/li&gt;
&lt;li&gt;拖拽选择需要录制的区域，并点击开始录制，点击右上角可以结束录制&lt;/li&gt;
&lt;li&gt;录屏结束后，可以选择菜单中的 File =&gt; Export =&gt; As Movie 来保存视频&lt;/li&gt;
&lt;/ol&gt;
&lt;section&gt;&lt;h2&gt;转化为 Gif 格式&lt;/h2&gt;&lt;p&gt;假设上述步骤保存了一个名为 &lt;code class=&quot;language-text&quot;&gt;in.mov&lt;/code&gt; 的视频，通过以下步骤可以将视频转化为 Gif 格式：&lt;/p&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;右键点击 &lt;code class=&quot;language-text&quot;&gt;in.mov&lt;/code&gt; 文件，选择 &lt;code class=&quot;language-text&quot;&gt;Get Info&lt;/code&gt;，在 &lt;code class=&quot;language-text&quot;&gt;More Info&lt;/code&gt; 中找到视频的大小信息，这里假设大小为 60x40&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;运行如下命令，将 &lt;code class=&quot;language-text&quot;&gt;in.mov&lt;/code&gt; 转化为 &lt;code class=&quot;language-text&quot;&gt;out.gif&lt;/code&gt; 文件&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;ffmpeg -i in.mov -s 60x40 -pix_fmt rgb24 -r 10 -f gif out.gif&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这里参数的具体含义如下：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;-s 60x40&lt;/code&gt; 指定了最大宽度和最大高度。这里可以不指定，输出将按照原始大小来。如果指定较小的长宽值，输出将变小。&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;-r 10&lt;/code&gt; 将帧数从 25 调整为 10。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;如果 &lt;code class=&quot;language-text&quot;&gt;ffmpeg&lt;/code&gt; 命令找不到，可以使用 &lt;code class=&quot;language-text&quot;&gt;Homebrew&lt;/code&gt; 进行安装：&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;brew &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; ffmpeg&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/section&gt;
&lt;section&gt;&lt;h2&gt;优化 Gif 文件&lt;/h2&gt;&lt;p&gt;可以使用 &lt;code class=&quot;language-text&quot;&gt;gifsicle&lt;/code&gt; 命令对产生的 gif 文件进行压缩：&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;gifsicle out.gif --optimize&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;3 -o optimized.gif&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;这里，&lt;code class=&quot;language-text&quot;&gt;--optimize=3&lt;/code&gt; 参数要求 &lt;code class=&quot;language-text&quot;&gt;gifsicle&lt;/code&gt; 使用最高等级优化图片。这会需要更多的时间和 CPU 来计算，但是压缩效果相对也是最好的。&lt;/p&gt;&lt;p&gt;如果找不到 &lt;code class=&quot;language-text&quot;&gt;gifsicle&lt;/code&gt; 命令，可以使用 &lt;code class=&quot;language-text&quot;&gt;Homebrew&lt;/code&gt; 进行安装：&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;brew &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; gifsicle&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;经测试，一个 &lt;code class=&quot;language-text&quot;&gt;463 KB&lt;/code&gt; 的文件，压缩后的大小为 &lt;code class=&quot;language-text&quot;&gt;417 KB&lt;/code&gt;，压缩了 10%。&lt;/p&gt;&lt;p&gt;以上生成 Gif 和优化 Gif 的命令可以放到一起执行：&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;ffmpeg -i in.mov -s 60x40 -pix_fmt rgb24 - &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; gifsicle --optimize&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;3 &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; out.gif&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/section&gt;
&lt;section&gt;&lt;h2&gt;参考&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://gist.github.com/dergachev/4627207&quot;&gt;https://gist.github.com/dergachev/4627207&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;该文作者针对 mov 到 gif 的转换写了一个 Ruby 脚本，可以显著提高转化后的质量，脚本见 &lt;a href=&quot;https://github.com/dergachev/screengif&quot;&gt;https://github.com/dergachev/screengif&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/section&gt;</content:encoded></item><item><title><![CDATA[Raspberry Pi as WOL]]></title><link>https://laysent.github.io/til/2019/08#2019-08-06</link><guid isPermaLink="false">https://laysent.github.io/til/2019/08#2019-08-06</guid><pubDate>Tue, 06 Aug 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;安装 &lt;code class=&quot;language-text&quot;&gt;etherwake&lt;/code&gt; 用于 WOL (wake on LAN) 操作&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;apt-get&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; etherwake&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;接下来，可以通过命令：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; etherwake -i eth0 AA:BB:CC:DD:EE:FF&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;来唤醒 AA:BB:CC:DD:EE:FF 这个 MAC 地址的设备。几点注意：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;etherwake&lt;/code&gt; 需要 &lt;code class=&quot;language-text&quot;&gt;sudo&lt;/code&gt; 运行，否则会报错：&lt;code class=&quot;language-text&quot;&gt;etherwake: This program must be run as root.&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;-i eth0&lt;/code&gt; 不是必须的。如果同时有有线和无线网卡，&lt;code class=&quot;language-text&quot;&gt;-i&lt;/code&gt; 可以强制要求 &lt;code class=&quot;language-text&quot;&gt;etherwake&lt;/code&gt; 走有线的路径&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;a href=&quot;https://notenoughtech.com/featured/use-raspberry-pi-wol/&quot;&gt;参考文献&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Permission Denied for Rsync]]></title><link>https://laysent.github.io/til/2019/08#2019-08-05</link><guid isPermaLink="false">https://laysent.github.io/til/2019/08#2019-08-05</guid><pubDate>Mon, 05 Aug 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;相比于 &lt;code class=&quot;language-text&quot;&gt;scp&lt;/code&gt;，&lt;code class=&quot;language-text&quot;&gt;rsync&lt;/code&gt; 命令可以在 SSH 拷贝的时候提供更多的灵活性，比如只拷贝新修改的或未存在的文件。&lt;/p&gt;
&lt;p&gt;一个简单的拷贝命令如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;rsync&lt;/span&gt; -auv /local/folder host:/remote/folder&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这里，&lt;code class=&quot;language-text&quot;&gt;-a&lt;/code&gt; 表示拷贝所有的文件（包括子文件夹中的），&lt;code class=&quot;language-text&quot;&gt;-u&lt;/code&gt; 表示只拷贝修改时间更新的部分，&lt;code class=&quot;language-text&quot;&gt;-v&lt;/code&gt; 则会将结果输出到 stdin 中方便查看。类似的，还可以使用 &lt;code class=&quot;language-text&quot;&gt;--ignore-existing&lt;/code&gt; 来要求 &lt;code class=&quot;language-text&quot;&gt;rsync&lt;/code&gt; 只拷贝新的文件，忽略已经存在的部分。&lt;/p&gt;
&lt;p&gt;然而在实际使用的过程中，&lt;code class=&quot;language-text&quot;&gt;rsync&lt;/code&gt; 有如下报错：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Permission denied, please try again.
rsync: connection unexpectedly closed (0 bytes received so far) [sender]
rsync error: error in rsync protocol data stream (code 12) at io.c(235) [sender=3.1.2]&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如果换同样的 SSH 配置，使用 &lt;code class=&quot;language-text&quot;&gt;scp&lt;/code&gt; 就不会有类似的报错，可见本身并不是 SSH 登陆账户权限的问题。这里的 Permission denied 报错非常的具有误导性。实际上，更可能的情况是 &lt;code class=&quot;language-text&quot;&gt;rsync&lt;/code&gt; 无法在远程主机上找到，需要通过 &lt;code class=&quot;language-text&quot;&gt;--rsync-path&lt;/code&gt; 参数手动指定。&lt;/p&gt;
&lt;p&gt;首先，可以先 SSH 到远程主机上，确认 &lt;code class=&quot;language-text&quot;&gt;rsync&lt;/code&gt; 本身是存在的：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;rsync&lt;/span&gt; --help&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;接着，可以通过 &lt;code class=&quot;language-text&quot;&gt;type&lt;/code&gt; 命令确认 &lt;code class=&quot;language-text&quot;&gt;rsync&lt;/code&gt; 的实际位置：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;type&lt;/span&gt; -a &lt;span class=&quot;token function&quot;&gt;rsync&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这里，假设输出的结果是 &lt;code class=&quot;language-text&quot;&gt;/bin/rsync&lt;/code&gt;，那么，可以将原先的 &lt;code class=&quot;language-text&quot;&gt;rsync&lt;/code&gt; 命令改写为：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;rsync&lt;/span&gt; -auv /local/folder host:/remote/folder --rsync-path&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;/bin/rsync&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;再次运行就不会报错了。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://superuser.com/questions/1017697/how-can-rsync-fail-due-to-missing-permissions-if-remote-login-occurs-with-root&quot;&gt;参考文档&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[How Makefile works]]></title><link>https://laysent.github.io/til/2019/08#2019-08-04</link><guid isPermaLink="false">https://laysent.github.io/til/2019/08#2019-08-04</guid><pubDate>Sun, 04 Aug 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;在 C 编程中，经常会用到 &lt;code class=&quot;language-text&quot;&gt;Makefile&lt;/code&gt; 来对源代码进行编译。一个简单的 &lt;code class=&quot;language-text&quot;&gt;Makefile&lt;/code&gt; 如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;makefile&quot;&gt;&lt;pre class=&quot;language-makefile&quot;&gt;&lt;code class=&quot;language-makefile&quot;&gt;&lt;span class=&quot;token symbol&quot;&gt;out&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; input.c
  &lt;span class=&quot;token variable&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;CC&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; input.c -o out -Wall -Wextra -std&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;c99&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这里，第一行的 &lt;code class=&quot;language-text&quot;&gt;out: input.c&lt;/code&gt; 表示 &lt;code class=&quot;language-text&quot;&gt;make&lt;/code&gt; 应该根据输入 &lt;code class=&quot;language-text&quot;&gt;input.c&lt;/code&gt; 来产出 &lt;code class=&quot;language-text&quot;&gt;out&lt;/code&gt; 这个文件。&lt;/p&gt;
&lt;p&gt;第二行的 &lt;code class=&quot;language-text&quot;&gt;$(CC)&lt;/code&gt; 会由 &lt;code class=&quot;language-text&quot;&gt;make&lt;/code&gt; 替换成本机的 cc 程序（即 &lt;strong&gt;c&lt;/strong&gt; &lt;strong&gt;c&lt;/strong&gt;ompiler）；后面跟着的是 &lt;code class=&quot;language-text&quot;&gt;cc&lt;/code&gt; 编译会用到的参数，包括输入源文件 &lt;code class=&quot;language-text&quot;&gt;input.c&lt;/code&gt;，输出文件 &lt;code class=&quot;language-text&quot;&gt;out&lt;/code&gt;，编译输出所有的 Warning（&lt;code class=&quot;language-text&quot;&gt;-Wall&lt;/code&gt; 即 &lt;strong&gt;W&lt;/strong&gt;arning &lt;strong&gt;all&lt;/strong&gt;，&lt;code class=&quot;language-text&quot;&gt;-Wextra&lt;/code&gt; 即 &lt;strong&gt;W&lt;/strong&gt;arning &lt;strong&gt;extra&lt;/strong&gt;），同时指定使用 &lt;a href=&quot;https://en.wikipedia.org/wiki/C99&quot;&gt;C99&lt;/a&gt; 标准来编译 C 代码（和 &lt;a href=&quot;https://en.wikipedia.org/wiki/ANSI_C&quot;&gt;ANSI C&lt;/a&gt; 相比，C99 允许在函数的任意位置定义变量，而不是必须在顶部）。&lt;/p&gt;
&lt;p&gt;运行 &lt;code class=&quot;language-text&quot;&gt;make&lt;/code&gt; 命令，程序会查找当前目录下的 &lt;code class=&quot;language-text&quot;&gt;Makefile&lt;/code&gt; 函数，读取其中的配置，根据输入输出的要求，查找文件，然后再选择编译。&lt;/p&gt;
&lt;p&gt;第一次编译，程序会用 &lt;code class=&quot;language-text&quot;&gt;input.c&lt;/code&gt; 编译出一个 &lt;code class=&quot;language-text&quot;&gt;out&lt;/code&gt; 文件来。&lt;/p&gt;
&lt;p&gt;在 &lt;code class=&quot;language-text&quot;&gt;input.c&lt;/code&gt; 没有修改的情况下，如果再运行一次 &lt;code class=&quot;language-text&quot;&gt;make&lt;/code&gt; 命令，会得到如下的输出：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;plain&quot;&gt;&lt;pre class=&quot;language-plain&quot;&gt;&lt;code class=&quot;language-plain&quot;&gt;make: `out` is update to date.&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这里，&lt;code class=&quot;language-text&quot;&gt;make&lt;/code&gt; 程序并没有通过任何外部文件的方式记录编译的情况。判断是否需要编译完全依赖于系统默认的文件功能，即简单的比较 &lt;code class=&quot;language-text&quot;&gt;input.c&lt;/code&gt; 和 &lt;code class=&quot;language-text&quot;&gt;out&lt;/code&gt; 两个文件的最后修改时间。如果 &lt;code class=&quot;language-text&quot;&gt;out&lt;/code&gt; 的最后修改时间比 &lt;code class=&quot;language-text&quot;&gt;input.c&lt;/code&gt; 要晚，就认为 &lt;code class=&quot;language-text&quot;&gt;out&lt;/code&gt; 是最新的，不再重复编译；如果 &lt;code class=&quot;language-text&quot;&gt;input.c&lt;/code&gt; 的最后修改时间晚于 &lt;code class=&quot;language-text&quot;&gt;out&lt;/code&gt; 的时间，或是 &lt;code class=&quot;language-text&quot;&gt;out&lt;/code&gt; 压根就不存在，那么 &lt;code class=&quot;language-text&quot;&gt;make&lt;/code&gt; 就会执行 &lt;code class=&quot;language-text&quot;&gt;Makefile&lt;/code&gt; 中配置的编译命令。&lt;/p&gt;
&lt;p&gt;可以通过以下方式欺骗 &lt;code class=&quot;language-text&quot;&gt;Makefile&lt;/code&gt; 来检查这一行为：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;修改一下 &lt;code class=&quot;language-text&quot;&gt;input.c&lt;/code&gt; 并保存&lt;/li&gt;
&lt;li&gt;删除 &lt;code class=&quot;language-text&quot;&gt;out&lt;/code&gt; 文件，然后用 &lt;code class=&quot;language-text&quot;&gt;touch&lt;/code&gt; 命令创建一个空的 &lt;code class=&quot;language-text&quot;&gt;out&lt;/code&gt; 文件。因为是先修改，再创建，所以 &lt;code class=&quot;language-text&quot;&gt;out&lt;/code&gt; 的创建时间会晚于 &lt;code class=&quot;language-text&quot;&gt;input.c&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;尝试执行 &lt;code class=&quot;language-text&quot;&gt;make&lt;/code&gt; 命令，会发现提示 &lt;code class=&quot;language-text&quot;&gt;out&lt;/code&gt; 已经是最新的，并没有执行真正的编译命令（尽管这里 &lt;code class=&quot;language-text&quot;&gt;out&lt;/code&gt; 并不是通过 &lt;code class=&quot;language-text&quot;&gt;make&lt;/code&gt; 编译出来的）&lt;/li&gt;
&lt;/ol&gt;</content:encoded></item><item><title><![CDATA[Check Exit Code of Command]]></title><link>https://laysent.github.io/til/2019/08#2019-08-02</link><guid isPermaLink="false">https://laysent.github.io/til/2019/08#2019-08-02</guid><pubDate>Fri, 02 Aug 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;在命令行中，一个命令会有一个返回数值，&lt;code class=&quot;language-text&quot;&gt;0&lt;/code&gt; 代表正确运行；如果命令返回了非 &lt;code class=&quot;language-text&quot;&gt;0&lt;/code&gt; 数据，则代表命令运行出现了错误。&lt;/p&gt;
&lt;p&gt;比如，如果 &lt;code class=&quot;language-text&quot;&gt;Jest&lt;/code&gt; 命令跑单元测试出现了错误，那么就会返回一个非 &lt;code class=&quot;language-text&quot;&gt;0&lt;/code&gt; 的值。运用 &lt;code class=&quot;language-text&quot;&gt;set -e&lt;/code&gt; 可以让 Bash 在遇到非零返回的命令行之后即停止，不再运行接下去的命令。&lt;/p&gt;
&lt;p&gt;那么，该如何确定之前的命令是否返回了 &lt;code class=&quot;language-text&quot;&gt;0&lt;/code&gt; 呢？&lt;/p&gt;
&lt;p&gt;可以简单的使用如下的命令：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$?&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这里的 &lt;code class=&quot;language-text&quot;&gt;$?&lt;/code&gt; 就是上一个命令返回的数值。如果上一条命令执行成功，那么这里应该输出 &lt;code class=&quot;language-text&quot;&gt;0&lt;/code&gt;。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Exit when Command Fail]]></title><link>https://laysent.github.io/til/2019/08#2019-08-01</link><guid isPermaLink="false">https://laysent.github.io/til/2019/08#2019-08-01</guid><pubDate>Thu, 01 Aug 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;在写 CI 脚本的时候，希望可以在脚本执行失败之后终止后续的所有操作。比如：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;start&quot;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;yarn&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;test&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;end&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如果 &lt;code class=&quot;language-text&quot;&gt;yarn test&lt;/code&gt; 这个命令失败了，希望不执行 &lt;code class=&quot;language-text&quot;&gt;echo &amp;quot;end&amp;quot;&lt;/code&gt; 语句。然而通过执行上面的代码，会发现默认是执行的。如果希望不执行这个操作，有几种思路：&lt;/p&gt;
&lt;p&gt;第一种，是用 &lt;code class=&quot;language-text&quot;&gt;&amp;amp;&amp;amp;&lt;/code&gt; 将语句串联起来，比如：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;start&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;yarn&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;test&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;end&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这样的方案，缺点是比较的麻烦。一旦东西比较多，就很难保证代码的可读性了。&lt;/p&gt;
&lt;p&gt;第二种方案，是使用 &lt;code class=&quot;language-text&quot;&gt;set -e&lt;/code&gt;，脚本改为：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;set&lt;/span&gt; -e
&lt;span class=&quot;token keyword&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;start&quot;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;yarn&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;test&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;end&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如此一来，脚本在语句执行失败（Exit Code 不是 0）之后就会退出，不会执行接下去的脚本。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://www.gnu.org/savannah-checkouts/gnu/bash/manual/bash.html#The-Set-Builtin&quot;&gt;参考文档&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Follow Redirection]]></title><link>https://laysent.github.io/til/2019/07#2019-07-31</link><guid isPermaLink="false">https://laysent.github.io/til/2019/07#2019-07-31</guid><pubDate>Wed, 31 Jul 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;在进行网络请求的时候，有可能会遇上服务器指定链接跳转的情况。此时，无论是 301（永久转移）还是 302（暂时转移），在请求页面的时候都需要根据服务器的指示，去访问下一个链接。当然，这里下一个链接依然有可能是跳转链接，需要继续执行跳转操作。&lt;/p&gt;
&lt;p&gt;一段可用的 Node.js 代码如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; http &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;http&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; https &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;https&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;fetch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;link&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Promise&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;resolve&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;get&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; link&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;startsWith&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;https&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; https &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; http&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;link&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token parameter&quot;&gt;response&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;response&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;statusCode &lt;span class=&quot;token operator&quot;&gt;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;300&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;statusCode &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;400&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; location &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;headers&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;fetch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;location&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;then&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;resolve&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;resolve&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;response&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;headers&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;set-cookie&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这里，Node.js 处理 HTTP 和 HTTPs 请求使用的模块是不相同的，因而需要根据链接地址的 protocol 进行按需索取。同时，如果是 3xx 的 HTTP 结果，则需要进行链接跳转。可以直接读取 headers 中的 &lt;code class=&quot;language-text&quot;&gt;location&lt;/code&gt; 数据，找到下一步需要跳转到的位置。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Bad owner or permissions]]></title><link>https://laysent.github.io/til/2019/07#2019-07-30</link><guid isPermaLink="false">https://laysent.github.io/til/2019/07#2019-07-30</guid><pubDate>Tue, 30 Jul 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;在 Docker 中使用 SSH 的功能时，发现 SSH 报错：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Bad owner or permissions on ~/.ssh/config&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;通过 &lt;code class=&quot;language-text&quot;&gt;ls -l&lt;/code&gt; 查看 &lt;code class=&quot;language-text&quot;&gt;~/.ssh/config&lt;/code&gt;，得到如下结果：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;-rw------- 1 1000  1000   557 Jul 29 20:32 config&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;注意到给出的 User 和 Group 的值不是一个名字（如 &lt;code class=&quot;language-text&quot;&gt;root&lt;/code&gt;），而是一个数字。这说明，文件所属的 User / Group 无法找到。&lt;/p&gt;
&lt;p&gt;可以通过如下的命令查看当前 &lt;code class=&quot;language-text&quot;&gt;root&lt;/code&gt; 用户的 ID：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;id&lt;/span&gt; -u root &lt;span class=&quot;token comment&quot;&gt;# output =&gt; 0&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;可以看到和 &lt;code class=&quot;language-text&quot;&gt;ls&lt;/code&gt; 列出的 ID 是不匹配的。这说明，导致 SSH 无法正常工作的主要原因，是 &lt;code class=&quot;language-text&quot;&gt;~/.ssh/config&lt;/code&gt; 文件权限的设置有问题。可以通过如下的命令将权限分配给当前的 &lt;code class=&quot;language-text&quot;&gt;root&lt;/code&gt; 用户：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;chown&lt;/span&gt; -R root:root /root/.ssh&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;再次运行 SSH 就可以正常工作了。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Jest with Ant Design]]></title><link>https://laysent.github.io/til/2019/07#2019-07-29</link><guid isPermaLink="false">https://laysent.github.io/til/2019/07#2019-07-29</guid><pubDate>Mon, 29 Jul 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;当 Ant Design 和 Jest 一起使用的时候，在某些情况下（开启 coverage 的时候）会导致单元测试运行失败。一个可能造成问题的 Ant Design 代码如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; Input &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;antd&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; TextArea &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Input&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Jest 会报错：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;ReferenceError: Input is not defined

  1 | import { Input } from &amp;#39;ant-design&amp;#39;;
  2 |
&amp;gt; 3 | const { TextArea } = Input;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;报错的直接原因，是使用了 Ant Design 推荐的 &lt;code class=&quot;language-text&quot;&gt;babel-plugin-import&lt;/code&gt; 和 Jest 计算 coverage 使用的 &lt;code class=&quot;language-text&quot;&gt;babel-plugin-istanbul&lt;/code&gt; 造成的。在&lt;a href=&quot;https://github.com/ant-design/babel-plugin-import/issues/172&quot;&gt;这里&lt;/a&gt;、&lt;a href=&quot;https://github.com/ant-design/babel-plugin-import/issues/189#issuecomment-445139343&quot;&gt;这里&lt;/a&gt;等 GitHub Issue 中都有相应的讨论。&lt;/p&gt;
&lt;p&gt;要修复这个问题，只需要在 Jest 或者单元测试环境中，不使用 &lt;code class=&quot;language-text&quot;&gt;babel-plugin-import&lt;/code&gt; 这个转换插件就可以了。参考代码如下，在 &lt;code class=&quot;language-text&quot;&gt;.babelrc&lt;/code&gt; 中：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;env&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;development&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;plugins&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
          &lt;span class=&quot;token string&quot;&gt;&quot;import&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token property&quot;&gt;&quot;libraryName&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;antd&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token property&quot;&gt;&quot;style&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;production&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token comment&quot;&gt;// same as above&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;plugins&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// rest of plugins...&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如此一来，只有在 &lt;code class=&quot;language-text&quot;&gt;NODE_ENV&lt;/code&gt; 为 &lt;code class=&quot;language-text&quot;&gt;production&lt;/code&gt; 或 &lt;code class=&quot;language-text&quot;&gt;development&lt;/code&gt; 的情况下，Babel 才会启用 &lt;code class=&quot;language-text&quot;&gt;babel-plugin-import&lt;/code&gt; 这个转换插件。对于 Jest 来说，因为默认设置了环境变量 &lt;code class=&quot;language-text&quot;&gt;NODE_ENV&lt;/code&gt; 为 &lt;code class=&quot;language-text&quot;&gt;test&lt;/code&gt;，所以 Plugin 不会起效。&lt;/p&gt;
&lt;p&gt;这样造成的问题是 Jest 的运行速度会有所降低。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[SSH Host Config]]></title><link>https://laysent.github.io/til/2019/07#2019-07-28</link><guid isPermaLink="false">https://laysent.github.io/til/2019/07#2019-07-28</guid><pubDate>Sun, 28 Jul 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;如果手上有多台设备在管理，SSH 的时候需要记住各个设备的 IP 地址、输入，总是很麻烦的。SSH 提供了配置文件的功能，可以为不同的 IP 设置别名，同时配置登陆需要用到的用户名和 RSA 私钥等。&lt;/p&gt;
&lt;section&gt;&lt;h2&gt;配置方法&lt;/h2&gt;&lt;p&gt;修改 &lt;code class=&quot;language-text&quot;&gt;~/.ssh/config&lt;/code&gt; 文件，增加每个设备对应的配置数据。举例如下：&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Host pi
    Hostname 192.168.xx.xx
    User pi
    IdentityFile ~/.ssh/id_pi_rsa&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;这样就配置好了一个 Raspberry Pi 的别名。接下来，可以直接使用如下的命令来访问设备：&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;ssh&lt;/span&gt; pi&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;除了 SSH 之外，SCP 也可以使用同样的配置。比如：&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;scp&lt;/span&gt; -r /local/path pi:/remote/path&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/section&gt;</content:encoded></item><item><title><![CDATA[Import Chunkname with Babel Plugin]]></title><link>https://laysent.github.io/til/2019/07#2019-07-26</link><guid isPermaLink="false">https://laysent.github.io/til/2019/07#2019-07-26</guid><pubDate>Fri, 26 Jul 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;默认情况下，Webapck 会用 Chunk ID 为 &lt;code class=&quot;language-text&quot;&gt;import()&lt;/code&gt; 产生的独立文件命名，最终的结果就是类似于 &lt;code class=&quot;language-text&quot;&gt;0.bundle.js&lt;/code&gt; 这样的文件。这样的文件并不方便理解和管理，所以一般会使用 &lt;code class=&quot;language-text&quot;&gt;webpackChunkName&lt;/code&gt; 这个注释来让 Webapck 使用更加有意义的命名。例子：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token comment&quot;&gt;/* webpackChunkName: &quot;module-name&quot; */&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;path-to-bundle&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;最终产生的文件为 &lt;code class=&quot;language-text&quot;&gt;module-name.bundle.js&lt;/code&gt;（这里假设在 Webpack 中配置了 &lt;code class=&quot;language-text&quot;&gt;output.filename&lt;/code&gt; 为 &lt;code class=&quot;language-text&quot;&gt;[name].bundle.js&lt;/code&gt;）。&lt;/p&gt;
&lt;p&gt;然而，每次要手写这样的注释有些麻烦。如果动态加载的模块本身存放位置有规律可循（比如是在 pages 目录下，每个目录有一个入口文件），那么也可以考虑使用 Babel 插件的方式，自动为每个 &lt;code class=&quot;language-text&quot;&gt;import()&lt;/code&gt; 增加合适的 bundle name。&lt;/p&gt;
&lt;p&gt;参考代码如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;addComments&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;arg&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// only add leading comment when not found&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;arg&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;leadingComments&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  arg&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;leadingComments &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    type&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;CommentBlock&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    value&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;` webpackChunkName: &apos;&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;name&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos; `&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getChunkNameFromImportPath&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;importPath&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// find a way to transform from import path to chunk name&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// example: from &apos;path/to/file&apos; to &apos;path.to.file&apos; as chunk name&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; importPath&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;replace&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token regex&quot;&gt;/\//g&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;.&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

module&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function-variable function&quot;&gt;exports&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;babel&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; types&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; t &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; babel&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    name&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;add-bundle-name&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    visitor&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token function-variable function&quot;&gt;CallExpression&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; node &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; path&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;t&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isImport&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;node&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;callee&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;firstArg&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; node&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;arguments&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; importPath &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; firstArg&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;value&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;addComments&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;firstArg&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getChunkNameFromImportPath&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;importPath&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[Execute Bash in Docker]]></title><link>https://laysent.github.io/til/2019/07#2019-07-25</link><guid isPermaLink="false">https://laysent.github.io/til/2019/07#2019-07-25</guid><pubDate>Thu, 25 Jul 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;在 Docker 开发的过程中，有时会有脚本出错，导致执行结果不及预期的情况。这种错误有时是环境导致的，在非 Docker 环境下无法重现。如果需要通过构建 Docker 添加诸如日志之类的信息来了解具体可能出错的原因，不免有些曲折。可以考虑直接在 Docker 环境下运行 Bash 命令，通过执行脚本中的语句，来查找可能出现问题的原因。&lt;/p&gt;
&lt;p&gt;要在 Docker 环境下执行 Bash 脚本，可以遵循以下的步骤：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;首先，需要知道当前运行 Docker 的容器 ID&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;docker container &lt;span class=&quot;token function&quot;&gt;ls&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;上述命令会列出所有的容器，找到需要调试的那一个即可。&lt;/p&gt;
&lt;ol start=&quot;2&quot;&gt;
&lt;li&gt;在该容器环境内执行 Bash 命令&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;docker &lt;span class=&quot;token function&quot;&gt;exec&lt;/span&gt; -ti xxx /bin/bash&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这里，&lt;code class=&quot;language-text&quot;&gt;xxx&lt;/code&gt; 就是第一步找到的 Container ID。上述命令用到了两个参数，&lt;code class=&quot;language-text&quot;&gt;-t&lt;/code&gt; 和 &lt;code class=&quot;language-text&quot;&gt;-i&lt;/code&gt;。&lt;code class=&quot;language-text&quot;&gt;-t&lt;/code&gt; 是 &lt;code class=&quot;language-text&quot;&gt;--tty&lt;/code&gt; 的缩写，用于让 Docker 将用户的终端和 stdin/stdout 关联起来；&lt;code class=&quot;language-text&quot;&gt;-i&lt;/code&gt; 是 &lt;code class=&quot;language-text&quot;&gt;--interactive&lt;/code&gt; 的缩写，用于让 Docker 在执行命令的时候允许用户进行交互式的输入输出。&lt;/p&gt;
&lt;p&gt;如果只是希望执行一个语句并输出结果（比如 &lt;code class=&quot;language-text&quot;&gt;echo&lt;/code&gt; 一个字符串），那么 &lt;code class=&quot;language-text&quot;&gt;-t&lt;/code&gt; 就足够了，不需要 &lt;code class=&quot;language-text&quot;&gt;-i&lt;/code&gt;。但是对于需要在 Docker 环境下输入 Bash 命令并检查执行结果的情况来说，&lt;code class=&quot;language-text&quot;&gt;-i&lt;/code&gt; 就是必须的。&lt;/p&gt;
&lt;p&gt;一个输出 Hello World 的简单例子：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;docker &lt;span class=&quot;token function&quot;&gt;exec&lt;/span&gt; -t &lt;span class=&quot;token keyword&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;hello world&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;另外，可以通过如下的命令知道，&lt;code class=&quot;language-text&quot;&gt;docker exec&lt;/code&gt; 运行的默认环境是在 &lt;code class=&quot;language-text&quot;&gt;/&lt;/code&gt; 下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;docker &lt;span class=&quot;token function&quot;&gt;exec&lt;/span&gt; -t &lt;span class=&quot;token function&quot;&gt;pwd&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;# output: /&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如需修改这一默认行为，可以通过 &lt;code class=&quot;language-text&quot;&gt;-w&lt;/code&gt; 参数（或 &lt;code class=&quot;language-text&quot;&gt;--workdir&lt;/code&gt;）来执行：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;docker &lt;span class=&quot;token function&quot;&gt;exec&lt;/span&gt; -w /root -t xxx &lt;span class=&quot;token function&quot;&gt;pwd&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;# output: /root&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[Alpine Mirror]]></title><link>https://laysent.github.io/til/2019/07#2019-07-24</link><guid isPermaLink="false">https://laysent.github.io/til/2019/07#2019-07-24</guid><pubDate>Wed, 24 Jul 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Alpine 是 Docker 中非常流行的镜像，因为它体积小（5 MB 左右），且包管理机制友善。然而即使体积小，一旦网络条件受到限制，使用 Alpine 安装依赖依然十分费劲。这让 Docker 镜像的安装变得非常缓慢且容易失败。&lt;/p&gt;
&lt;p&gt;假设原先的 Dockerfile 如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;dockerfile&quot;&gt;&lt;pre class=&quot;language-dockerfile&quot;&gt;&lt;code class=&quot;language-dockerfile&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; alpine&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;edge

&lt;span class=&quot;token keyword&quot;&gt;RUN&lt;/span&gt; apk update &amp;amp;&amp;amp; \
  &lt;span class=&quot;token comment&quot;&gt;# ...&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;那么可以考虑改用国内的镜像源来加速网络下载过程：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;dockerfile&quot;&gt;&lt;pre class=&quot;language-dockerfile&quot;&gt;&lt;code class=&quot;language-dockerfile&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; alpine&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;edge

&lt;span class=&quot;token keyword&quot;&gt;RUN&lt;/span&gt; echo &lt;span class=&quot;token string&quot;&gt;&apos;http://mirrors.aliyun.com/alpine/edge/community/&apos;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt; \
    /etc/apk/repositories &amp;amp;&amp;amp; \
  echo &lt;span class=&quot;token string&quot;&gt;&apos;http://mirrors.aliyun.com/alpine/edge/main/&apos;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt; \
    /etc/apk/repositories &amp;amp;&amp;amp; \
  apk update &amp;amp;&amp;amp; \
  &lt;span class=&quot;token comment&quot;&gt;# ...&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;除了上面提到的&lt;a href=&quot;https://mirrors.aliyun.com/alpine/&quot;&gt;阿里镜像&lt;/a&gt;之外，&lt;a href=&quot;https://mirrors.tuna.tsinghua.edu.cn/alpine/&quot;&gt;清华&lt;/a&gt;、&lt;a href=&quot;https://mirrors.nju.edu.cn/alpine/&quot;&gt;南大&lt;/a&gt;、&lt;a href=&quot;https://mirrors.ustc.edu.cn/alpine/&quot;&gt;中科大&lt;/a&gt;等镜像也可以考虑。更多镜像及其对应的网络状态可以在&lt;a href=&quot;https://mirrors.alpinelinux.org/&quot;&gt;这里&lt;/a&gt;找到。&lt;/p&gt;
&lt;p&gt;注意使用的镜像版本必须与 Docker 需要使用的版本保持一致。如上例中，Docker 需要基于 &lt;code class=&quot;language-text&quot;&gt;alpine:edge&lt;/code&gt;，那么在设置镜像的使用，也应该使用 &lt;code class=&quot;language-text&quot;&gt;edge&lt;/code&gt; 的版本（在 URL 中可以找到 &lt;code class=&quot;language-text&quot;&gt;/alpine/edge/&lt;/code&gt;）。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Docker Installation]]></title><link>https://laysent.github.io/til/2019/07#2019-07-23</link><guid isPermaLink="false">https://laysent.github.io/til/2019/07#2019-07-23</guid><pubDate>Tue, 23 Jul 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;以下介绍一些系统上安装 Docker 的步骤。&lt;/p&gt;
&lt;section&gt;&lt;h2&gt;Raspberry Pi&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;安装一些前置依赖&lt;/li&gt;
&lt;/ol&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;apt-get&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; \
  apt-transport-https ca-certificates software-properties-common -y&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start=&quot;2&quot;&gt;
&lt;li&gt;安装 Docker&lt;/li&gt;
&lt;/ol&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;curl&lt;/span&gt; -fsSL get.docker.com -o get-docker.sh &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; sh get-docker.sh&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;这里直接使用了 &lt;a href=&quot;http://get-docker.sh&quot;&gt;get-docker.sh&lt;/a&gt; 提供的安装脚本。&lt;/p&gt;&lt;ol start=&quot;3&quot;&gt;
&lt;li&gt;让当前用户可以使用 Docker&lt;/li&gt;
&lt;/ol&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;usermod&lt;/span&gt; -aG docker pi&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start=&quot;4&quot;&gt;
&lt;li&gt;导入 Docker CPG key&lt;/li&gt;
&lt;/ol&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;curl&lt;/span&gt; https://download.docker.com/linux/raspbian/gpg&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start=&quot;5&quot;&gt;
&lt;li&gt;设置 Docker Repo 地址&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;在 &lt;code class=&quot;language-text&quot;&gt;/etc/apt/sources.list&lt;/code&gt; 中增加如下行：&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;deb https://download.docker.com/linux/raspbian/ stretch stable&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start=&quot;6&quot;&gt;
&lt;li&gt;更新系统&lt;/li&gt;
&lt;/ol&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;apt-get&lt;/span&gt; update
&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;apt-get&lt;/span&gt; upgrade&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start=&quot;7&quot;&gt;
&lt;li&gt;启动 Docker 服务&lt;/li&gt;
&lt;/ol&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;systemctl start docker.service&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/section&gt;
&lt;section&gt;&lt;h2&gt;MacOS&lt;/h2&gt;&lt;p&gt;可以直接使用 Homebrew 进行安装：&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;brew cask &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; docker&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;安装完成后，在 Application 中找到 Docker 并启动，按提示信息一步步走就可以了。&lt;/p&gt;&lt;/section&gt;
&lt;section&gt;&lt;h2&gt;运行&lt;/h2&gt;&lt;p&gt;完成后，可以试试如下的 Docker 命令，如果可以正常输出内容，安装本身就没有问题了：&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;docker info&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/section&gt;
&lt;section&gt;&lt;h2&gt;参考&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://blog.docker.com/2019/03/happy-pi-day-docker-raspberry-pi/&quot;&gt;https://blog.docker.com/2019/03/happy-pi-day-docker-raspberry-pi/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/section&gt;</content:encoded></item><item><title><![CDATA[Get Branch Name & Commit ID without Git]]></title><link>https://laysent.github.io/til/2019/07#2019-07-22</link><guid isPermaLink="false">https://laysent.github.io/til/2019/07#2019-07-22</guid><pubDate>Mon, 22 Jul 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;可以使用 Git 命令行工具获取到当前使用的分支名称，最新的 Git Commit ID 等信息。然而，在不借助 Git 命令的情况下，依然可以通过 .git 文件，找到这些信息。&lt;/p&gt;
&lt;p&gt;在 .git 文件夹中，&lt;code class=&quot;language-text&quot;&gt;HEAD&lt;/code&gt; 文件记录了当前分支的指向。文件内容 &lt;code class=&quot;language-text&quot;&gt;refs&lt;/code&gt; 后面跟着的就是分支名。这个分支名亦是一个路径，在 .git 目录下使用这个相对路径可以得到当前分支指向的头部 Commit ID。&lt;/p&gt;
&lt;p&gt;举个例子：&lt;/p&gt;
&lt;p&gt;发现 &lt;code class=&quot;language-text&quot;&gt;./.git/HEAD&lt;/code&gt; 中的内容是：&lt;code class=&quot;language-text&quot;&gt;ref: refs/heads/master&lt;/code&gt;，通过查看 &lt;code class=&quot;language-text&quot;&gt;./.git/refs/heads/master&lt;/code&gt; 文件中的内容，就可以知道当前的头部 Commit ID。同样，去除 &lt;code class=&quot;language-text&quot;&gt;refs/heads&lt;/code&gt; 之后，就可以得到当前的分支名称，即 &lt;code class=&quot;language-text&quot;&gt;master&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;对应的 Node.js 代码如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; git &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; path&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;resolve&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;process&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;cwd&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;.git&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; head &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; path&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;resolve&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;git&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;HEAD&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; ref &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; fs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;readFileSync&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;head&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;utf8&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;trim&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;substr&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;ref: &apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; commit &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; fs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;readFileSync&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;path&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;resolve&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;git&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ref&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;utf8&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;trim&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; branch &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; ref&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;substr&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;refs/heads/&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;branch&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; commit&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[CPU Usage via Nodejs]]></title><link>https://laysent.github.io/til/2019/07#2019-07-19</link><guid isPermaLink="false">https://laysent.github.io/til/2019/07#2019-07-19</guid><pubDate>Fri, 19 Jul 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;在 Node.js 中，可以通过 &lt;code class=&quot;language-text&quot;&gt;os.cpus()&lt;/code&gt; 这个函数，来了解当前状态下，计算机 CPU 的一些状态。以 MacBookPro 2019 款为例，以下是一份输出的结果：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    model&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Intel(R) Core(TM) i7-8750H CPU @ 2.20GHz&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    speed&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2200&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    times&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      user&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;239572260&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      nice&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      sys&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;133555650&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      idle&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;644681690&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      irq&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// 省略类似的其他十一个...&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;在这个返回的数组中，每一个元素代表一个 CPU 的线程。这台 MacBookPro 是六核（core）十二线程（processor），所以返回的数组长度是十二。具体来看每一个元素：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;model&lt;/code&gt;，表示了当前 CPU 的型号&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;speed&lt;/code&gt;，表示 CPU 的运算速度，单位是 MHz&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;times&lt;/code&gt; 表示 CPU 的使用情况，分别记录了一些时间（单位是毫秒）：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;user&lt;/code&gt; 表示进程在用户模式（user mode）下使用的时间；&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;nice&lt;/code&gt; 表示被调整优先级（nice）的进程在用户模式下使用的时间。这里，nice 用于表示执行的优先级，从 -20（最高优先级）到 19（最低优先级）。默认的程序，优先级是 0；（注：这是一个 Unix 特有的功能，对于 Windows 用户来说，这个值永远是 0）&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;sys&lt;/code&gt; 表示进程在内核模式下使用的时间；&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;idle&lt;/code&gt; 表示空闲的时间；&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;irq&lt;/code&gt; 表示硬中断请求花费的时间。硬中断也叫外部中断，由外部硬件产生，如鼠标、键盘等。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;有了以上的数据，就可以在 Node / Electron 程序中查看 CPU 的使用，从而对当前程序的执行情况有一个客观的了解。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[navigator.platform]]></title><link>https://laysent.github.io/til/2019/07#2019-07-18</link><guid isPermaLink="false">https://laysent.github.io/til/2019/07#2019-07-18</guid><pubDate>Thu, 18 Jul 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;navigator.platform&lt;/code&gt; 可以获取到当前浏览器所在的操作系统信息。一般来说会得到一个字符串用以表示操作系统，但某些情况下也可能会拿到空字符串（浏览器拒绝或不能给出操作系统信息）。&lt;/p&gt;
&lt;p&gt;需要注意的一点是，即使是 64 位的 Windows 操作系统，得到的结果很可能是 &lt;code class=&quot;language-text&quot;&gt;Win32&lt;/code&gt; 而不是 &lt;code class=&quot;language-text&quot;&gt;Win64&lt;/code&gt;。根据 &lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/API/NavigatorID/platform&quot;&gt;MDN&lt;/a&gt; 的数据，Internet Explorer 和 v63 前的 Firefox 会使用 &lt;code class=&quot;language-text&quot;&gt;Win64&lt;/code&gt;，其他的一般返回 &lt;code class=&quot;language-text&quot;&gt;Win32&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;综上，可以使用如下的方法检测当前是否是 Windows 系统：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; isWindows &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; navigator&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;platform&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;indexOf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Win&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;navigator.platform&lt;/code&gt; 基本没有浏览器兼容性问题，可以放心使用。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[console.count]]></title><link>https://laysent.github.io/til/2019/07#2019-07-17</link><guid isPermaLink="false">https://laysent.github.io/til/2019/07#2019-07-17</guid><pubDate>Wed, 17 Jul 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;console 中可以通过 &lt;code class=&quot;language-text&quot;&gt;console.count&lt;/code&gt; 来进行记数。&lt;/p&gt;
&lt;p&gt;简单的使用方法如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;callMe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;callMe func&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;countReset&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;callMe func&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;callMe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// output =&gt; callMe func: 1&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;callMe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// output =&gt; callMe func: 2&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;callMe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// output =&gt; callMe func: 3&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;几点说明：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;console.countReset&lt;/code&gt; 函数可以用于清空记数&lt;/li&gt;
&lt;li&gt;传递的参数可以用于标记 &lt;code class=&quot;language-text&quot;&gt;count&lt;/code&gt; 的类别，如果不传就是默认的 default&lt;/li&gt;
&lt;li&gt;不同类别之间的 &lt;code class=&quot;language-text&quot;&gt;count&lt;/code&gt; 不会共享数据&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[Detect True Encoding of File and Convert]]></title><link>https://laysent.github.io/til/2019/07#2019-07-16</link><guid isPermaLink="false">https://laysent.github.io/til/2019/07#2019-07-16</guid><pubDate>Tue, 16 Jul 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;在 Windows 上，很多文本文件并不是以 UTF-8 的格式进行存储的。比如，中文可能的存储格式是 GB2312 或是 BIG5。这导致，在其他系统中，如果直接以 UTF-8 的格式打开对应的文本文件，就会得到一串乱码。&lt;/p&gt;
&lt;p&gt;如果不知道之前是以什么格式存储的文件，这时就会有点束手无策了。&lt;/p&gt;
&lt;p&gt;一个可行的简单方法是用 VSCode 的“猜测”功能。在 VSCode 中，如果选择 &lt;code class=&quot;language-text&quot;&gt;Reopen with Encoding&lt;/code&gt;，会得到 VSCode 猜测的当前文本编码格式。如果使用新的编码重新打开文本，看到的不再是乱码，那么很可能 VSCode 就猜测正确了。一般建议再以 UTF-8 的格式保存一下，以后再次打开就不会有乱码的困扰了。&lt;/p&gt;
&lt;p&gt;然而，这个方法不适应大规模批量修改的需求。既然如此，不如直接从 VSCode 的源码入手，看看这个文本编码检测的功能是如何实现的。&lt;/p&gt;
&lt;p&gt;VSCode 相关的代码，可以在 &lt;code class=&quot;language-text&quot;&gt;src/vs/base/node/encoding.ts&lt;/code&gt; 中找到，GitHub 的代码在&lt;a href=&quot;https://github.com/microsoft/vscode/blob/HEAD/src/vs/base/node/encoding.ts&quot;&gt;这里&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;精简后的代码如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; fs &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;fs&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; jschardet &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;jschardet&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; iconv &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;iconv-lite&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;JSCHARDET_TO_ICONV_ENCODINGS&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token string&quot;&gt;&apos;ibm866&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;cp866&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token string&quot;&gt;&apos;big5&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;cp950&apos;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; fromPath &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;/path/to/read/file&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; toPath &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;/path/to/save/file&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; buffer &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; fs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;readFileSync&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;fromPath&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; encoding &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; jschardet&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;detect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;buffer&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; iconvEncoding &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;JSCHARDET_TO_ICONV_ENCODINGS&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;encoding&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt; encoding&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; content &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; iconv&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;decode&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;buffer&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; iconvEncoding&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
fs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;writeFileSync&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;filename&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; content&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;utf8&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这里主要用到了两个库，&lt;code class=&quot;language-text&quot;&gt;jschardet&lt;/code&gt; 和 &lt;code class=&quot;language-text&quot;&gt;iconv-lite&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/aadsm/jschardet&quot;&gt;jschardet&lt;/a&gt; 是 Python &lt;a href=&quot;https://github.com/chardet/chardet&quot;&gt;chardet&lt;/a&gt; 的一个 JavaScript 移植版本，用于检测当前的二进制流（Buffer）是什么类型的编码。检测的大致原理，可以在 chardet 的网站上找到（&lt;a href=&quot;https://chardet.readthedocs.io/en/latest/how-it-works.html&quot;&gt;这里&lt;/a&gt;）。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/ashtuchkin/iconv-lite&quot;&gt;iconv-lite&lt;/a&gt; 用于将二进制流转化成指定编码格式的字符串，是一个纯 JavaScript 的 &lt;code class=&quot;language-text&quot;&gt;iconv&lt;/code&gt; 库。这里 &lt;code class=&quot;language-text&quot;&gt;iconv&lt;/code&gt; 的全称是 internationalization conversion，在类 Unix 系统中，这是一个用于转换不同编码字符串的命令行工具。&lt;/p&gt;
&lt;p&gt;需要注意的是，&lt;code class=&quot;language-text&quot;&gt;iconv-lite&lt;/code&gt; 并不通过编码来区分 UTF-8 和 UTF-8 with BOM，而是通过第二个参数 &lt;code class=&quot;language-text&quot;&gt;{ addBOM }&lt;/code&gt; 来完成的。因此，转化 UTF-8 with BOM 的时候，需要稍微手动处理一下。（处理的方法可以参考 VSCode 中的相关函数，比如 &lt;code class=&quot;language-text&quot;&gt;encode&lt;/code&gt;）&lt;/p&gt;
&lt;p&gt;另外，&lt;code class=&quot;language-text&quot;&gt;jschardet&lt;/code&gt; 和 &lt;code class=&quot;language-text&quot;&gt;iconv-lite&lt;/code&gt; 对编码的命名有些不同，使用前需要转化。上面示例代码中的 &lt;code class=&quot;language-text&quot;&gt;JSCHARDET_TO_ICONV_ENCODINGS&lt;/code&gt; 就是做的这个事情。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Clone Current Tab in Chrome]]></title><link>https://laysent.github.io/til/2019/07#2019-07-15</link><guid isPermaLink="false">https://laysent.github.io/til/2019/07#2019-07-15</guid><pubDate>Mon, 15 Jul 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;在 Chrome 中，如果当前的光标在地址栏上，可以通过快捷键 &lt;code class=&quot;language-text&quot;&gt;Cmd + Enter&lt;/code&gt; 来打开一个和当前页面一样的新标签页（焦点依然在当前标签页上）。如果光标不在地址栏上，可以先使用 &lt;code class=&quot;language-text&quot;&gt;Cmd + L&lt;/code&gt; 来将光标移动到地址栏，然后再 &lt;code class=&quot;language-text&quot;&gt;Cmd + Enter&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;如果改用 &lt;code class=&quot;language-text&quot;&gt;Option + Enter&lt;/code&gt;，则可以新创建同一个 URL 地址的标签页，并将焦点定位到新打开的标签页上。&lt;/p&gt;
&lt;p&gt;如果改用 &lt;code class=&quot;language-text&quot;&gt;Shift + Enter&lt;/code&gt;，则可以在一个新窗口打开当前的 URL 地址。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Abort Git Rebase Process]]></title><link>https://laysent.github.io/til/2019/07#2019-07-14</link><guid isPermaLink="false">https://laysent.github.io/til/2019/07#2019-07-14</guid><pubDate>Sun, 14 Jul 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;在 Git 的一些操作中，可能会中途停下来，等待用户输入的操作。比如，&lt;code class=&quot;language-text&quot;&gt;git rebase -i&lt;/code&gt; 或 &lt;code class=&quot;language-text&quot;&gt;git ammend&lt;/code&gt; 的时候。在完成操作前，Git 会打开 Vim（或其他默认的编辑器）等待用户对 commit message 做最后的处理。只要用户保存并退出，rebase 的过程就完成了。&lt;/p&gt;
&lt;p&gt;如果在这个等待确认的过程中，希望可以中断整个过程，使用 &lt;code class=&quot;language-text&quot;&gt;Ctrl+C&lt;/code&gt; 是不行的。如果使用 &lt;code class=&quot;language-text&quot;&gt;Ctrl+C&lt;/code&gt;，Vim 可能会提示用 &lt;code class=&quot;language-text&quot;&gt;qa!&lt;/code&gt; 来放弃所有修改并退出 Vim。但这个只是退出了 Vim，Git 依然会继续接下来的流程，并没有真正达到中断 Git 的目的。&lt;/p&gt;
&lt;p&gt;事实上，Vim 允许以 error code 退出，使用如下的命令：&lt;code class=&quot;language-text&quot;&gt;:cq&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;更多关于这个命令的说明，可以使用  &lt;code class=&quot;language-text&quot;&gt;:help cq&lt;/code&gt; 来查看。以 error code 退出之后，Git 就不会再继续接下来的流程了。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Inspect React Node without DevTool]]></title><link>https://laysent.github.io/til/2019/07#2019-07-11</link><guid isPermaLink="false">https://laysent.github.io/til/2019/07#2019-07-11</guid><pubDate>Thu, 11 Jul 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;在 React 开发过程中，使用 Facebook 提供的官方 Chrome DevTool Extension 可以很方便的查看，修改页面上的 React 组件。然而，有时候也需要在没有 DevTool 的情况下，对 React 组件进行 Debug。比如：在测试电脑上查看一个即时出现的问题，或是在 Internet Explorer / Safari 上调试一个出现的问题等。&lt;/p&gt;
&lt;p&gt;以下介绍如何在不借助 Chrome DevTool Extension 的情况下，完成对当前 React 组件的检查。&lt;/p&gt;
&lt;p&gt;首先，需要获取到某个需要查看的 DOM 元素。可以用 &lt;code class=&quot;language-text&quot;&gt;querySelector&lt;/code&gt; 或是在 Chrome DevTool 中选中某个元素，然后在 Console 中使用 &lt;code class=&quot;language-text&quot;&gt;$0&lt;/code&gt; 获得该元素。&lt;/p&gt;
&lt;p&gt;React 会在元素上添加额外的属性，用于记录当前这个 React 节点的相关数据。可以通过下面的代码来获取这个属性数据：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getInstance&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;element&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; key &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Object&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;keys&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;element&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;filter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;key&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; key&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;startsWith&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;__reactInternalInstance$&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; element&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;React 在添加属性的时候，属性名称会增加一个随机字符串作为后缀（各个 React Node 使用的随机字符串是一致的）。所以需要通过检查 &lt;code class=&quot;language-text&quot;&gt;startsWith&lt;/code&gt; 来判断当前属性是否是 React 使用的属性。&lt;/p&gt;
&lt;p&gt;拿到的这个对象，有一些有用的数据，包括：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;child - 当前元素子元素的头个元素&lt;/li&gt;
&lt;li&gt;elementType/type - 该 React 节点对应的类型。如果是 HTML Element，那么就是一个字符串，比如 &lt;code class=&quot;language-text&quot;&gt;&amp;quot;div&amp;quot;&lt;/code&gt;；如果是一个自定义的 React 元素，则是一个函数（class 或 function）。也就是 &lt;code class=&quot;language-text&quot;&gt;React.createElement&lt;/code&gt; 函数的第一个参数。&lt;/li&gt;
&lt;li&gt;memoizedProps - 当前元素使用的 props。对于任何一个 React 生成的 HTML 元素，对会有对应的 Props。（写 JSX 的时候，每一个属性，包括 children，都是一个 Props 的属性值）&lt;/li&gt;
&lt;li&gt;memoizedState - 当前元素使用的 state&lt;/li&gt;
&lt;li&gt;return - 当前元素所在双向链表的上一个元素&lt;/li&gt;
&lt;li&gt;sibling - 当前元素下一个兄弟元素&lt;/li&gt;
&lt;li&gt;stateNode - 当前元素在组件内可以用的 &lt;code class=&quot;language-text&quot;&gt;this&lt;/code&gt;，包含了 &lt;code class=&quot;language-text&quot;&gt;props&lt;/code&gt;，&lt;code class=&quot;language-text&quot;&gt;refs&lt;/code&gt;，&lt;code class=&quot;language-text&quot;&gt;state&lt;/code&gt;，&lt;code class=&quot;language-text&quot;&gt;context&lt;/code&gt; 以及其他 React Component 的方法。在这个对象的原型链上，还有 React Component 组件的各个方法（比如生命周期函数如 &lt;code class=&quot;language-text&quot;&gt;componentDidMount&lt;/code&gt;）以及 &lt;code class=&quot;language-text&quot;&gt;setState&lt;/code&gt; 等可用方法。换句话说，这里的对象就是一个 React Component Class 生成的实例。如果组件是一个 Functional Component，那么这里就是 &lt;code class=&quot;language-text&quot;&gt;null&lt;/code&gt; 了。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;根据 React 16 中 Fiber 的设计，元素之间是一个双向链表的关系，每一个节点会连结其上一个元素（&lt;code class=&quot;language-text&quot;&gt;return&lt;/code&gt;），子元素的首个元素（&lt;code class=&quot;language-text&quot;&gt;child&lt;/code&gt;），下一个兄弟元素（&lt;code class=&quot;language-text&quot;&gt;sibling&lt;/code&gt;），因而从任意一个中间的 HTML 元素开始，都可以遍历整个 React 树。&lt;/p&gt;
&lt;p&gt;注：从一个元素 A 的 &lt;code class=&quot;language-text&quot;&gt;sibling&lt;/code&gt; 抵达下一个元素 B 后，该元素 B 的 &lt;code class=&quot;language-text&quot;&gt;return&lt;/code&gt; 是他的上一个兄弟元素，也就是 A，而不是真正意义上 React / HTML 树的父元素。只有当 B 是 A 的第一个子元素的时候，B 的 &lt;code class=&quot;language-text&quot;&gt;return&lt;/code&gt; 才是它在树上的父元素。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Trigger onChange for React Input]]></title><link>https://laysent.github.io/til/2019/07#2019-07-10</link><guid isPermaLink="false">https://laysent.github.io/til/2019/07#2019-07-10</guid><pubDate>Wed, 10 Jul 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;在 React 16 中（包括 React 15.6 及之后的版本），如果想要用 JavaScript 在外部触发一个 &lt;code class=&quot;language-text&quot;&gt;input&lt;/code&gt; 组件的 &lt;code class=&quot;language-text&quot;&gt;onChange&lt;/code&gt; 事件，需要做如下的几个事情：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;首先，让 React 记录下新的 &lt;code class=&quot;language-text&quot;&gt;value&lt;/code&gt; 值。React 通过 &lt;code class=&quot;language-text&quot;&gt;defineProperty&lt;/code&gt; 封装了 &lt;code class=&quot;language-text&quot;&gt;value&lt;/code&gt; 的 &lt;code class=&quot;language-text&quot;&gt;set&lt;/code&gt; 方法，因而直接调用 &lt;code class=&quot;language-text&quot;&gt;input.value = xxx&lt;/code&gt; 并不能达到预期的效果（实际触发的是 React 封装的 setter，而不是实际 DOM 的 setter）。为此，可以使用如下的方法绕过去：&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; input &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; document&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;querySelector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;.xxx&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; originalSetter &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  Object&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getOwnPropertyDescriptor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;HTMLInputElement&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;prototype&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;value&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;set&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;originalSetter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;call&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;input&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;your value here&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ol start=&quot;2&quot;&gt;
&lt;li&gt;其次，需要触发一次 &lt;code class=&quot;language-text&quot;&gt;onChange&lt;/code&gt; 的事件，好让 React 的组件可以在原来既定的回调函数中处理新的数据：&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; event &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Event&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;input&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; bubbles&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
input&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;dispatchEvent&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;event&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;以下是一个完整可用的方法：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;change&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;input&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; value&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; setter &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
    Object&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getOwnPropertyDescriptor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;HTMLInputElement&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;prototype&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;value&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;set&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;setter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;call&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;input&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; value&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; event &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Event&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;input&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; bubbles&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  input&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;dispatchEvent&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;event&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[Object Spread and Proxy]]></title><link>https://laysent.github.io/til/2019/07#2019-07-09</link><guid isPermaLink="false">https://laysent.github.io/til/2019/07#2019-07-09</guid><pubDate>Tue, 09 Jul 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;a href=&quot;http://www.ecma-international.org/ecma-262/9.0/#sec-object-initializer&quot;&gt;ES2018&lt;/a&gt; 增加了 Object Spread 操作符的官方支持。Object Spread 操作符和 &lt;code class=&quot;language-text&quot;&gt;Object.assign&lt;/code&gt; 的一些区别，可以参考&lt;a href=&quot;https://2ality.com/2016/10/rest-spread-properties.html#spread-defines-properties-objectassign-sets-them&quot;&gt;这篇文章&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;在 JavaScript 执行 Object Spread 操作符的时候，需要进行如下的几步操作：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;确定对象有哪些自己的属性。原型链上的部分是不会被 Object Spread 操作符接收的，举个例子：&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; obj &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Object&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;create&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; parent&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    current&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      enumerable&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      value&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;obj &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// output =&gt; { current: 2 }&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ol start=&quot;2&quot;&gt;
&lt;li&gt;确定第一步拿到的属性中，有那些是可枚举的（enumerable）。不可枚举的部分，不会被接收，举个例子：&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; obj &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Object&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;create&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; parent&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    current&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      enumerable&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      value&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;obj &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// output =&gt; { }&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ol start=&quot;3&quot;&gt;
&lt;li&gt;分别获取到这些属性的值&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;根据以上的规则，现在可以考虑这样一个场景：假设需要一个 Proxy 来修改访问对象属性的行为，比如对对象任意属性的取值，都从它的某一个子属性中去拿。例子：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; obj &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; key&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;value&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; child&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; key&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;inner-value&apos;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; handler &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;/* todo */&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; proxy &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Proxy&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;obj&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; handler&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;proxy&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// =&gt; output: inner-value&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这里的 handler 并不难写，只需要：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; handler &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;target&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; key&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; target&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;child&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// or:&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// return Reflect.get(target.child, key);&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;现在，如果需要 Proxy 也同样可以支持 Object Spread 的功能，那么就需要对 &lt;code class=&quot;language-text&quot;&gt;handler&lt;/code&gt; 做更多的处理。从上面的分析来看，第一步获取自有属性，需要用到 &lt;code class=&quot;language-text&quot;&gt;ownKeys&lt;/code&gt;；第二步获取可枚举属性，需要用到 &lt;code class=&quot;language-text&quot;&gt;getOwnPropertyDescriptor&lt;/code&gt;；最后一步获得属性值，依然需要 &lt;code class=&quot;language-text&quot;&gt;get&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;代码如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; obj &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; key&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;value&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; child&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; key&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;inner-value&apos;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; handler &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;target&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; key&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; Reflect&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;target&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;child&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; key&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;ownKeys&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;target&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; Reflect&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;ownKeys&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;target&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;child&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;getOwnPropertyDescriptor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;target&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; Reflect&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getOwnPropertyDescriptor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;target&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;child&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; key&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; proxy &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Proxy&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;obj&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; handler&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;proxy &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// =&gt; output: { key: &apos;inner-value&apos; }&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[git rev-parse]]></title><link>https://laysent.github.io/til/2019/07#2019-07-08</link><guid isPermaLink="false">https://laysent.github.io/til/2019/07#2019-07-08</guid><pubDate>Mon, 08 Jul 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;rev-parse&lt;/code&gt; 并不是 Git 中一个不常用的命令。Git 的一些命令底层会使用 &lt;code class=&quot;language-text&quot;&gt;rev-parse&lt;/code&gt; 来处理输入的参数。&lt;/p&gt;
&lt;p&gt;通过 &lt;code class=&quot;language-text&quot;&gt;rev-parse&lt;/code&gt; 可以获得一些有用的 Git 数据，比如：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;获取当前的 commit id&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;git&lt;/span&gt; rev-parse HEAD&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;获取当前的分支名&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;git&lt;/span&gt; rev-parse --symbolic-full-name --abbrev-ref HEAD&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[Derive Union Type from Tuple/Array]]></title><link>https://laysent.github.io/til/2019/07#2019-07-04</link><guid isPermaLink="false">https://laysent.github.io/til/2019/07#2019-07-04</guid><pubDate>Thu, 04 Jul 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;在 TypeScript 中，如果希望一个变量只能取某几个固定值中的一个，可以这么写：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; Type &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;a&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;b&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; a&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Type &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;a&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// ✔&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; c&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Type &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;c&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// ✖&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;然而，在实际的开发过程中，可能会遇到这样的需求：希望 TypeScript 可以限定某一个类型只能取某几个固定的值，同时这几个值又可以组成一个数组，方便 JavaScript 在运行时动态的执行匹配功能（如 &lt;code class=&quot;language-text&quot;&gt;Array.prototype.some&lt;/code&gt;）。&lt;/p&gt;
&lt;p&gt;如果直接尝试在 TypeScript 中写数组，实际无法达到预想的效果：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; list &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;a&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;b&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; Type &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; list&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;number&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// Type = string&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这是因为，TypeScript 默认 &lt;code class=&quot;language-text&quot;&gt;list&lt;/code&gt; 的类型是 &lt;code class=&quot;language-text&quot;&gt;string[]&lt;/code&gt;，而不是 &lt;code class=&quot;language-text&quot;&gt;(&amp;#39;a&amp;#39; | &amp;#39;b&amp;#39;)[]&lt;/code&gt;。因此，在转化成 &lt;code class=&quot;language-text&quot;&gt;Type&lt;/code&gt; 的时候，得到的结果是更宽泛的字符串类型，而不是限定死的两个固定值。这其中，一个很重要的原因是 JavaScript 语言的动态性。数组随时可以被加入/删除元素，因而默认只能假设这是一个字符串类型的数组，而不能过多约束。&lt;/p&gt;
&lt;p&gt;为了达到目的，有以下几个变通的写法：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; list&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;a&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;b&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;a&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;b&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; Type &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; list&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;number&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// Type = &apos;a&apos; | &apos;b&apos;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这种写法比较啰嗦，重新写了一遍完整的数组用于定死类型的选择范围。&lt;/p&gt;
&lt;p&gt;也可以通过写一个辅助函数来达到类似的效果：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;declare&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; tupleStr&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;T&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;args&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;T&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; list &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;tupleStr&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;a&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;b&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; Type &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; list&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;number&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// Type = &apos;a&apos; | &apos;b&apos;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;在 Ant Design 中可以找到&lt;a href=&quot;https://github.com/ant-design/ant-design/blob/65eb713fe897f65bbf187e215c664e5f9b468252/components/_util/type.ts#L5&quot;&gt;类似的写法&lt;/a&gt;。这里也有一个类似的 &lt;a href=&quot;https://gist.github.com/jcalz/381562d282ebaa9b41217d1b31e2c211&quot;&gt;gist&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;注：上述这种写法需要 TypeScript 3.0 的&lt;a href=&quot;https://github.com/Microsoft/TypeScript/pull/24897&quot;&gt;支持&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;当然，上述的方案或多或少都需要额外写一些东西，有些麻烦。在 TypeScript 3.4 中，可以通过 &lt;code class=&quot;language-text&quot;&gt;as const&lt;/code&gt; 这个语法来告知 TypeScript 数组是静态的、并不会增加或者减少内容。有了这样的前提假设，TypeScript 就可以更好的进行类型推导，把实际的类型结果限制到已知的几个有限的值范围内。例子如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; list1 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;a&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;b&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; list2 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;a&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;b&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; Type1 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; list1&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;number&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; Type2 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; list2&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;number&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;上述两种写法是等价的（参考&lt;a href=&quot;https://github.com/Microsoft/TypeScript/pull/29510&quot;&gt;这里&lt;/a&gt;），都可以达到目的。另外，由于在 TypeScript 中限制了数组，之后想要在数组中做改动都是会导致编译器报错的。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://stackoverflow.com/questions/45251664/typescript-derive-union-type-from-tuple-array-values&quot;&gt;参考&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Command `tldr`]]></title><link>https://laysent.github.io/til/2019/07#2019-07-03</link><guid isPermaLink="false">https://laysent.github.io/til/2019/07#2019-07-03</guid><pubDate>Wed, 03 Jul 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;tldr&lt;/code&gt; 是一个社区维护的命令工具，可以用于输出某一个命令的说明文档。相比于 &lt;code class=&quot;language-text&quot;&gt;man&lt;/code&gt; 详尽的文档，&lt;code class=&quot;language-text&quot;&gt;tldr&lt;/code&gt; 更侧重于例子。通过具体的使用场景，介绍该命令一些常用的方法。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;tldr&lt;/code&gt; 相关的一些链接地址：&lt;a href=&quot;https://github.com/tldr-pages/tldr&quot;&gt;GitHub&lt;/a&gt;，&lt;a href=&quot;https://tldr.sh/&quot;&gt;官方网站&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;安装 &lt;code class=&quot;language-text&quot;&gt;tldr&lt;/code&gt; 可以使用 &lt;code class=&quot;language-text&quot;&gt;brew&lt;/code&gt;：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;brew &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; tldr&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;比如，需要了解 &lt;code class=&quot;language-text&quot;&gt;tar&lt;/code&gt; 的使用方法，可以运行下面的命令：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;tldr &lt;span class=&quot;token function&quot;&gt;tar&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;运行的结果如下：&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/afb42628221addee006643b75e3c5988/04a72/2019-07-03-tldr-screenshot.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 74.28571428571428%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsSAAALEgHS3X78AAABrklEQVQ4y5WTaVLrQAyEc554t2dfnUDgwf3v00+SYyoUAcKPrvEkVe2v1fLBBw/jNKZpwrFp0HXdF7Vte/f3ezo452CMxjiOmOcZfd+jIeOmbcSoub6Enx8xPtRa8f7+hsvlGW//XlFLgTUGgcitNXDW/o2QqVJyyDWinDLyVetzhQ8Oy7L80ZBmF6xCjB55zQjJI+QAR2ZMyIa3sR8yTN4gR4fTZRXKtCY4Z6GVkviKzubG7CfjA7frrN5EpiF7KckTqYsWnu5c2F7KbvadKc2QCB0RUsx6rogc2Vs8vZwxLRNmvTXf9d2m3wjZsBBZYcOnKrFjDZjUhMUsUDRf7Uheix4yTMEikSnPrp6LxGay3VDZ7eT7x0527felRJpZopipJBRqOhJtP/YYpgHjPIokvpo/Ed7OdZeUEqhlnhsTRtpHLoIpPVFvd9rHK6Gi+K44OXWgIrOFCQYmGrmLYTS0h1RMWQtRRlnolKMo0H5qSsCFcDn9QOSkj+dxkHOXfClcykokp8tJvhCOxjOcSMfjURb7Xry7kcdhRN+0GDp+84CB3ix/Npse/eR2/Qc7FNr+H6tgOQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;tldr command result&quot;
        title=&quot;&quot;
        src=&quot;/static/afb42628221addee006643b75e3c5988/b9e4f/2019-07-03-tldr-screenshot.png&quot;
        srcset=&quot;/static/afb42628221addee006643b75e3c5988/cf440/2019-07-03-tldr-screenshot.png 148w,
/static/afb42628221addee006643b75e3c5988/d2d38/2019-07-03-tldr-screenshot.png 295w,
/static/afb42628221addee006643b75e3c5988/b9e4f/2019-07-03-tldr-screenshot.png 590w,
/static/afb42628221addee006643b75e3c5988/04a72/2019-07-03-tldr-screenshot.png 840w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;注：&lt;code class=&quot;language-text&quot;&gt;tldr&lt;/code&gt; 的全称是 Too Long; Don’t Read。可以理解成“摘要”的意思。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Array.from]]></title><link>https://laysent.github.io/til/2019/07#2019-07-02</link><guid isPermaLink="false">https://laysent.github.io/til/2019/07#2019-07-02</guid><pubDate>Tue, 02 Jul 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Array.from&lt;/code&gt; 是 JavaScript 中一个较新的 API，可以将一个类数组或可迭代对象转化成一个真正的数组。&lt;/p&gt;
&lt;p&gt;类数组（array-like）常见于 DOM API 中取到的数据，比如 &lt;code class=&quot;language-text&quot;&gt;.querySelectorAll&lt;/code&gt;。得到的结果有 &lt;code class=&quot;language-text&quot;&gt;.length&lt;/code&gt; 属性，也可以通过下标获取到数据，但是本身却不是一个数组，没有 &lt;code class=&quot;language-text&quot;&gt;Array.prototype&lt;/code&gt; 上的 API 可以直接用。&lt;/p&gt;
&lt;p&gt;可迭代对象则是指那些定义了 &lt;code class=&quot;language-text&quot;&gt;Symbol.iterator&lt;/code&gt; 属性的对象。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Array.from&lt;/code&gt; 可以将上述的两种对象直接转化成一个标准的数组：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; iterable &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Symbol&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;iterator&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;yield&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;yield&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Array&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;iterable&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// =&gt; [1, 2];&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; arrayLike &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; document&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;querySelectorAll&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;span&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Array&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;arrayLike&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// =&gt; [span, span, ...]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;除了上述常见的应用之外，&lt;code class=&quot;language-text&quot;&gt;Array.from&lt;/code&gt; 还有一些特殊的应用。&lt;/p&gt;
&lt;p&gt;首先，只要指定了 &lt;code class=&quot;language-text&quot;&gt;length&lt;/code&gt; 属性，&lt;code class=&quot;language-text&quot;&gt;Array.from&lt;/code&gt; 就可以创建一个数组。这一行为可以用来创建一个指定长度的数组：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;Array&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; length&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;_&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; i&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; i&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// =&gt; [0, 1, 2, 3, 4]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;其次，&lt;code class=&quot;language-text&quot;&gt;Array.from&lt;/code&gt; 函数其实接受不止一个参数。第二个参数是一个 map 函数，第三个参数是 &lt;code class=&quot;language-text&quot;&gt;thisArg&lt;/code&gt;，用于指定 map 函数的 &lt;code class=&quot;language-text&quot;&gt;this&lt;/code&gt; 对象。有了这个 map 函数的支持，上面这个例子就可以进一步改写成：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;Array&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; length&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;_&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; i&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; i&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;在转化 DOM 类数组的时候，直接通过指定 map 函数进行进一步的转化，是比较方便的。可以省略一个 &lt;code class=&quot;language-text&quot;&gt;.map&lt;/code&gt; 函数的嵌套，也节省一个中间数组对象的创建。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Array.prototype.map&lt;/code&gt; 函数可以指定 &lt;code class=&quot;language-text&quot;&gt;thisArg&lt;/code&gt;，在 &lt;code class=&quot;language-text&quot;&gt;Array.from&lt;/code&gt; 中也可以通过第三个参数指定 &lt;code class=&quot;language-text&quot;&gt;thisArg&lt;/code&gt;。以下是一个例子：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; mapper &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  shift&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;_&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; i&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;shift &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; i&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
Array&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; length&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; mapper&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;run&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; mapper&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// =&gt; [1, 2, 3, 4, 5];&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;上述写法等价于：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;Array&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; length&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;mapper&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;run&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; mapper&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[object-fit]]></title><link>https://laysent.github.io/til/2019/07#2019-07-01</link><guid isPermaLink="false">https://laysent.github.io/til/2019/07#2019-07-01</guid><pubDate>Mon, 01 Jul 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;object-fit&lt;/code&gt; 这个 CSS 样式，是针对&lt;strong&gt;可替换元素&lt;/strong&gt;（replaced element）设计的。一般来说，常见的可替换元素包含图片（&lt;code class=&quot;language-text&quot;&gt;img&lt;/code&gt;）或是视频（&lt;code class=&quot;language-text&quot;&gt;video&lt;/code&gt;）。这些可替换元素的大小是事先不确定的，在实际展示的时候，需要一定的规则来决定元素实际如何被放置到元素框中去。&lt;/p&gt;
&lt;p&gt;以下是几种 &lt;code class=&quot;language-text&quot;&gt;object-fit&lt;/code&gt; 的值及对应的显示效果（每种类型显示两个图片，第一张图片的原始尺寸大于元素显示的尺寸，第二张图片的原始尺寸小于元素显示的尺寸）：&lt;/p&gt;
&lt;style&gt;
p.container-2019-07-01 {
  display: flex;
  justify-content: center;
}
p.container-2019-07-01 a {
  box-shadow: none;
}
p.container-2019-07-01 a img {
  width: 500px;
  height: 400px;
  border: 3px solid red;
  display: block;
}
&lt;/style&gt;
&lt;section&gt;&lt;h2&gt;fill&lt;/h2&gt;&lt;p class=&quot;container-2019-07-01&quot;&gt;
  &lt;a href=&quot;../../baseline-jpeg-demo.jpeg&quot; target=&quot;_blank&quot;&gt;
    &lt;img src=&quot;../../baseline-jpeg-demo.jpeg&quot; title=&quot;big image&quot; alt=&quot;big image&quot; style=&quot;object-fit:fill&quot; /&gt;
  &lt;/a&gt;
&lt;/p&gt;
&lt;p class=&quot;container-2019-07-01&quot;&gt;
  &lt;a href=&quot;../../favicon.ico&quot; target=&quot;_blank&quot;&gt;
    &lt;img src=&quot;../../favicon.ico&quot; title=&quot;small image&quot; alt=&quot;small image&quot; style=&quot;object-fit:fill&quot; /&gt;
  &lt;/a&gt;
&lt;/p&gt;&lt;ul&gt;
&lt;li&gt;宽高比例：不保持&lt;/li&gt;
&lt;li&gt;显示范围：占满元素&lt;/li&gt;
&lt;li&gt;可能影响：显示结果宽高比失真；显示结果比原始尺寸大&lt;/li&gt;
&lt;/ul&gt;&lt;/section&gt;
&lt;section&gt;&lt;h2&gt;contain&lt;/h2&gt;&lt;p class=&quot;container-2019-07-01&quot;&gt;
  &lt;a href=&quot;../../baseline-jpeg-demo.jpeg&quot; target=&quot;_blank&quot;&gt;
    &lt;img src=&quot;../../baseline-jpeg-demo.jpeg&quot; title=&quot;big image&quot; alt=&quot;big image&quot; style=&quot;object-fit:contain&quot; /&gt;
  &lt;/a&gt;
&lt;/p&gt;
&lt;p class=&quot;container-2019-07-01&quot;&gt;
  &lt;a href=&quot;../../favicon.ico&quot; target=&quot;_blank&quot;&gt;
    &lt;img src=&quot;../../favicon.ico&quot; title=&quot;small image&quot; alt=&quot;small image&quot; style=&quot;object-fit:contain&quot; /&gt;
  &lt;/a&gt;
&lt;/p&gt;&lt;ul&gt;
&lt;li&gt;宽高比例：保持&lt;/li&gt;
&lt;li&gt;显示范围：至少一轴占满，整体（另一轴）不超过元素&lt;/li&gt;
&lt;li&gt;可能影响：出现黑边（&lt;a href=&quot;https://en.wikipedia.org/wiki/Letterboxing_(filming)&quot;&gt;letterboxed&lt;/a&gt;）；显示结果比原始尺寸大&lt;/li&gt;
&lt;/ul&gt;&lt;/section&gt;
&lt;section&gt;&lt;h2&gt;cover&lt;/h2&gt;&lt;p class=&quot;container-2019-07-01&quot;&gt;
  &lt;a href=&quot;../../baseline-jpeg-demo.jpeg&quot; target=&quot;_blank&quot;&gt;
    &lt;img src=&quot;../../baseline-jpeg-demo.jpeg&quot; title=&quot;big image&quot; alt=&quot;big image&quot; style=&quot;object-fit:cover&quot; /&gt;
  &lt;/a&gt;
&lt;/p&gt;
&lt;p class=&quot;container-2019-07-01&quot;&gt;
  &lt;a href=&quot;../../favicon.ico&quot; target=&quot;_blank&quot;&gt;
    &lt;img src=&quot;../../favicon.ico&quot; title=&quot;small image&quot; alt=&quot;small image&quot; style=&quot;object-fit:cover&quot; /&gt;
  &lt;/a&gt;
&lt;/p&gt;&lt;ul&gt;
&lt;li&gt;宽高比例：保持&lt;/li&gt;
&lt;li&gt;显示范围：至少一轴占满，整体（另一轴）可以超过元素&lt;/li&gt;
&lt;li&gt;可能影响：超出显示范围；显示结果比原始尺寸大&lt;/li&gt;
&lt;/ul&gt;&lt;/section&gt;
&lt;section&gt;&lt;h2&gt;none&lt;/h2&gt;&lt;p class=&quot;container-2019-07-01&quot;&gt;
  &lt;a href=&quot;../../baseline-jpeg-demo.jpeg&quot; target=&quot;_blank&quot;&gt;
    &lt;img src=&quot;../../baseline-jpeg-demo.jpeg&quot; title=&quot;big image&quot; alt=&quot;big image&quot; style=&quot;object-fit:none&quot; /&gt;
  &lt;/a&gt;
&lt;/p&gt;
&lt;p class=&quot;container-2019-07-01&quot;&gt;
  &lt;a href=&quot;../../favicon.ico&quot; target=&quot;_blank&quot;&gt;
    &lt;img src=&quot;../../favicon.ico&quot; title=&quot;small image&quot; alt=&quot;small image&quot; style=&quot;object-fit:none&quot; /&gt;
  &lt;/a&gt;
&lt;/p&gt;&lt;ul&gt;
&lt;li&gt;宽高比例：保持&lt;/li&gt;
&lt;li&gt;显示范围：原始尺寸&lt;/li&gt;
&lt;li&gt;可能影响：超出显示范围&lt;/li&gt;
&lt;/ul&gt;&lt;/section&gt;
&lt;section&gt;&lt;h2&gt;scale-down&lt;/h2&gt;&lt;p class=&quot;container-2019-07-01&quot;&gt;
  &lt;a href=&quot;../../baseline-jpeg-demo.jpeg&quot; target=&quot;_blank&quot;&gt;
    &lt;img src=&quot;../../baseline-jpeg-demo.jpeg&quot; title=&quot;big image&quot; alt=&quot;big image&quot; style=&quot;object-fit:scale-down&quot; /&gt;
  &lt;/a&gt;
&lt;/p&gt;
&lt;p class=&quot;container-2019-07-01&quot;&gt;
  &lt;a href=&quot;../../favicon.ico&quot; target=&quot;_blank&quot;&gt;
    &lt;img src=&quot;../../favicon.ico&quot; title=&quot;small image&quot; alt=&quot;small image&quot; style=&quot;object-fit:scale-down&quot; /&gt;
  &lt;/a&gt;
&lt;/p&gt;&lt;p&gt;使用 &lt;code class=&quot;language-text&quot;&gt;none&lt;/code&gt; 或者 &lt;code class=&quot;language-text&quot;&gt;contain&lt;/code&gt; 的规则进行显示。具体选择哪个规则，要看两个规则生成的最终效果，哪一个更小。换句话说，如果元素的原始尺寸两轴都小于元素的显示范围，就使用 &lt;code class=&quot;language-text&quot;&gt;none&lt;/code&gt; 进行显示，显示结果是原始元素的原始尺寸；否则就是用 &lt;code class=&quot;language-text&quot;&gt;contain&lt;/code&gt; 的方式进行显示，用黑边的方式将元素压缩到显示范围内完整显示。&lt;/p&gt;&lt;/section&gt;</content:encoded></item><item><title><![CDATA[Draw Math Equation]]></title><link>https://laysent.github.io/til/2019/06#2019-06-30</link><guid isPermaLink="false">https://laysent.github.io/til/2019/06#2019-06-30</guid><pubDate>Sun, 30 Jun 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;a href=&quot;https://www.desmos.com/calculator&quot;&gt;desmos&lt;/a&gt; 是一个在线的网站，可以用于绘制数学表达式对应的函数图像。&lt;/p&gt;
&lt;p&gt;生成的结果可以通过链接分享，也可以生成 PNG 格式的图片下载到本地。&lt;/p&gt;
&lt;p&gt;以下是一个例子：&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/8e68ad8bbebf7e4cb6b0be8fc408023d/8ff1e/2019-06-30-desmos-graph.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsSAAALEgHS3X78AAACmklEQVQ4y41U2W7TQBTN/38C4qWAStNstPACEryCQKSqVJoFozTx1ixOHK/jJT3cO/ZYk1IED1ee8dx75tzlTCvPc+iWpimKhwd4377C6pzBvhjg+vkz3PU6sGnvDb+jBJAmCbIsQ1kUSNIM1jpAQesWg/ABmwQkx5wC/NsfsM7P4L69wLx7jjsym0D98RgFnScx+eUZgQmYqwCpEDiU5V8AywMiy4Td78K5fFMBdtpwBj1EroP8cEAmUsQJga0ZLENBsQ3DxynndCDCEPagD5dSXhAzCUjgIopQHkpExNBc7SGISFFUpEpmKIgqg7DxOo7jak9M3Q/vYRHL6ekr/CK7//SRfFICSzFzPAmaafEM2lLpKksISDBLasxGNqYNo/0axssT+NdXSKgc5tKXYDn5izqOyRw1RU+Zb+XCh7OZbMSi38OcQP35AtYukcHsI7S4JuU/mlKnzmuul/PuksBOYXS7MO/9pgFJfbGenWTIqLxQpoBl15jl7Q2MFycYfRnSfILmLj/202IP1P3Wfr8HWxAE0nzfR/UvQBSF2O18XH0ewl0uERNj5bvb7Y7i1Lo1nU5hWVZzYJom7W1ENDYbbwvDXGH804Dr2M2F/HUcR5r6xzYajaouK+qcPteGFSCyHPYmlDMZBlUWnJJKT9T101NmnKOmSONZZAXQ0KYkK9YqgzEDVTs2NXe6NV2uQHMZfKSAmnlU105vhgLUVdYoRY0Ag+kKSOoRsm0bnuc1zJSiWARKJUdK4ZqpNB8rgM11XdlVvXZSUdocNkqp3rPq1RB1DZUCVNH/J+Wmhvw4Vu9Z9WrojgpQjca/ACVDa109jkX9U9VIl+N2u30SUDwlPSmZWn5MWZ8t3nPgZDKRLNUc6n66dPn8Nwam94/N3nKrAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;desmos-graph&quot;
        title=&quot;&quot;
        src=&quot;/static/8e68ad8bbebf7e4cb6b0be8fc408023d/b9e4f/2019-06-30-desmos-graph.png&quot;
        srcset=&quot;/static/8e68ad8bbebf7e4cb6b0be8fc408023d/cf440/2019-06-30-desmos-graph.png 148w,
/static/8e68ad8bbebf7e4cb6b0be8fc408023d/d2d38/2019-06-30-desmos-graph.png 295w,
/static/8e68ad8bbebf7e4cb6b0be8fc408023d/b9e4f/2019-06-30-desmos-graph.png 590w,
/static/8e68ad8bbebf7e4cb6b0be8fc408023d/8ff1e/2019-06-30-desmos-graph.png 800w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;对应的在线观看地址：&lt;a href=&quot;https://www.desmos.com/calculator/zthodlfe0t&quot;&gt;这里&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Submit Button outside Form]]></title><link>https://laysent.github.io/til/2019/06#2019-06-27</link><guid isPermaLink="false">https://laysent.github.io/til/2019/06#2019-06-27</guid><pubDate>Thu, 27 Jun 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;在一个表单中敲击回车按钮，默认会触发 &lt;code class=&quot;language-text&quot;&gt;&amp;lt;form&amp;gt;&lt;/code&gt; 的 submit 事件。当 &lt;code class=&quot;language-text&quot;&gt;&amp;lt;form&amp;gt;&lt;/code&gt; 里面有 &lt;code class=&quot;language-text&quot;&gt;&amp;lt;button type=&amp;quot;submit&amp;quot;&amp;gt;&lt;/code&gt; 按钮的时候，敲击回车会先触发 &lt;code class=&quot;language-text&quot;&gt;button&lt;/code&gt; 的 click 事件，再触发 &lt;code class=&quot;language-text&quot;&gt;form&lt;/code&gt; 的 submit 事件。&lt;/p&gt;
&lt;p&gt;因为有了这样的机制，在一个表单中，只要指定了 submit 按钮，那么不论是点击按钮还是直接按回车，都可以触发相同的 click 事件，达到同样的代码提交功能。这使得代码可以很容易的复用，不需要额外的工作量就可以让鼠标和键盘都能够方便的提交表单。&lt;/p&gt;
&lt;p&gt;然而在实际开发的过程中，因为组件的划分，有时候不能做到 &lt;code class=&quot;language-text&quot;&gt;&amp;lt;button type=&amp;quot;submit&amp;quot;&amp;gt;&lt;/code&gt; 放在 &lt;code class=&quot;language-text&quot;&gt;&amp;lt;form&amp;gt;&lt;/code&gt; 中。HTML5 中，增加了 &lt;code class=&quot;language-text&quot;&gt;button&lt;/code&gt; 的 &lt;code class=&quot;language-text&quot;&gt;form&lt;/code&gt; 属性，可以用于关联表单和表单外的提交按钮。&lt;/p&gt;
&lt;p&gt;举例如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;html&quot;&gt;&lt;pre class=&quot;language-html&quot;&gt;&lt;code class=&quot;language-html&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;form&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;form-id&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;input&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;text&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;/&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;form&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;

&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;button&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;submit&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;form&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;form-id&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;Submit&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;button&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;在上述代码中，button 存在于 form 的外面，理论上和 form 是没有关联的。但是，因为 &lt;code class=&quot;language-text&quot;&gt;form&lt;/code&gt; 字段的存在，使得 form 和 button 被关联了起来。这样，和 button 在 form 中的表现形式一样，在 form 内敲击回车，就可以触发 button 的 click 事件。&lt;/p&gt;
&lt;p&gt;注：如果 click 事件和 submit 事件（如果定义了）都没有 &lt;code class=&quot;language-text&quot;&gt;event.preventDefault()&lt;/code&gt;，那么就会触发默认的 form 提交流程，会造成页面提交。如果 form 没有指定提交的地址，那么就会提交到当前页面。这可能并不是预期中的行为。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[scripts-prepend-node-path]]></title><link>https://laysent.github.io/til/2019/06#2019-06-26</link><guid isPermaLink="false">https://laysent.github.io/til/2019/06#2019-06-26</guid><pubDate>Wed, 26 Jun 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;在使用服务器编译上线包的过程中，可能会使用 nvm 来管理编译使用的 Node.js 版本。此时，运行时 Node.js 的二进制文件和实际服务器本身的 Node.js 文件将会是不同的。&lt;/p&gt;
&lt;p&gt;这样做的好处是可以隔离，保证编译的环境是稳定的。&lt;/p&gt;
&lt;p&gt;但是，当 npm 试图运行 Node.js 的时候，就要格外小心了。默认情况下，npm 会使用 path 中定义的 Node.js 版本。而对于打包服务器来说，这个 path 上的 Node.js 很可能并不是 nvm 管理的那个版本。&lt;/p&gt;
&lt;p&gt;举个例子，如果 &lt;code class=&quot;language-text&quot;&gt;package.json&lt;/code&gt; 中定义了 &lt;code class=&quot;language-text&quot;&gt;postinstall&lt;/code&gt; 的脚本，如下；&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;scripts&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;postinstall&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;some-cli&quot;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;那么，在 &lt;code class=&quot;language-text&quot;&gt;yarn install&lt;/code&gt; 之后，执行这个 &lt;code class=&quot;language-text&quot;&gt;postinstall&lt;/code&gt; 的过程中，&lt;code class=&quot;language-text&quot;&gt;some-cli&lt;/code&gt; 需要 Node.js 来执行，而 npm 使用的 Node.js 是 path 上的默认版本，和 nvm 管理的并不是同一个。命令行会有如下的报错：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;npm WARN lifecycle The node binary used for scripts is xxx but npm is using xxx itself. Use the &lt;code class=&quot;language-text&quot;&gt;--scripts-prepend-node-path&lt;/code&gt; option to include the path for the node binary npm was executed with.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;正如报错指出的，为了修正这个问题，需要用到 &lt;code class=&quot;language-text&quot;&gt;scripts-prepend-node-path&lt;/code&gt;。这样，当 npm 需要 Node.js 来执行代码的时候，会选择和自身匹配的 Node.js 版本，而不是默认 path 上的版本。（&lt;a href=&quot;https://docs.npmjs.com/cli/run-script.html&quot;&gt;文档&lt;/a&gt;）&lt;/p&gt;
&lt;p&gt;除了每次运行时加上命令行参数之外，一个比较简单的方法是使用 npm config 设置相对应的参数：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;npm&lt;/span&gt; config &lt;span class=&quot;token keyword&quot;&gt;set&lt;/span&gt; scripts-prepend-node-path&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;true&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;或是在 .npmrc 中加上&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;scripts-prepend-node-path true&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;设置完后，就不会再有报错了。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Screenshot in Chrome]]></title><link>https://laysent.github.io/til/2019/06#2019-06-25</link><guid isPermaLink="false">https://laysent.github.io/til/2019/06#2019-06-25</guid><pubDate>Tue, 25 Jun 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;在 Chrome 浏览器中，有专门用于页面截屏的扩展应用。其实 Chrome 自身也提供了截屏的工具。&lt;/p&gt;
&lt;p&gt;要使用 Chrome 自带的页面截屏方案，首先需要打开 Chrome DevTools。接下来，按 Cmd + Shift + P 打开指令搜索框。在搜索框中，搜索 &lt;code class=&quot;language-text&quot;&gt;screenshots&lt;/code&gt; 就可以找到和截屏相关的各个命令：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Capture area screenshot - 可以截取&lt;strong&gt;页面&lt;/strong&gt;某一个区域的图像（用鼠标选择）&lt;/li&gt;
&lt;li&gt;Capture full size screenshot - 可以截取整个页面的图像&lt;/li&gt;
&lt;li&gt;Capture node screenshot - 可以截取当前 DevTool 中选中的元素的图像&lt;/li&gt;
&lt;li&gt;Capture screenshot - 可以截取当前可视区域的图像&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;其中，&lt;code class=&quot;language-text&quot;&gt;Capture node screenshot&lt;/code&gt; 是一个比较有意思的功能。在 DevTool 中选定了某一个元素（Element）之后，执行这个命令，就会将这个元素自身的区域截图。当然，元素所在区域内，由于排版的缘故，还存在父元素，子元素或是其他什么元素的内容。在执行截图命令的时候，这些内容也会被包含进去。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Get Available Port Number]]></title><link>https://laysent.github.io/til/2019/06#2019-06-24</link><guid isPermaLink="false">https://laysent.github.io/til/2019/06#2019-06-24</guid><pubDate>Mon, 24 Jun 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;前端的开发工程，经常需要开启一些调试用的服务器，一旦调试的服务器多了，难免会出现网络端口号的冲突；类似的，如果在一台开发机上有多个人同时开发，开发脚本也就不能写死一个固定的端口号了。在这类情况下，如果要手动解决这些冲突（修改端口号或者手写端口号的分配规则），不免有些麻烦。&lt;/p&gt;
&lt;p&gt;事实上，创建服务的时候，可以设置 &lt;code class=&quot;language-text&quot;&gt;0&lt;/code&gt; 作为端口号。这样的话，系统就会指定一个当前空闲可用的端口号，以保证不发生端口号冲突的情况。&lt;/p&gt;
&lt;p&gt;下面是一段 Node.js 的示意代码：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; http &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;http&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; server  &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; http&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;createServer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;request&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; response&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  response&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;writeHead&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;200&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Content-Type&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;text/html&apos;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  response&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
    &lt;span class=&quot;token string&quot;&gt;&apos;&amp;lt;html&gt;&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token string&quot;&gt;&apos;&amp;lt;head&gt;&amp;lt;title&gt;Node.js Server&amp;lt;/title&gt;&amp;lt;/head&gt;&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token string&quot;&gt;&apos;&amp;lt;body&gt;&amp;lt;h1&gt;Hello World&amp;lt;/h1&gt;&amp;lt;/body&gt;&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token string&quot;&gt;&apos;&amp;lt;/html&gt;&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;join&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  response&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;end&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// ask for an available port&lt;/span&gt;
server&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;listen&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

server&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;on&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;listening&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// ask for actually used port&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; port &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; server&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;address&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;port&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;`server is listening: &lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;port&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;其中，&lt;code class=&quot;language-text&quot;&gt;server.address().port&lt;/code&gt; 可以拿到当前系统具体分配的端口号。有了这个端口号，就可以自动/手动的打开对应的 URL 地址以访问新生成的服务了。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Detect Overflow]]></title><link>https://laysent.github.io/til/2019/06#2019-06-21</link><guid isPermaLink="false">https://laysent.github.io/til/2019/06#2019-06-21</guid><pubDate>Fri, 21 Jun 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;下面展示的这段 CSS 设置非常常见，可以让文字超过宽度的时候，显示 &lt;code class=&quot;language-text&quot;&gt;...&lt;/code&gt;：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;css&quot;&gt;&lt;pre class=&quot;language-css&quot;&gt;&lt;code class=&quot;language-css&quot;&gt;&lt;span class=&quot;token selector&quot;&gt;.ellipsis&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;white-space&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nowrap&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;overflow&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; hidden&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;text-overflow&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ellipsis&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;在实际业务中，经常会碰到这样的需求：只有当显示出 &lt;code class=&quot;language-text&quot;&gt;...&lt;/code&gt; 的时候，才做某些事情（比如，才在鼠标悬停的时候展示 Tooltip，用以显示完整的文字内容）。CSS 本身并没有提供足够的接口，让开发者可以直观的了解到当前的文字内容是否已经超出了可以显示的范围。如果需要判断当前内容是否超出了元素的宽度（因而让 CSS 渲染出 &lt;code class=&quot;language-text&quot;&gt;...&lt;/code&gt;），可以用下面的 JavaScript 代码：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;isOverflow&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;element&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; element&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;scrollWidth &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; element&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;clientWidth&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;根据 &lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/API/Element/scrollWidth&quot;&gt;MDN&lt;/a&gt; 的介绍，&lt;code class=&quot;language-text&quot;&gt;scrollWidth&lt;/code&gt; 是一个制度元素，其值等于该元素实际的宽度（包含了元素因为 &lt;code class=&quot;language-text&quot;&gt;overflow&lt;/code&gt; 没有展示出来的部分）；而于此相对的，&lt;code class=&quot;language-text&quot;&gt;clientWidth&lt;/code&gt; 是元素实际展示的宽度。注，对行内元素和没有 CSS 的元素来说，&lt;code class=&quot;language-text&quot;&gt;clientWidth&lt;/code&gt; 是 0，具体见 &lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/API/Element/clientWidth&quot;&gt;MDN&lt;/a&gt;。针对判断是否出 &lt;code class=&quot;language-text&quot;&gt;...&lt;/code&gt; 的情况，这里不需要考虑 &lt;code class=&quot;language-text&quot;&gt;clientWidth&lt;/code&gt; 的特殊情况。因为 &lt;code class=&quot;language-text&quot;&gt;scrollWidth&lt;/code&gt; 实际给出的值包含了被隐去的部分，因而当 &lt;code class=&quot;language-text&quot;&gt;scrollWidth&lt;/code&gt; 和 &lt;code class=&quot;language-text&quot;&gt;clientWidth&lt;/code&gt; 不想等的时候，就可以认定当前有部分内容被隐去了，因而 &lt;code class=&quot;language-text&quot;&gt;...&lt;/code&gt; 也出现了。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[TypeScript Non-null Assertion]]></title><link>https://laysent.github.io/til/2019/06#2019-06-20</link><guid isPermaLink="false">https://laysent.github.io/til/2019/06#2019-06-20</guid><pubDate>Thu, 20 Jun 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;在 TypeScript 中，常常存在一个对象可能是 &lt;code class=&quot;language-text&quot;&gt;undefined&lt;/code&gt; 或 &lt;code class=&quot;language-text&quot;&gt;null&lt;/code&gt; 的情况。如果试图直接使用这样的对象，很可能会造成 TypeScript 的报错（在 &lt;code class=&quot;language-text&quot;&gt;--strictNullChecks&lt;/code&gt; 开启的情况下）。这本身是一个正确的行为，也可以在编译时帮助开发者避免一些不必要的错误。&lt;/p&gt;
&lt;p&gt;然而，在实际的开发中，不免遇到这样的情况：在某些特定的生命周期中，开发者可以很明确的知道某一个值不会是 &lt;code class=&quot;language-text&quot;&gt;undefined&lt;/code&gt; 或者 &lt;code class=&quot;language-text&quot;&gt;null&lt;/code&gt;。然而，这样的前置条件 TypeScript 本身并不知情。此时，为了防止 TypeScript 报错，就需要通过某些显式的方法，声明这一情况。&lt;/p&gt;
&lt;p&gt;最常见的方案，是通过 &lt;code class=&quot;language-text&quot;&gt;as&lt;/code&gt; 来强制类型转化。比如：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;throwIfUndefined&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;input&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;any&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;typeof&lt;/span&gt; input &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;undefined&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Error&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Undefined!&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;handler&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;optional&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;throwIfUndefined&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;optional&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token builtin&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;optional &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;TypeScript 提供了一个 Non-null assertion 运算符：&lt;code class=&quot;language-text&quot;&gt;!.&lt;/code&gt;，就是用于上述情景的。具体来说：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;handler&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;optional&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;throwIfUndefined&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;optional&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token builtin&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;optional&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;上面这样写之后，TypeScript 就不会报错了。&lt;code class=&quot;language-text&quot;&gt;optional&lt;/code&gt; 被认为一定是非 &lt;code class=&quot;language-text&quot;&gt;undefined&lt;/code&gt; 或 &lt;code class=&quot;language-text&quot;&gt;null&lt;/code&gt; 类型的。（至于 TypeScript 会认为这个变量是什么类型的，就要看这个变量除了 &lt;code class=&quot;language-text&quot;&gt;undefined | null&lt;/code&gt; 的类型之外，还可能是什么类型的了）&lt;/p&gt;
&lt;p&gt;当然，不难看出，这个运算符只是一个编译时帮助编译器理解类型用的辅助手段，本身并不是一个语法糖。因此，在 TypeScript 转化成 JavaScript 的过程中，这里的运算符会直接被去掉。&lt;code class=&quot;language-text&quot;&gt;optional!.length&lt;/code&gt; 生成的就是 &lt;code class=&quot;language-text&quot;&gt;optional.length&lt;/code&gt;，没有生成任何额外的东西。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Record in TypeScript]]></title><link>https://laysent.github.io/til/2019/06#2019-06-19</link><guid isPermaLink="false">https://laysent.github.io/til/2019/06#2019-06-19</guid><pubDate>Wed, 19 Jun 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Record&lt;/code&gt; 是 TypeScript 中一个很实用的范型类型。它需要两个具体的参数类型，&lt;code class=&quot;language-text&quot;&gt;Record&amp;lt;K, V&amp;gt;&lt;/code&gt;，用于指定一个对象的类型。其中，对象的所有 key 都是 &lt;code class=&quot;language-text&quot;&gt;K&lt;/code&gt; 类型的，而这些 key 对应的值则都是 &lt;code class=&quot;language-text&quot;&gt;V&lt;/code&gt; 类型的。如果不使用 &lt;code class=&quot;language-text&quot;&gt;Record&lt;/code&gt; 类型，可能需要用如下的方法来达到同等的效果：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; RecordExample &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Record&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;number&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;interface&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;EquivalentExample&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;number&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;显然，等价的写法更为的复杂，看起来也不那么清晰。&lt;/p&gt;
&lt;p&gt;当然，对于 JavaScript 来说，对象的属性其实只能是 &lt;code class=&quot;language-text&quot;&gt;string&lt;/code&gt; 类型的。虽然有时候也会直接使用 &lt;code class=&quot;language-text&quot;&gt;number&lt;/code&gt; 作为值（TypeScript 里面也可以专门这么来做类型强制），但是其实在用作 key 的时候，会经过一步 toString 的转化。比如：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; obj &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; key&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;value&apos;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; key &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;toString&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;key&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;obj&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// output: value&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这么看起来，&lt;code class=&quot;language-text&quot;&gt;Record&lt;/code&gt; 的应用场景似乎非常有限，只有 &lt;code class=&quot;language-text&quot;&gt;Record&amp;lt;string, xxx&amp;gt;&lt;/code&gt; 或者 &lt;code class=&quot;language-text&quot;&gt;Record&amp;lt;number, xxx&amp;gt;&lt;/code&gt; 两种可能性。然而，TypeScript 中除了可以使用一些泛用的类型之外，也可以对类型做更进一步的限定。比如，指定类型只能是 &lt;code class=&quot;language-text&quot;&gt;&amp;#39;apple&amp;#39; | &amp;#39;banana&amp;#39; | &amp;#39;orange&amp;#39;&lt;/code&gt;。如此一来，&lt;code class=&quot;language-text&quot;&gt;Record&lt;/code&gt; 就有了更多的应用场景。&lt;/p&gt;
&lt;p&gt;举例来说，如果希望写一个函数，可以将参数对象中所有的值都转化成对应的数字，就可以这么写：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; Input &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Record&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; transform&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;T&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Input&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;input&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Record&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;keyof&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;number&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; keys&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;keyof&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Object&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;keys&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;input&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; keys&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;reduce&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;acc&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    acc&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;input&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; acc&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; Record&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;keyof&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;number&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这样，就可以保证输入和输出的对象，有相同的 key。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[SSH ProxyJump]]></title><link>https://laysent.github.io/til/2019/06#2019-06-18</link><guid isPermaLink="false">https://laysent.github.io/til/2019/06#2019-06-18</guid><pubDate>Tue, 18 Jun 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;ssh&lt;/code&gt; 自带跳板机功能：&lt;code class=&quot;language-text&quot;&gt;-J&lt;/code&gt;。示例代码如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;ssh&lt;/span&gt; -J userA@a.xxx.com userB@b.xxx.com&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;命令会需要依次输入 a.xxx.com 和 b.xxx.com 两台机器的登陆信息。校验通过之后，就会登陆 b.xxx.com 这台机器，登陆的用户是 userB。并且，登陆是通过 a.xxx.com 这台机器的 userA 完成的。a.xxx.com 在这里就是一个跳板机的功能。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/hardenedlinux/Debian-GNU-Linux-Profiles/blob/master/docs/ssh_and_cluster/powerful-ssh-options-you-dont-know.md&quot;&gt;参考文档&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Unzip using JavaScript]]></title><link>https://laysent.github.io/til/2019/06#2019-06-17</link><guid isPermaLink="false">https://laysent.github.io/til/2019/06#2019-06-17</guid><pubDate>Mon, 17 Jun 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;使用 JavaScript 库 &lt;a href=&quot;https://www.npmjs.com/package/jszip&quot;&gt;jszip&lt;/a&gt; 可以对传入的本地 zip 包进行解压缩并读取其中的文件。&lt;/p&gt;
&lt;p&gt;一段参考代码如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; filename &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;example.txt&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;onDrop&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;event&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; DragEvent&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;HTMLDivElement&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; file&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; File &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; event&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;dataTransfer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;files&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; zip &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; jszip&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;loadAsync&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;file&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; content &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; zip&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;files&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;filename&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;text&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token builtin&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;content of example.txt: &apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; content&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这里，&lt;code class=&quot;language-text&quot;&gt;loadAsync&lt;/code&gt; 函数接受的参数是一个 &lt;code class=&quot;language-text&quot;&gt;Blob&lt;/code&gt;，而无论是 &lt;code class=&quot;language-text&quot;&gt;input[type=file]&lt;/code&gt; 还是通过 drag-n-drop 得到的文件（&lt;code class=&quot;language-text&quot;&gt;File&lt;/code&gt;），都是一种特殊的 &lt;code class=&quot;language-text&quot;&gt;Blob&lt;/code&gt;，因而可以直接传递给 &lt;code class=&quot;language-text&quot;&gt;loadAsync&lt;/code&gt; 使用。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;.async(&amp;#39;text&amp;#39;)&lt;/code&gt; 可以将结果异步转化成字符串。API 也支持其他的格式类型，比如 ArrayBuffer 等。（&lt;a href=&quot;https://stuk.github.io/jszip/documentation/api_zipobject/async.html&quot;&gt;文档&lt;/a&gt;）&lt;/p&gt;
&lt;p&gt;除了读取内容之外，jszip 也支持创建修改 zip 包的内容。完整的 API 文档可以参考&lt;a href=&quot;https://stuk.github.io/jszip/documentation/api_jszip.html&quot;&gt;这里&lt;/a&gt;。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[HashHistory & State]]></title><link>https://laysent.github.io/til/2019/06#2019-06-16</link><guid isPermaLink="false">https://laysent.github.io/til/2019/06#2019-06-16</guid><pubDate>Sun, 16 Jun 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;react-router 底层使用了 history 库来处理路由。一般有两种选择，一种是使用 &lt;code class=&quot;language-text&quot;&gt;BrowserHistory&lt;/code&gt;（背后的实现依赖了 History API），一种是使用 &lt;code class=&quot;language-text&quot;&gt;HashHistory&lt;/code&gt;（背后的实现主要依赖 &lt;code class=&quot;language-text&quot;&gt;window.location.hash&lt;/code&gt;）。&lt;/p&gt;
&lt;p&gt;如果尝试在 HashHistory 上调用 &lt;code class=&quot;language-text&quot;&gt;push&lt;/code&gt; API 并传递 state 参数：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; history &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;HashHistory&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
history&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;push&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;path&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; state&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;value&apos;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;会在 console 看到如下的报错，并且 state 并没有传递成功：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Hash history cannot push state; it is ignored&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这个是 history 库的默认行为，具体的代码可以参考 &lt;code class=&quot;language-text&quot;&gt;modules/createHashHistory.js&lt;/code&gt; 中 &lt;code class=&quot;language-text&quot;&gt;push&lt;/code&gt; 的代码：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;push&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;path&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; state&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;warning&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    state &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;undefined&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token string&quot;&gt;&apos;Hash history cannot push state; it is ignored&apos;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; action &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;PUSH&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; location &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;createLocation&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    path&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;undefined&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;undefined&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    history&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;location
  &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// ...&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;上面的代码可以看到，如果传递了第二个参数 state，那么就会输出报错。同时，在 createLocation 函数调用的时候，第二个参数本来应该是 state，这里显式地写成了 &lt;code class=&quot;language-text&quot;&gt;undefined&lt;/code&gt;，明确拒绝了传递 state 的做法。&lt;/p&gt;
&lt;p&gt;然而，这并不意味着就完全不能传递 &lt;code class=&quot;language-text&quot;&gt;state&lt;/code&gt; 了。&lt;/p&gt;
&lt;p&gt;事实上，&lt;code class=&quot;language-text&quot;&gt;push&lt;/code&gt; 函数有两种 API 可供选择，一种是 path 是字符串，然后 state 作为第二个参数传递；另一种则第一个参数就是一个对象，其中一个属性就是 state。&lt;/p&gt;
&lt;p&gt;如果使用下面的方法调用，state 就可以在 react-router 中被传递了：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;hashHistory&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;push&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; path&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;path&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; state&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; state&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;value&apos;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;但是，需要指出的是。这个只是 &lt;code class=&quot;language-text&quot;&gt;state&lt;/code&gt; 被&lt;strong&gt;传递&lt;/strong&gt;了，并不代表 &lt;code class=&quot;language-text&quot;&gt;state&lt;/code&gt; 真的被存储了下来。事实上，HashHistory 并没有依赖浏览器的 History API 功能。因此，这里的 &lt;code class=&quot;language-text&quot;&gt;state&lt;/code&gt; 传递之后，会出现在 &lt;code class=&quot;language-text&quot;&gt;history.location.state&lt;/code&gt; 中，但是在浏览器前进/后退的操作中，数据会被丢弃，无法找到。&lt;/p&gt;
&lt;p&gt;一个简单的例子是：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; h &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;createHashHistory&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
h&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;listen&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;location&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;location&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;state&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
h&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;push&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; pathname&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;a&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; state&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// output: 1&lt;/span&gt;
h&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;push&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; pathname&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;b&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; state&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// output: 2&lt;/span&gt;
h&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;goBack&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// output: undefined&lt;/span&gt;
h&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;goForward&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// output: undefined&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如果将 HashHistory 改成 BrowserHistory，则可以正确输出：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; h &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;createBrowserHistory&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
h&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;listen&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;location&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;location&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;state&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
h&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;push&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; pathname&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;a&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; state&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// output: 1&lt;/span&gt;
h&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;push&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; pathname&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;b&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; state&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// output: 2&lt;/span&gt;
h&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;goBack&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// output: 1&lt;/span&gt;
h&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;goForward&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// output: 2&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[Capture Screen Shot with Mac OS]]></title><link>https://laysent.github.io/til/2019/06#2019-06-13</link><guid isPermaLink="false">https://laysent.github.io/til/2019/06#2019-06-13</guid><pubDate>Thu, 13 Jun 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Command-Shift-4&lt;/code&gt; 可以截取部分屏幕。截取之后的结果会保存到桌面。&lt;/p&gt;
&lt;section&gt;&lt;h2&gt;一些技巧&lt;/h2&gt;&lt;p&gt;在点击 &lt;code class=&quot;language-text&quot;&gt;Command-Shift-4&lt;/code&gt; 之后，如果单击 &lt;code class=&quot;language-text&quot;&gt;Space&lt;/code&gt;，会转化成对某一个窗口进行截屏（再次点击 &lt;code class=&quot;language-text&quot;&gt;Space&lt;/code&gt; 可以切换回部分屏幕截取模式）。&lt;/p&gt;&lt;p&gt;保存后的结果，会短暂的以预览图的形式出现在屏幕的右下角。和 iPhone 上的操作类似，点击这个预览图，可以打开截图并进行图片的修改操作，比如增加一些提示性的标识。&lt;/p&gt;&lt;p&gt;注：在进行上述修改的时候，如果点击右上角的垃圾桶按钮，就不会将最终结果保存；如果点击右上角的关闭按钮，则是会保存的。&lt;/p&gt;&lt;p&gt;另外，在截取的时候，按住 &lt;code class=&quot;language-text&quot;&gt;Option&lt;/code&gt; 可以按比例缩放选取的范围；按住 &lt;code class=&quot;language-text&quot;&gt;Shift&lt;/code&gt; 则可以固定上下或左右方向，只在一个轴上选取截取区域。&lt;/p&gt;&lt;p&gt;如果不希望保存到本地桌面，可以使用 &lt;code class=&quot;language-text&quot;&gt;Command-Control-Shift-4&lt;/code&gt;。截取后的结果会存放到剪贴板中。保存到剪贴板的这个操作，是不会在右下角生成预览图的，因而也不能直接对截屏结果进行二次操作。&lt;/p&gt;&lt;/section&gt;
&lt;section&gt;&lt;h2&gt;其他相关操作&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Command-Shift-3&lt;/code&gt; 截取当前整个屏幕，并保存到本地&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Command-Control-Shift-3&lt;/code&gt; 截取当前整个屏幕，并保存到剪贴板中&lt;/li&gt;
&lt;/ul&gt;&lt;/section&gt;
&lt;section&gt;&lt;h2&gt;修改默认配置&lt;/h2&gt;&lt;p&gt;默认情况下，截图是保存到桌面的。可以执行以下的命令行改变这个默认行为：&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;defaults &lt;span class=&quot;token function&quot;&gt;write&lt;/span&gt; com.apple.screencapture location ~/Pictures/
&lt;span class=&quot;token function&quot;&gt;killall&lt;/span&gt; SystemUIServer&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;其中第一行是将默认地址改到 &lt;code class=&quot;language-text&quot;&gt;Pictures&lt;/code&gt; 下面；第二行则是让配置当即生效。注：需要确保保存到的位置是存在的，如果不存在，最终保存的结果还是会放到桌面下。&lt;/p&gt;&lt;p&gt;同时，默认保存的图片格式是 &lt;code class=&quot;language-text&quot;&gt;.png&lt;/code&gt;，也可以通过下面的方式改成 &lt;code class=&quot;language-text&quot;&gt;.jpg&lt;/code&gt; 或其图片格式：&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;defaults &lt;span class=&quot;token function&quot;&gt;write&lt;/span&gt; com.apple.screencapture &lt;span class=&quot;token function&quot;&gt;type&lt;/span&gt; jpg
&lt;span class=&quot;token function&quot;&gt;killall&lt;/span&gt; SystemUIServer&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;取决于屏幕显示的内容类型，有时候 &lt;code class=&quot;language-text&quot;&gt;.jpg&lt;/code&gt; 的结果会比 &lt;code class=&quot;language-text&quot;&gt;.png&lt;/code&gt; 更小。&lt;/p&gt;&lt;/section&gt;</content:encoded></item><item><title><![CDATA[Generate v4 UUID]]></title><link>https://laysent.github.io/til/2019/06#2019-06-12</link><guid isPermaLink="false">https://laysent.github.io/til/2019/06#2019-06-12</guid><pubDate>Wed, 12 Jun 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;a href=&quot;https://gist.github.com/jed/982883&quot;&gt;这里&lt;/a&gt;有一段生成 UUID v4 非常短小的 JavaScript 代码。虽然有一些注释，但总体上并不是非常的好理解。&lt;/p&gt;
&lt;p&gt;首先，用 TypeScript 翻译一遍原始的代码：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; slot &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;10000000-1000-4000-8000-100000000000&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;rand&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;number&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; to&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;number&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; Math&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;floor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Math&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;random&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;to &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getRandomChar&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;input&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;number&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; seed &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; input &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;8&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;rand&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;11&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;rand&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;15&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; seed&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toString&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;16&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;uuidReplacer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;char&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getRandomChar&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;char&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;uuid&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; slot&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;replace&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token regex&quot;&gt;/[018]/g&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; uuidReplacer&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;接下来对原始的代码中的部分做一些解释：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;a &lt;span class=&quot;token operator&quot;&gt;^&lt;/span&gt; Math&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;random&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;16&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&gt;&gt;&lt;/span&gt; a&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这个部分的代码不太好理解。首先，先根据运算符的&lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Operator_Precedence&quot;&gt;优先级&lt;/a&gt;，给上面这个算式加上帮助理解的括号：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;a &lt;span class=&quot;token operator&quot;&gt;^&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Math&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;random&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;16&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;a &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;接下来，再来看每个部分都是什么意思：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;Math&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;random&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;16&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;创建了一个 &lt;code class=&quot;language-text&quot;&gt;0~16&lt;/code&gt; 范围内的随机数，&lt;code class=&quot;language-text&quot;&gt;&amp;gt;&amp;gt; (a / 4)&lt;/code&gt; 这个运算之后，会得到几种不同的结果（注意，这里 &lt;code class=&quot;language-text&quot;&gt;a&lt;/code&gt; 只可能是 &lt;code class=&quot;language-text&quot;&gt;&amp;#39;0&amp;#39;&lt;/code&gt;，&lt;code class=&quot;language-text&quot;&gt;&amp;#39;1&amp;#39;&lt;/code&gt;，&lt;code class=&quot;language-text&quot;&gt;&amp;#39;8&amp;#39;&lt;/code&gt; 三种情况）：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;&amp;#39;0&amp;#39;&lt;/code&gt; 或 &lt;code class=&quot;language-text&quot;&gt;&amp;#39;1&amp;#39;&lt;/code&gt; 的时候，结果是 &lt;code class=&quot;language-text&quot;&gt;0~15&lt;/code&gt; 的随机数（整数）&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;&amp;#39;8&amp;#39;&lt;/code&gt; 的时候，等价于 &lt;code class=&quot;language-text&quot;&gt;&amp;gt;&amp;gt; 2&lt;/code&gt;，所以结果是一个 &lt;code class=&quot;language-text&quot;&gt;0~3&lt;/code&gt; 的随机数（整数）&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;最后一步异或运算 &lt;code class=&quot;language-text&quot;&gt;^&lt;/code&gt;，得到的可能结果分别是：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;&amp;#39;0&amp;#39;&lt;/code&gt; 的时候，异或结果不变，是 &lt;code class=&quot;language-text&quot;&gt;0~15&lt;/code&gt; 的随机数（整数）&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;&amp;#39;1&amp;#39;&lt;/code&gt; 的时候，异或结果最后一个比特位的值正好相反，最终的结果仍然是 &lt;code class=&quot;language-text&quot;&gt;0~15&lt;/code&gt; 的随机数（整数）&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;&amp;#39;8&amp;#39;&lt;/code&gt; 的时候，最终结果是 &lt;code class=&quot;language-text&quot;&gt;8~11&lt;/code&gt; 的随机数（整数）。因为 &lt;code class=&quot;language-text&quot;&gt;8&lt;/code&gt; 的第四位二进制是 &lt;code class=&quot;language-text&quot;&gt;1&lt;/code&gt; 其他都是 &lt;code class=&quot;language-text&quot;&gt;0&lt;/code&gt;，而 &lt;code class=&quot;language-text&quot;&gt;0~3&lt;/code&gt; 这几个数的二进制位数不超过两位，所以位数之间不存在交集，异或运算相当于是 &lt;code class=&quot;language-text&quot;&gt;8 + n&lt;/code&gt;，&lt;code class=&quot;language-text&quot;&gt;n&lt;/code&gt; 是 &lt;code class=&quot;language-text&quot;&gt;0~3&lt;/code&gt; 中的某一个数。最终得到的就是 &lt;code class=&quot;language-text&quot;&gt;8~11&lt;/code&gt; 的随机数（整数）。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;最终，将生成的不超过 16 的整数转化成十六进制的对应字符。&lt;/p&gt;
&lt;p&gt;第二部分的代码用到了正则匹配和替换（注意，这里 &lt;code class=&quot;language-text&quot;&gt;&amp;#39;4&amp;#39;&lt;/code&gt; 没有被替换，依然保留），主要不容易理解的是下面这个部分：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1e7&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1e3&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;4e3&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;8e3&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1e11&lt;/span&gt;    &lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这里用到了 JavaScript 比较奇怪的类型转化功能。因为最开始是一个数组，所以这里的相加实际上是字符串的拼接。等价于 &lt;code class=&quot;language-text&quot;&gt;&amp;#39;10000000-1000-4000-8000-100000000000&amp;#39;&lt;/code&gt; 这个字符串。上面这样写主要是字符数上比较少。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[DOM Interface]]></title><link>https://laysent.github.io/til/2019/06#2019-06-11</link><guid isPermaLink="false">https://laysent.github.io/til/2019/06#2019-06-11</guid><pubDate>Tue, 11 Jun 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;当用 JavaScript 去访问 HTML 中的元素的时候，实际访问到的是 DOM 元素。比如，访问 &lt;code class=&quot;language-text&quot;&gt;div&lt;/code&gt; 元素，实际拿到的是 &lt;code class=&quot;language-text&quot;&gt;HTMLDivElement&lt;/code&gt;；访问 &lt;code class=&quot;language-text&quot;&gt;span&lt;/code&gt; 元素，实际拿到的是 &lt;code class=&quot;language-text&quot;&gt;HTMLSpanElement&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;大多数情况下，不同的 HTML 元素有不同的 DOM interface 对应，因为不同的元素很可能有一些行为/属性上的不同。&lt;/p&gt;
&lt;p&gt;但是也存在一些 HTML 元素，并没有特定的 DOM interface 对应，直接使用了 HTMLElement 这个基类。常见的例子有 &lt;code class=&quot;language-text&quot;&gt;i&lt;/code&gt;，&lt;code class=&quot;language-text&quot;&gt;b&lt;/code&gt; 或者 &lt;code class=&quot;language-text&quot;&gt;ruby&lt;/code&gt; 等。&lt;/p&gt;
&lt;p&gt;注：根据 &lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/HTML/Element/i&quot;&gt;MDN&lt;/a&gt; 的说明，Firefox 中 &lt;code class=&quot;language-text&quot;&gt;i&lt;/code&gt; 对应的 DOM 是 &lt;code class=&quot;language-text&quot;&gt;HTMLSpanElement&lt;/code&gt;。但实际测试下来，最新版本的 Firefox 实现和标准是一致的，使用的 DOM interface 是 &lt;code class=&quot;language-text&quot;&gt;HTMLElement&lt;/code&gt; 而不是 &lt;code class=&quot;language-text&quot;&gt;HTMLSpanElement&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;可以用下面的方法简单的查看具体使用的是哪一个 DOM interface：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// should be: HTMLElement&lt;/span&gt;
document&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;createElement&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;i&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;constructor&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// should be: HTMLSpanElement&lt;/span&gt;
document&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;createElement&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;span&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;constructor&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[Read certain type of files]]></title><link>https://laysent.github.io/til/2019/06#2019-06-10</link><guid isPermaLink="false">https://laysent.github.io/til/2019/06#2019-06-10</guid><pubDate>Mon, 10 Jun 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;HTML 中的 &lt;code class=&quot;language-text&quot;&gt;input&lt;/code&gt; 组件，如果设置成 &lt;code class=&quot;language-text&quot;&gt;type=file&lt;/code&gt;，就可以变成一个文件选择控件。&lt;/p&gt;
&lt;p&gt;默认情况下，系统默认打开的这个文件选择框，可以接受任意的文件选择。如果需要指定可以选择的文件类型，可以使用 &lt;code class=&quot;language-text&quot;&gt;accept&lt;/code&gt; 参数：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;html&quot;&gt;&lt;pre class=&quot;language-html&quot;&gt;&lt;code class=&quot;language-html&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;input&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;file&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;accept&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;image/x-png,image/gif,image/jpeg&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;/&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;上面这个例子中，浏览器将会只接受 png / gif 或 jpg 的输入。&lt;/p&gt;
&lt;p&gt;也可以写:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;html&quot;&gt;&lt;pre class=&quot;language-html&quot;&gt;&lt;code class=&quot;language-html&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;input&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;file&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;accept&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;image/*&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;/&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;以支持任意类型的图片格式输入。同理，类似的比如 &lt;code class=&quot;language-text&quot;&gt;video/*&lt;/code&gt; 将会只接受任意类型的视频；&lt;code class=&quot;language-text&quot;&gt;audio/*&lt;/code&gt; 将会只接受任意类型的音频文件。&lt;/p&gt;
&lt;p&gt;除了指定 &lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types&quot;&gt;MIME&lt;/a&gt; 类型之外，也可以指定后缀。比如：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;html&quot;&gt;&lt;pre class=&quot;language-html&quot;&gt;&lt;code class=&quot;language-html&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;input&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;file&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;accept&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;.pdf,.doc,.docx&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;/&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;将会只允许以 pdf / doc / docx 这三种名称作为后缀的文件被选择。&lt;/p&gt;
&lt;p&gt;各个浏览器的支持情况可以看&lt;a href=&quot;http://caniuse.com/#feat=input-file-accept&quot;&gt;这里&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;（当然，这个只是前端的一个校验，后端依然需要重新对前端给的输入进行检查才行）&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Order of font-family]]></title><link>https://laysent.github.io/til/2019/06#2019-06-05</link><guid isPermaLink="false">https://laysent.github.io/til/2019/06#2019-06-05</guid><pubDate>Wed, 05 Jun 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;由于系统的差异，不同的电脑上存在的字体是不一样的。为了网站的效果可以兼顾各个设备，一般在写 CSS 的时候，&lt;code class=&quot;language-text&quot;&gt;font-family&lt;/code&gt; 总是很长的一串。通过字体 fallback 的功能，让浏览器自行选择最先能匹配到的字体文件，从而保证显示的效果大体上接近于视觉效果图。在实际书写中，有一个值得注意的细节：&lt;strong&gt;英文字体应该在中文字体的前面&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;中文字体文件往往包含英文字符，但是这些英文字符的样式很可能并不是设计师希望看到的。如果中文字体展示在英文字体的前面，英文字体就没法被使用到，导致最终的效果略有偏差。下面展示了中文字体 PingFang SC 和苹果默认英文系统字体（SF NS Display）针对英文字母的渲染效果（需要在 MacOS 下查看）：&lt;/p&gt;
&lt;style&gt;
.pingfang-sc {
  font-family: &apos;PingFang SC&apos;;
  font-size: 3em;
}
.default-font {
  font-family: -apple-system, BlinkMacSystemFont;
  font-size: 3em;
}
&lt;/style&gt;
&lt;p&gt;&lt;span class=&quot;pingfang-sc&quot;&gt;ffi&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;default-font&quot;&gt;ffi&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;所以，应该写：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;css&quot;&gt;&lt;pre class=&quot;language-css&quot;&gt;&lt;code class=&quot;language-css&quot;&gt;&lt;span class=&quot;token selector&quot;&gt;.example&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;font-family&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    -apple-system&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; BlinkMacSystemFont&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token string&quot;&gt;&apos;Segoe UI&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Helvetica Neue&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Helvetica&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Arial&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token string&quot;&gt;&apos;PingFang SC&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Microsoft YaHei&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    sans-serif&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;而不是：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;css&quot;&gt;&lt;pre class=&quot;language-css&quot;&gt;&lt;code class=&quot;language-css&quot;&gt;&lt;span class=&quot;token selector&quot;&gt;.example&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;font-family&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token string&quot;&gt;&apos;PingFang SC&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Microsoft YaHei&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    -apple-system&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; BlinkMacSystemFont&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token string&quot;&gt;&apos;Segoe UI&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Helvetica Neue&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Helvetica&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Arial&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    sans-serif&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这里，&lt;code class=&quot;language-text&quot;&gt;-apple-system, BlinkMacSystemFont&lt;/code&gt; 针对苹果下的 Safari 和 Chrome 内核调用系统自带字体，对应到的英文字体是 SF (SF NS Display)，中文字体是 PingFang (PingFang SC)。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[TextDecoder]]></title><link>https://laysent.github.io/til/2019/06#2019-06-04</link><guid isPermaLink="false">https://laysent.github.io/til/2019/06#2019-06-04</guid><pubDate>Tue, 04 Jun 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;在 JavaScript 中，如果得到了一串字节（比如 &lt;code class=&quot;language-text&quot;&gt;Uint8Array&lt;/code&gt;），要转化成对应的字符串，就可以用到 &lt;code class=&quot;language-text&quot;&gt;TextDecoder&lt;/code&gt;。简单的使用方法如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; decoder &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;TextDecoder&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;utf-8&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; bytes &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Uint8Array&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
  &lt;span class=&quot;token number&quot;&gt;104&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;101&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;108&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;108&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;111&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;32&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;119&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;111&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;114&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;108&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;100&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; result &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; decoder&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;decode&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;bytes&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;result&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// =&gt; &quot;hello world&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;当然，上面的这个例子是比较简单的。不使用 &lt;code class=&quot;language-text&quot;&gt;TextDecoder&lt;/code&gt; 也可以直接转化成字符串：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; bytes &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Uint8Array&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
  &lt;span class=&quot;token number&quot;&gt;104&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;101&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;108&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;108&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;111&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;32&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;119&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;111&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;114&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;108&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;100&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; result &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; String&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;fromCharCode&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;bytes&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;result&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// =&gt; &quot;hello world&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;TextDecoder&lt;/code&gt; 的主要优势，需要在非 ASCII 码范围内才体现出来。特别是 utf-8 这类变长字符串编码，直接处理比较困难。交给现成的 API 来处理，简单方便。&lt;/p&gt;
&lt;p&gt;参考文档：&lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/API/TextDecoder&quot;&gt;MDN&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[global Provider for storybook]]></title><link>https://laysent.github.io/til/2019/06#2019-06-03</link><guid isPermaLink="false">https://laysent.github.io/til/2019/06#2019-06-03</guid><pubDate>Mon, 03 Jun 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;一个项目工程里的组件，很可能需要依赖于某些项目顶层定义的 &lt;code class=&quot;language-text&quot;&gt;Provider&lt;/code&gt; 才能正确使用。比如，mobx 的项目可能会在顶层通过 &lt;code class=&quot;language-text&quot;&gt;mobx-react&lt;/code&gt; 中的 &lt;code class=&quot;language-text&quot;&gt;Provider&lt;/code&gt; 提供 &lt;code class=&quot;language-text&quot;&gt;store&lt;/code&gt; 参数。&lt;/p&gt;
&lt;p&gt;如果需要在每一个 story 中都写：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;jsx&quot;&gt;&lt;pre class=&quot;language-jsx&quot;&gt;&lt;code class=&quot;language-jsx&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Provider&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token spread&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;info&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ComponentForThisStory&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;/&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Provider&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;显然太啰嗦了。&lt;/p&gt;
&lt;p&gt;storybook 提供了全局定义 decorator 的方法，可以以此来注册一些全局都用得到的改动。举例如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;jsx&quot;&gt;&lt;pre class=&quot;language-jsx&quot;&gt;&lt;code class=&quot;language-jsx&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; configure&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; addDecorator &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;@storybook/react&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; Provider &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;mobx-react&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;withProvider&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;story&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Provider&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token spread&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;info&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;story&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Provider&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;loadStories&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// ...&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;addDecorator&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;withProvider&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// ...&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;configure&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;loadStories&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; module&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这样，在 story 中，只需要简单的提供组件就可以了，&lt;code class=&quot;language-text&quot;&gt;decorator&lt;/code&gt; 会自动为组件加上合适的外层 &lt;code class=&quot;language-text&quot;&gt;Provider&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://alligator.io/react/storybook-with-redux/&quot;&gt;参考文档&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[glob]]></title><link>https://laysent.github.io/til/2019/06#2019-06-02</link><guid isPermaLink="false">https://laysent.github.io/til/2019/06#2019-06-02</guid><pubDate>Sun, 02 Jun 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Glob 类似于 Regular Expression，主要的使用场景是用于批量的文件匹配，在 bash 或是配置文件中常常被使用。下面列举了一些常见的语法规则：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;*&lt;/code&gt; 匹配任意多个字符（包括匹配零个）&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;?&lt;/code&gt; 匹配任意一个字符&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;[abc]&lt;/code&gt; 匹配方括号中的任意一个字符&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;[!abc]&lt;/code&gt; 或 &lt;code class=&quot;language-text&quot;&gt;[^abc]&lt;/code&gt; 匹配除了方括号中定义的三个字符外的任意字符&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;[a-z]&lt;/code&gt; 匹配方括号定义范围内的任意一个字符&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;[!a-z]&lt;/code&gt; 或 &lt;code class=&quot;language-text&quot;&gt;[^a-z]&lt;/code&gt; 匹配除了方括号定义范围内的任意一个字符&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;{ab,cd,ef}&lt;/code&gt; 匹配花括号中定义的三个字符串中的任意一个&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;举个例子，如果 Jest 的单元测试文件命名规范的正则表达式是：&lt;code class=&quot;language-text&quot;&gt;.+\.(?:test|spec)\.[tj]sx?$&lt;/code&gt;，也就是匹配下面的这些文件：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;a.test.js&lt;/li&gt;
&lt;li&gt;b.test.jsx&lt;/li&gt;
&lt;li&gt;c.test.ts&lt;/li&gt;
&lt;li&gt;d.test.tsx&lt;/li&gt;
&lt;li&gt;e.spec.js&lt;/li&gt;
&lt;li&gt;f.spec.jsx&lt;/li&gt;
&lt;li&gt;g.spec.ts&lt;/li&gt;
&lt;li&gt;h.spec.tsx&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;那么，相应的 Glob 可以写：&lt;code class=&quot;language-text&quot;&gt;*.{test,spec}.{js,jsx,ts,tsx}&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;如果不涉及到 React 的代码（没有 jsx），可以写成：&lt;code class=&quot;language-text&quot;&gt;*.{test,spec}.[tj]s&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;参考文档：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://en.wikipedia.org/wiki/Glob_(programming)&quot;&gt;Wikipedia&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://www.jedit.org/users-guide/globs.html&quot;&gt;Glob Patterns&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://www.globtester.com/&quot;&gt;globtester&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[Placeholder Images]]></title><link>https://laysent.github.io/til/2019/05#2019-05-31</link><guid isPermaLink="false">https://laysent.github.io/til/2019/05#2019-05-31</guid><pubDate>Fri, 31 May 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;以下整理了一些可用的占位图片服务：&lt;/p&gt;
&lt;section&gt;&lt;h2&gt;lorempixel&lt;/h2&gt;&lt;p&gt;地址：&lt;a href=&quot;http://lorempixel.com/&quot;&gt;http://lorempixel.com/&lt;/a&gt;&lt;/p&gt;&lt;p&gt;参考引用方法：&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;html&quot;&gt;&lt;pre class=&quot;language-html&quot;&gt;&lt;code class=&quot;language-html&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;img&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;src&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;http://lorempixel.com/400/200&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;alt&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;placeholder image&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;/&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;服务会返回随机的照片。可以通过参数选择需要返回的照片的类别（具体方法参考网站上的文档）。&lt;/p&gt;&lt;p&gt;效果：&lt;/p&gt;&lt;img src=&quot;http://lorempixel.com/400/200&quot; alt=&quot;placeholder image&quot;&gt;&lt;/section&gt;
&lt;section&gt;&lt;h2&gt;lorem picsum&lt;/h2&gt;&lt;p&gt;地址：&lt;a href=&quot;https://picsum.photos/&quot;&gt;https://picsum.photos/&lt;/a&gt;&lt;/p&gt;&lt;p&gt;参考引用方法：&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;html&quot;&gt;&lt;pre class=&quot;language-html&quot;&gt;&lt;code class=&quot;language-html&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;img&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;src&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;https://picsum.photos/400/200&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;alt&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;placeholder image&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;/&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;服务会返回随机的照片。可以通过参数选择需要返回的照片的类别（具体方法参考网站上的文档）。&lt;/p&gt;&lt;p&gt;效果：&lt;/p&gt;&lt;img src=&quot;https://picsum.photos/400/200&quot; alt=&quot;placeholder image&quot;&gt;&lt;/section&gt;
&lt;section&gt;&lt;h2&gt;placeholder&lt;/h2&gt;&lt;p&gt;地址：&lt;a href=&quot;https://placeholder.com&quot;&gt;https://placeholder.com&lt;/a&gt;&lt;/p&gt;&lt;p&gt;参考引用方法：&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;html&quot;&gt;&lt;pre class=&quot;language-html&quot;&gt;&lt;code class=&quot;language-html&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;img&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;src&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;https://via.placeholder.com/400x200.png&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;alt&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;placeholder image&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;/&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;服务器会根据要求返回需要的图片，可以指定背景颜色/文字/大小等，具体配置的方法见网站上的文档。&lt;/p&gt;&lt;p&gt;效果：&lt;/p&gt;&lt;img src=&quot;https://via.placeholder.com/400x200.png&quot; alt=&quot;placeholder image&quot;&gt;&lt;/section&gt;
&lt;section&gt;&lt;h2&gt;其他&lt;/h2&gt;&lt;p&gt;其他可以参考的类似服务有：&lt;/p&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://docs.imgix.com/apis/url/text/txt&quot;&gt;imgix&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/section&gt;</content:encoded></item><item><title><![CDATA[Transform node_modules in Jest]]></title><link>https://laysent.github.io/til/2019/05#2019-05-30</link><guid isPermaLink="false">https://laysent.github.io/til/2019/05#2019-05-30</guid><pubDate>Thu, 30 May 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;默认情况下，Jest 配置文件中的 &lt;code class=&quot;language-text&quot;&gt;transform&lt;/code&gt; 属性，是不会被应用到 node_modules 目录下的。如果引用的库本身使用了非 JavaScript 文件（比如 CSS 文件），会造成 Jest 无法正确处理。&lt;/p&gt;
&lt;p&gt;一个可行的替代方案，是用 &lt;code class=&quot;language-text&quot;&gt;moduleNameMapper&lt;/code&gt; 来代替 &lt;code class=&quot;language-text&quot;&gt;transform&lt;/code&gt; 的功能。&lt;/p&gt;
&lt;p&gt;以 CSS 的处理为例：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// ...&lt;/span&gt;
  transform&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token string&quot;&gt;&quot;^.+\\.(less|css)$&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;jest-transform-stub&quot;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// ...&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;上面这个是常规方案，但是对 CSS / Less 的处理不包含 node_modules 的部分。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// ...&lt;/span&gt;
  moduleNameMapper&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token string&quot;&gt;&quot;^.+\\.(less|css)$&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;jest-transform-stub&quot;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// ...&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;上面这个方案，可以达到一样的效果，但是 node_module 内的 CSS 引用也会被正确的处理。&lt;/p&gt;
&lt;p&gt;两种方案没有优劣，主要是看使用的场景。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Style Guide]]></title><link>https://laysent.github.io/til/2019/05#2019-05-29</link><guid isPermaLink="false">https://laysent.github.io/til/2019/05#2019-05-29</guid><pubDate>Wed, 29 May 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;一个网站的 Style Guide 可以方便的展示出基础 HTML 元素的样式，方便查看整体的效果。&lt;/p&gt;
&lt;p&gt;一些值得参考的 Style Guide&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.poormansstyleguide.com/&quot;&gt;Poor Man’s Style Guide&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.chenhuijing.com/styleguide/&quot;&gt;Chen Hui Jing’s Style Guide&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;本网站使用的 &lt;a href=&quot;/styleguide&quot;&gt;Style Guide&lt;/a&gt;。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Upgrade Npm Dependencies]]></title><link>https://laysent.github.io/til/2019/05#2019-05-28</link><guid isPermaLink="false">https://laysent.github.io/til/2019/05#2019-05-28</guid><pubDate>Tue, 28 May 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;npm&lt;/code&gt; 和 &lt;code class=&quot;language-text&quot;&gt;yarn&lt;/code&gt; 都提供升级依赖的命令。&lt;/p&gt;
&lt;p&gt;针对 &lt;code class=&quot;language-text&quot;&gt;npm&lt;/code&gt;，可以使用 &lt;code class=&quot;language-text&quot;&gt;npm update&lt;/code&gt; 来执行，命令格式如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm update [-g] [&amp;lt;pkg&amp;gt;...]&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;更新的时候，默认会更新 &lt;code class=&quot;language-text&quot;&gt;package.json&lt;/code&gt; 文件，可以通过增加 &lt;code class=&quot;language-text&quot;&gt;--no-save&lt;/code&gt; 标记来禁用这一改动。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;npm&lt;/code&gt; 的文档可以看&lt;a href=&quot;https://docs.npmjs.com/cli/update&quot;&gt;这里&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;yarn&lt;/code&gt; 的命令会更加丰富一些，命令格式如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;yarn upgrade [package | package@tag | package@version | @scope/]... [--pattern]&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;其中，&lt;code class=&quot;language-text&quot;&gt;--pattern&lt;/code&gt; 后面可以跟 grep 的 pattern，只有匹配到的依赖会被升级。&lt;/p&gt;
&lt;p&gt;默认情况下，升级会参考 &lt;code class=&quot;language-text&quot;&gt;package.json&lt;/code&gt; 里定义的依赖允许的升级范围来选择可行的最高版本进行升级。如果希望直接升级到最新版本（往往意味着会有 breaking change），那么可以加上 &lt;code class=&quot;language-text&quot;&gt;--latest&lt;/code&gt; 标志。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;yarn&lt;/code&gt; 的文档可以看&lt;a href=&quot;https://yarnpkg.com/lang/en/docs/cli/upgrade/&quot;&gt;这里&lt;/a&gt;。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Recursively delete files by type]]></title><link>https://laysent.github.io/til/2019/05#2019-05-27</link><guid isPermaLink="false">https://laysent.github.io/til/2019/05#2019-05-27</guid><pubDate>Mon, 27 May 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;以下 Bash 代码可以递归删除指定的 &lt;code class=&quot;language-text&quot;&gt;.map&lt;/code&gt; 文件。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;find&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;.&lt;/span&gt; -type f -name &lt;span class=&quot;token string&quot;&gt;&apos;*.map&apos;&lt;/span&gt; -delete&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如果同时希望删除 &lt;code class=&quot;language-text&quot;&gt;.map&lt;/code&gt; 和 &lt;code class=&quot;language-text&quot;&gt;.xxx&lt;/code&gt; 文件，可以加上 &lt;code class=&quot;language-text&quot;&gt;-o&lt;/code&gt; flag&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;find&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;.&lt;/span&gt; -type f -name &lt;span class=&quot;token string&quot;&gt;&apos;*.map&apos;&lt;/span&gt; -o -name &lt;span class=&quot;token string&quot;&gt;&apos;.*&apos;&lt;/span&gt; -delete&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;一些参数说明：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;-type f&lt;/code&gt; 表示需要查找的是文件&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;-name &amp;#39;xxx&amp;#39;&lt;/code&gt; 定义需要匹配的文件名&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;-o&lt;/code&gt; 表示 or，后面可以跟新的匹配规则&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;-delete&lt;/code&gt; 表示匹配到的文件需要被删除&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[CSS for Dark Mode]]></title><link>https://laysent.github.io/til/2019/05#2019-05-24</link><guid isPermaLink="false">https://laysent.github.io/til/2019/05#2019-05-24</guid><pubDate>Fri, 24 May 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;prefers-color-scheme&lt;/code&gt; 这个 Media Query 可以用于检测当前的操作系统是否选择了 Dark Mode。这是一个依然处于初始草案阶段的功能（见 &lt;a href=&quot;https://drafts.csswg.org/mediaqueries-5/#descdef-media-prefers-color-scheme&quot;&gt;Draft&lt;/a&gt;），不过 Safari (12.1) / Chrome (76) / Firefox (67) 的最新版本都已经做了支持。&lt;/p&gt;
&lt;p&gt;示例代码如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;css&quot;&gt;&lt;pre class=&quot;language-css&quot;&gt;&lt;code class=&quot;language-css&quot;&gt;&lt;span class=&quot;token atrule&quot;&gt;&lt;span class=&quot;token rule&quot;&gt;@media&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token property&quot;&gt;prefers-color-scheme&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; dark&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token selector&quot;&gt;body&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;background-color&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; #333&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; #fff&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token selector&quot;&gt;:not(pre) &gt; code[class*=&quot;language-&quot;]&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;background-color&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;rgba&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;255&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;229&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;100&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;0.8&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;下面是一个可编辑的 CSS 代码，可以直接试一试：&lt;/p&gt;
&lt;style&gt;
style.editable-style {
  display: block;
}
&lt;/style&gt;
&lt;p&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; style=&quot;border:1px solid red&quot;&gt;
&lt;pre class=&quot;language-css&quot;&gt;&lt;code class=&quot;language-css&quot;&gt;&lt;style contenteditable class=&quot;editable-style&quot;&gt;@media (prefers-color-scheme: dark) { body { /* try here */ } }&lt;/style&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;&lt;/p&gt;
&lt;p&gt;注：上面这段代码是可改的，修改后的 CSS 会直接生效。但是由于 &lt;code class=&quot;language-text&quot;&gt;contenteditable&lt;/code&gt; 的限制，所有代码需要在一行内完成。&lt;/p&gt;
&lt;p&gt;除了 &lt;code class=&quot;language-text&quot;&gt;dark&lt;/code&gt; 之外，&lt;code class=&quot;language-text&quot;&gt;prefers-color-scheme&lt;/code&gt; 可以接受的属性还有 &lt;code class=&quot;language-text&quot;&gt;light&lt;/code&gt; 和 &lt;code class=&quot;language-text&quot;&gt;no-preference&lt;/code&gt; 两种。其中，&lt;code class=&quot;language-text&quot;&gt;light&lt;/code&gt; 表示用户选择的是 Light 模式，&lt;code class=&quot;language-text&quot;&gt;no-preference&lt;/code&gt; 表示用户并没有做选择。&lt;/p&gt;
&lt;p&gt;在 JavaScript 中，也可以通过下面的代码来判断当前是否是 Dark Mode：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; ifDarkMode &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; window&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;matchMedia&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;(prefers-color-scheme: dark)&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;matches&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;注：从当前的实验结果来看，&lt;code class=&quot;language-text&quot;&gt;matchMedia&lt;/code&gt; 的结果用 &lt;code class=&quot;language-text&quot;&gt;.addListener&lt;/code&gt; 注册回调事件并不能生效（Safari 12 测试）。&lt;/p&gt;
&lt;p&gt;如果图片的展示也需要区分，&lt;code class=&quot;language-text&quot;&gt;mediaQuery&lt;/code&gt; 也可以帮上忙：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;html&quot;&gt;&lt;pre class=&quot;language-html&quot;&gt;&lt;code class=&quot;language-html&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;picture&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;source&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;srcset&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;mojave-night.jpg&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;media&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;(prefers-color-scheme: dark)&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;img&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;src&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;mojave-day.jpg&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;picture&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[rxjs and hooks]]></title><link>https://laysent.github.io/til/2019/05#2019-05-23</link><guid isPermaLink="false">https://laysent.github.io/til/2019/05#2019-05-23</guid><pubDate>Thu, 23 May 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;一直以来，&lt;a href=&quot;https://github.com/ReactiveX/rxjs&quot;&gt;rxjs&lt;/a&gt; 和 &lt;a href=&quot;https://github.com/facebook/react&quot;&gt;react&lt;/a&gt; 都不太搭，要在 React 中使用 rxjs 往往需要写并不怎么优雅的代码，比如：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;jsx&quot;&gt;&lt;pre class=&quot;language-jsx&quot;&gt;&lt;code class=&quot;language-jsx&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Example&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;React&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Component&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;constructor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;props&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;super&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; initial &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;state &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      value&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; initial&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;subscription &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;componentDidMount&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;register&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;componentDidUpdate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;prevProps&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;prevProps&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;value$ &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;value$&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;unregister&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;register&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;componentWillUnmount&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;unregister&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;register&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;subscription &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;value$
      &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;subscribe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setState&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; value &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;unregister&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;subscription&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;subscription&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;unsubscribe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; value &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;state&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
      &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;value&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

ReactDOM&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Example value$&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;interval&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; document&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;body&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;上面这段代码，会根据 &lt;code class=&quot;language-text&quot;&gt;value$&lt;/code&gt; 这个 Observable 的数据，通过 React State 这个桥梁，去更新 UI。并且，代码考虑到了给定的 &lt;code class=&quot;language-text&quot;&gt;value$&lt;/code&gt; 可能后续变化的情况。如果不考虑后续 &lt;code class=&quot;language-text&quot;&gt;props&lt;/code&gt; 的修改，上面的代码依然需要在 &lt;code class=&quot;language-text&quot;&gt;componentDidMount&lt;/code&gt; 的时候注册回调并更新，然后在 &lt;code class=&quot;language-text&quot;&gt;componentWillUnmount&lt;/code&gt; 的时候注销，显得非常的啰嗦。&lt;/p&gt;
&lt;p&gt;LeetCode 提供的 &lt;a href=&quot;https://github.com/LeetCode-OpenSource/rxjs-hooks&quot;&gt;rxjs-hooks&lt;/a&gt; 提供了一个更为优雅的解决方案：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;jsx&quot;&gt;&lt;pre class=&quot;language-jsx&quot;&gt;&lt;code class=&quot;language-jsx&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;Example&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;props&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; initial &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; value &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;useObservable&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;inputs$&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; inputs$&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;pipe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;switchMap&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;value$&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; value$&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    initial&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;value$&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;value&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

ReactDOM&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Example value$&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;interval&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; document&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;body&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;rxjs-hooks 另外提供了 &lt;code class=&quot;language-text&quot;&gt;useEventCallback&lt;/code&gt; 来更好的处理事件流，具体可以查看官方的&lt;a href=&quot;https://github.com/LeetCode-OpenSource/rxjs-hooks#useeventcallback&quot;&gt;文档&lt;/a&gt;。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Disk Usage of Folder]]></title><link>https://laysent.github.io/til/2019/05#2019-05-22</link><guid isPermaLink="false">https://laysent.github.io/til/2019/05#2019-05-22</guid><pubDate>Wed, 22 May 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;如果需要对目录下文件的占用空间做排序，可以使用下面的命令：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;du&lt;/span&gt; -d 3 -k &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;sort&lt;/span&gt; -h&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;其中，&lt;code class=&quot;language-text&quot;&gt;du -d 3&lt;/code&gt; 表示，最多显示三层子目录，&lt;code class=&quot;language-text&quot;&gt;-k&lt;/code&gt; 会让输出以 &lt;code class=&quot;language-text&quot;&gt;KB&lt;/code&gt; 作为单位。&lt;code class=&quot;language-text&quot;&gt;sort -h&lt;/code&gt; 会对结果进行排序，排序的依据是文件夹的大小。这里，排序需要带上 &lt;code class=&quot;language-text&quot;&gt;-h&lt;/code&gt; 的标识位，不然以字符串进行排序的话，输出没有意义（比如，100 会排在 9 的前面）。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Extract all function properties from given type]]></title><link>https://laysent.github.io/til/2019/05#2019-05-21</link><guid isPermaLink="false">https://laysent.github.io/til/2019/05#2019-05-21</guid><pubDate>Tue, 21 May 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;假设有一个 TypeScript 的类型是：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;interface&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Example&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  str&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  num&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;number&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token function-variable function&quot;&gt;func1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;param1&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; param2&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;number&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token function-variable function&quot;&gt;func2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;以下这个 TypeScript 的定义，可以用于将 &lt;code class=&quot;language-text&quot;&gt;T&lt;/code&gt; 中函数的部分抽离出来，形成新的类型：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; Pick&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;K&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;keyof&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;P&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;K&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;P&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; FunctionPropertyNames&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;K&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;keyof&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;K&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Function&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;K&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;never&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;keyof&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;最终，新类型的定义如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; Result &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Pick&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Example&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; FunctionPropertyNames&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Example&lt;span class=&quot;token operator&quot;&gt;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;等价于：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;interface&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Equivalent&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token function-variable function&quot;&gt;func1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;param1&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; param2&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;number&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token function-variable function&quot;&gt;func2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[classnames & css module]]></title><link>https://laysent.github.io/til/2019/05#2019-05-20</link><guid isPermaLink="false">https://laysent.github.io/til/2019/05#2019-05-20</guid><pubDate>Mon, 20 May 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;a href=&quot;https://github.com/JedWatson/classnames&quot;&gt;classnames&lt;/a&gt; 库提供了一个 &lt;code class=&quot;language-text&quot;&gt;bind&lt;/code&gt; API，用于处理 CSS Module 的情况。&lt;/p&gt;
&lt;p&gt;在 Webpack 中用 CSS Module 的方案编译 CSS 文件，后续在 JavaScript 中 &lt;code class=&quot;language-text&quot;&gt;import style from &amp;#39;xxx.css&amp;#39;;&lt;/code&gt; 后，&lt;code class=&quot;language-text&quot;&gt;style&lt;/code&gt; 就是一个对象。这个对象的大体结构如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;style &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  foo&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;foo-abcde&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  bar&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;bar-12345&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// ...&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;其中，对象的 &lt;code class=&quot;language-text&quot;&gt;key&lt;/code&gt; 是原始的 class name，而 &lt;code class=&quot;language-text&quot;&gt;value&lt;/code&gt; 则是施加 CSS Module 之后得到的唯一名称。&lt;/p&gt;
&lt;p&gt;如果直接使用 &lt;code class=&quot;language-text&quot;&gt;classnames&lt;/code&gt; 的标准 API，那么写起来就需要大量使用 computed property name 的语法，比如：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;jsx&quot;&gt;&lt;pre class=&quot;language-jsx&quot;&gt;&lt;code class=&quot;language-jsx&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;className&lt;/span&gt;&lt;span class=&quot;token script language-javascript&quot;&gt;&lt;span class=&quot;token script-punctuation punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;classnames&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;style&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;foo&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;style&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;bar&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;/&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;而使用 &lt;code class=&quot;language-text&quot;&gt;bind&lt;/code&gt; API，可以事先告知 &lt;code class=&quot;language-text&quot;&gt;classnames&lt;/code&gt; class name 的对应关系（通过指定 &lt;code class=&quot;language-text&quot;&gt;this&lt;/code&gt;），后续只需要使用字符串，&lt;code class=&quot;language-text&quot;&gt;classnames&lt;/code&gt; 就可以自动使用合适的结果：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;jsx&quot;&gt;&lt;pre class=&quot;language-jsx&quot;&gt;&lt;code class=&quot;language-jsx&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; classNames &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;classnames/bind&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; styles &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./style.css&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; cx &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;classNames&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;bind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;styles&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;Component&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// result in: className=&quot;foo-abcde&quot;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;className&lt;/span&gt;&lt;span class=&quot;token script language-javascript&quot;&gt;&lt;span class=&quot;token script-punctuation punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;cx&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; foo&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; bar&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;/&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[Multiple Git Configuration]]></title><link>https://laysent.github.io/til/2019/05#2019-05-19</link><guid isPermaLink="false">https://laysent.github.io/til/2019/05#2019-05-19</guid><pubDate>Sun, 19 May 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;对于有多个 Git 仓库的情况，不同的仓库可能需要配置不同的用户信息。&lt;/p&gt;
&lt;p&gt;一种麻烦的方案是，每个仓库都配置一个本地的 Git 配置，不使用全局的设置，就不会有问题。但是这样配置非常的麻烦，也容易忘。Git 提供了配置覆盖的功能，可以指定某一子目录，使用另外一个指定的 Git 配置覆盖默认的全剧配置。&lt;/p&gt;
&lt;p&gt;如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;[includeIf &amp;quot;gitdir:~/work/github/&amp;quot;]
    path = ~/work/github/.gitconfig&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这个配置指定了在 &lt;code class=&quot;language-text&quot;&gt;~/work/github/&lt;/code&gt; 目录下，除了全局的 &lt;code class=&quot;language-text&quot;&gt;.gitconfig&lt;/code&gt; 文件之外，读取 &lt;code class=&quot;language-text&quot;&gt;~/work/github/.gitconfig&lt;/code&gt; 文件对配置进行覆盖改写。在 &lt;code class=&quot;language-text&quot;&gt;~/work/github/.gitconfig&lt;/code&gt; 的优先级高于 &lt;code class=&quot;language-text&quot;&gt;~/.gitconfig&lt;/code&gt; 的配置，会优先使用，没有定义的部分才会去全局中找。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Command to enter folder after git clone]]></title><link>https://laysent.github.io/til/2019/05#2019-05-17</link><guid isPermaLink="false">https://laysent.github.io/til/2019/05#2019-05-17</guid><pubDate>Fri, 17 May 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;下面的脚本，执行之后，可以完成 &lt;code class=&quot;language-text&quot;&gt;git clone&lt;/code&gt; 并 &lt;code class=&quot;language-text&quot;&gt;cd&lt;/code&gt; 至目标文件夹内。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;f&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  local tmp&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;$(&lt;/span&gt;mktemp&lt;span class=&quot;token variable&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  local repo_name&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;git&lt;/span&gt; clone &lt;span class=&quot;token variable&quot;&gt;$@&lt;/span&gt; --progress 2&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;1 &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;tee&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$tmp&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  repo_name&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;awk&lt;/span&gt; -F\&lt;span class=&quot;token string&quot;&gt;&apos; &apos;&lt;/span&gt;/Cloning into/ &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;print $2&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&apos; $tmp&lt;span class=&quot;token variable&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;rm&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$tmp&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;cd&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$repo_name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
f&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;一些说明：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;mktemp&lt;/code&gt; 可以创建一个临时文件，文件路径存放在 &lt;code class=&quot;language-text&quot;&gt;tmp&lt;/code&gt; 变量中&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;git clone $@&lt;/code&gt; 中的 &lt;code class=&quot;language-text&quot;&gt;$@&lt;/code&gt; 是执行脚本时候所有的传入参数&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;---progress 2&amp;gt;&amp;amp;1&lt;/code&gt; 会将 Git clone 命令的结果输出。这里，默认情况下，clone 的过程数据只有在 error stream 输出到 terminal 的时候，才会显示。因为这里的命令需要将内容通过管道输出到 &lt;code class=&quot;language-text&quot;&gt;tmp&lt;/code&gt; 临时文件中，所以默认情况下 Git 就不会输出过程的数据了。为了能够让 Git 输出这部分内容，需要加上 &lt;code class=&quot;language-text&quot;&gt;--progress&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;tee $tmp&lt;/code&gt; 将管道的数据输出到临时文件中&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;awk -F\&amp;#39; &amp;#39;/Cloning into/ {print $2}&amp;#39; $tmp&lt;/code&gt; 的部分，会从输出的数据中，寻找 &lt;code class=&quot;language-text&quot;&gt;Cloning into&lt;/code&gt; 的输出，然后找到具体 clone 到了哪个文件夹中&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[Object.create(null)]]></title><link>https://laysent.github.io/til/2019/05#2019-05-16</link><guid isPermaLink="false">https://laysent.github.io/til/2019/05#2019-05-16</guid><pubDate>Thu, 16 May 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Object.create&lt;/code&gt; 可以用提供的对象做新对象的 &lt;code class=&quot;language-text&quot;&gt;__proto__&lt;/code&gt;。这导致了一个很有趣的现象，如果使用 &lt;code class=&quot;language-text&quot;&gt;Object.create(null)&lt;/code&gt; 来创建新对象，那么这个新对象上就没有任何 &lt;code class=&quot;language-text&quot;&gt;__proto__&lt;/code&gt;。因为 JavaScript 的对象经常被用来做字典使用，&lt;code class=&quot;language-text&quot;&gt;Object.create(null)&lt;/code&gt; 可以让这个功能使用更加的纯粹。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; dict &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Object&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;create&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Object&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getPrototypeOf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;dict&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// output: null&lt;/span&gt;
console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;typeof&lt;/span&gt; dict&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;hasOwnProperty&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// output: &quot;undefined&quot;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; obj &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Object&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getPrototypeOf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;obj&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// output:&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// {&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;//   constructor,&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;//   hasOwnProperty,&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;//   isPrototypeOf,&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;//   propertyIsEnumerable,&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;//   toLocaleString,&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;//   toString,&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;//   valueOf,&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;//   ...&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// }&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;同样，因为没有 &lt;code class=&quot;language-text&quot;&gt;prototype&lt;/code&gt;，理论上来说，后续如果有人对 &lt;code class=&quot;language-text&quot;&gt;Object.prototype&lt;/code&gt; 做操作，也不会影响到使用。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; dict &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Object&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;create&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// ...&lt;/span&gt;
&lt;span class=&quot;token class-name&quot;&gt;Object&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;prototype&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function-variable function&quot;&gt;addSomething&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;typeof&lt;/span&gt; dict&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;addSomething&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// output: undefined&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; key &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; dict&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// no output&lt;/span&gt;

console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;typeof&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;addSomething&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// output: function&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; key &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// output: &apos;addSomething&apos;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;所以，如果判断对象有某个字段，那么一定是他自身有这个字段，而不会是因为原型链上的定义。也就是说，不需要用：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Object&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;prototype&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;hasOwnProperty&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;call&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;dict&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;addSomething&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// ...&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;而只需要写：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;dict&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;addSomething&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// ...&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;当然，这也会有一些弊端，比如默认 &lt;code class=&quot;language-text&quot;&gt;Object.prototype&lt;/code&gt; 的东西就没了，如果需要 &lt;code class=&quot;language-text&quot;&gt;toString&lt;/code&gt; 之类的函数，得自己写。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Deletion of file in git]]></title><link>https://laysent.github.io/til/2019/05#2019-05-15</link><guid isPermaLink="false">https://laysent.github.io/til/2019/05#2019-05-15</guid><pubDate>Wed, 15 May 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;假设发现一个文件在历史版本中存在，但是当前不存在了，那么可能就需要知道是在什么时候，因为什么原因对文件做了删除。下面的命令可以一次性找出某一个文件的所有记录：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;git&lt;/span&gt; log --full-history -- &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;file path&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如果只需要看最后一条记录（也就是被删除的那条记录），可以用：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;git&lt;/span&gt; log --full-history -1 -- &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;file path&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[Open Application in Terminal]]></title><link>https://laysent.github.io/til/2019/05#2019-05-14</link><guid isPermaLink="false">https://laysent.github.io/til/2019/05#2019-05-14</guid><pubDate>Tue, 14 May 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;在 Mac 系统里面，&lt;code class=&quot;language-text&quot;&gt;.app&lt;/code&gt; 程序本质上就是一个目录，里面包含了很多文件。如果直接在 Terminal 输入 &lt;code class=&quot;language-text&quot;&gt;.app&lt;/code&gt; 的地址，会进入这个目录，而不是运行这个 App。如果需要运行，可以使用下面的命令：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;open&lt;/span&gt; /Application/Example.app&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如果需要指定 &lt;code class=&quot;language-text&quot;&gt;NODE_ENV&lt;/code&gt; 等信息，就可以一起配合使用&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;NODE_ENV&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;development &lt;span class=&quot;token function&quot;&gt;open&lt;/span&gt; /Application/Example.app&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[performance data via JavaScript]]></title><link>https://laysent.github.io/til/2019/05#2019-05-13</link><guid isPermaLink="false">https://laysent.github.io/til/2019/05#2019-05-13</guid><pubDate>Mon, 13 May 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;JavaScript 的 &lt;code class=&quot;language-text&quot;&gt;performance&lt;/code&gt; 除了常用的 &lt;code class=&quot;language-text&quot;&gt;now&lt;/code&gt; / &lt;code class=&quot;language-text&quot;&gt;mark&lt;/code&gt; 之外，也提供了和页面加载相关的很多接口。通过调用这些接口，就可以很方便的收集页面加载的相关指标，方便了解不同用户的实际体验。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;perfomance.getEntries&lt;/code&gt; 返回的数据，有三种类型：&lt;code class=&quot;language-text&quot;&gt;navigation&lt;/code&gt;，&lt;code class=&quot;language-text&quot;&gt;resource&lt;/code&gt;，&lt;code class=&quot;language-text&quot;&gt;paint&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;其中，&lt;code class=&quot;language-text&quot;&gt;navigation&lt;/code&gt; 包含了 &lt;code class=&quot;language-text&quot;&gt;PerformanceNavigationTiming&lt;/code&gt;，里面记录了和页面导航相关的时间信息，比如 connection 的起始/结束时间等。可以通过下面的代码拿到完整的数据：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;performance&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getEntriesByType&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;navigation&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toJSON&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// output:&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// connectEnd: xxx&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// connectStart: xxx&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// ...&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;resource&lt;/code&gt; 包含了所有的 &lt;code class=&quot;language-text&quot;&gt;PerformanceResourceTiming&lt;/code&gt;。每一个资源的请求，对应一个 &lt;code class=&quot;language-text&quot;&gt;PerformanceResourceTiming&lt;/code&gt;。例子：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;performance&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getEntriesByType&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;resource&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;forEach&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; name&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; duration &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;`resource: &lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;name&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt; use &lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;duration&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt; milliseconds to load`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// output:&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// resource: https://xxxx use xxx milliseconds to load&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// ...&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;paint&lt;/code&gt; 包含了所有的 &lt;code class=&quot;language-text&quot;&gt;PerformancePaintTiming&lt;/code&gt;。一共有两个，分别是 first-paint 和 first-contentful-paint。例子：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;performance&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getEntriesByType&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;paint&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;forEach&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; name&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; startTime &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;`name: &lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;name&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;, startTime: &lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;startTime&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// output:&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// first-paint: xxxx&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// first-contentful-paint: xxx&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[download third party resource]]></title><link>https://laysent.github.io/til/2019/05#2019-05-10</link><guid isPermaLink="false">https://laysent.github.io/til/2019/05#2019-05-10</guid><pubDate>Fri, 10 May 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;在 HTML 中，如果一个 &lt;code class=&quot;language-text&quot;&gt;a&lt;/code&gt; 标签，带上了 &lt;code class=&quot;language-text&quot;&gt;download&lt;/code&gt; 的属性，链接地址就会被浏览器直接用于下载。使用方法如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;html&quot;&gt;&lt;pre class=&quot;language-html&quot;&gt;&lt;code class=&quot;language-html&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;a&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;href&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;link_here&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;download&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;filename.suffix&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;Link&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;a&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;同样，如果需要 JavaScript 能够直接触发一个资源的下载，可以创建带 &lt;code class=&quot;language-text&quot;&gt;download&lt;/code&gt; 属性的 &lt;code class=&quot;language-text&quot;&gt;a&lt;/code&gt; 标签，然后调用这个元素的 &lt;code class=&quot;language-text&quot;&gt;click&lt;/code&gt; 方法。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; a &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; document&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;createDocument&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;a&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
a&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;href &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;link_here&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
a&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;download &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;filename&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
document&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;body&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;appendChild&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;a&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
a&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;click&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// trigger download&lt;/span&gt;
document&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;body&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;removeChild&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;a&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;download&lt;/code&gt; 的支持情况见&lt;a href=&quot;https://caniuse.com/download/embed&quot;&gt;这里&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;这个方案有一个问题：如果是跨域的资源，直接这样的 &lt;code class=&quot;language-text&quot;&gt;a&lt;/code&gt; 标签点击是不能调用下载的（因为执行了严格的同源策略），行为上就会和一个普通的导航没有区别（比如，增加 &lt;code class=&quot;language-text&quot;&gt;target=_blank&lt;/code&gt; 之后就会打开一个新窗口展示资源）。&lt;/p&gt;
&lt;p&gt;解决跨域的一个前端方案是：fetch 资源，然后将结果转化成 Blob，然后将这个 Blob 生成一个 URL。代码如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token function&quot;&gt;fetch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;link_here&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;then&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;repsonse&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;blob&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;then&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;blob&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;URL&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;createObjectURL&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;blob&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;then&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;link&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; a &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; document&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;createElement&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;a&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    a&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;href &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; link&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    a&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;download &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;filename.here&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    document&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;body&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;appendChild&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    a&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;click&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    document&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;body&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;removeChild&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[Promise.allSettled]]></title><link>https://laysent.github.io/til/2019/05#2019-05-09</link><guid isPermaLink="false">https://laysent.github.io/til/2019/05#2019-05-09</guid><pubDate>Thu, 09 May 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Promise.allSettled 已经在 Chrome 76 中上线了。&lt;/p&gt;
&lt;p&gt;一个简单的例子：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; promises &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
  Promise&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;resolve&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;fulfilled&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  Promise&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;reject&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;rejected&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

Promise&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;allSettled&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;promises&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;then&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;/**
     * output:
     * [
     *   { status: &apos;fulfilled&apos;, value: &apos;fulfilled&apos; },
     *   { status: &apos;rejected&apos;, reason: &apos;rejected&apos; },
     * ]
     */&lt;/span&gt;
    console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;result&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;只有所有数组中的 Promise 的结果不再是 &lt;code class=&quot;language-text&quot;&gt;pending&lt;/code&gt;，&lt;code class=&quot;language-text&quot;&gt;.allSettled&lt;/code&gt; 才会返回结果。&lt;/p&gt;
&lt;p&gt;和 &lt;code class=&quot;language-text&quot;&gt;.all&lt;/code&gt;，&lt;code class=&quot;language-text&quot;&gt;.race&lt;/code&gt; 两个 API 最大的区别在于，&lt;code class=&quot;language-text&quot;&gt;.allSettled&lt;/code&gt; 不会提前结束。&lt;code class=&quot;language-text&quot;&gt;.all&lt;/code&gt; 会在任意一个 Promise &lt;code class=&quot;language-text&quot;&gt;reject&lt;/code&gt; 的时候失败，而 &lt;code class=&quot;language-text&quot;&gt;.race&lt;/code&gt; 则会在任意一个 Promise &lt;code class=&quot;language-text&quot;&gt;fulfilled&lt;/code&gt; 的时候成功。&lt;code class=&quot;language-text&quot;&gt;.allSettled&lt;/code&gt; 会等到所有结果都出来之后，再如实返回（以 &lt;code class=&quot;language-text&quot;&gt;fulfilled&lt;/code&gt; 的状态）。&lt;/p&gt;
&lt;p&gt;需要注意的是，返回的结果是一个数组，其中的每一个元素都是一个对象。其中，每个对象都有 &lt;code class=&quot;language-text&quot;&gt;status&lt;/code&gt; 的字段，表示对应的 Promise 最终的结果是 &lt;code class=&quot;language-text&quot;&gt;fulfilled&lt;/code&gt; 还是 &lt;code class=&quot;language-text&quot;&gt;rejected&lt;/code&gt;。如果是 &lt;code class=&quot;language-text&quot;&gt;fulfilled&lt;/code&gt; 状态，那么对象会有 &lt;code class=&quot;language-text&quot;&gt;value&lt;/code&gt; 字段，值相当于 &lt;code class=&quot;language-text&quot;&gt;.then&lt;/code&gt; 回调中的第一个参数；如果是 &lt;code class=&quot;language-text&quot;&gt;rejected&lt;/code&gt; 状态，那么对象会有 &lt;code class=&quot;language-text&quot;&gt;reason&lt;/code&gt; 字段，值相当于 &lt;code class=&quot;language-text&quot;&gt;.catch&lt;/code&gt; 回调中的第一个参数。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[debuglog in node.js]]></title><link>https://laysent.github.io/til/2019/05#2019-05-08</link><guid isPermaLink="false">https://laysent.github.io/til/2019/05#2019-05-08</guid><pubDate>Wed, 08 May 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;在 Node.js 中，&lt;code class=&quot;language-text&quot;&gt;utils&lt;/code&gt; 提供了 &lt;code class=&quot;language-text&quot;&gt;debuglog&lt;/code&gt; 模块可以用于调试信息的输出。默认情况下，&lt;code class=&quot;language-text&quot;&gt;debuglog&lt;/code&gt; 的内容是不会输出的，只有当 &lt;code class=&quot;language-text&quot;&gt;NODE_DEBUG&lt;/code&gt; 这个环境变量设置了合适的值，输出才会显示。这样，调试信息不会影响正常的使用，同时也依然保留了调试的需求。&lt;/p&gt;
&lt;p&gt;具体的使用如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; debuglog &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;util&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;debuglog&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;name&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;debuglog&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;hello world: [%d]&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;上面的例子中，如果直接运行，是不会包含 &lt;code class=&quot;language-text&quot;&gt;hello world: 1&lt;/code&gt; 的输出的。如果设置 &lt;code class=&quot;language-text&quot;&gt;NODE_DEBUG&lt;/code&gt; 为 &lt;code class=&quot;language-text&quot;&gt;name&lt;/code&gt;（也就是 &lt;code class=&quot;language-text&quot;&gt;debuglog&lt;/code&gt; 函数调用时设置的值），那么再次运行，&lt;code class=&quot;language-text&quot;&gt;hello world: 1&lt;/code&gt; 就会输出了。&lt;/p&gt;
&lt;p&gt;同时，可以用逗号分隔的方式一次性为 &lt;code class=&quot;language-text&quot;&gt;NODE_DEBUG&lt;/code&gt; 设置多个值，比如：&lt;code class=&quot;language-text&quot;&gt;NODE_DEBUG=foo,bar&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;在 Mac 下，一次性设置 &lt;code class=&quot;language-text&quot;&gt;NODE_DEBUG&lt;/code&gt; 可以输入：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;NODE_DEBUG&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;name node ./index.js&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;在 Windows 下（Powershell），设置 &lt;code class=&quot;language-text&quot;&gt;NODE_DEBUG&lt;/code&gt; 可以输入：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;powershell&quot;&gt;&lt;pre class=&quot;language-powershell&quot;&gt;&lt;code class=&quot;language-powershell&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;$env&lt;/span&gt;:NODE_DEBUG=&lt;span class=&quot;token string&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; node &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;index&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;js&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;设置完成之后，&lt;code class=&quot;language-text&quot;&gt;NODE_DEBUG&lt;/code&gt; 会一直保留着，直到 powershell 被关闭。需要删掉原先设置的 &lt;code class=&quot;language-text&quot;&gt;NODE_DEBUG&lt;/code&gt;，可以输入：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;powershell&quot;&gt;&lt;pre class=&quot;language-powershell&quot;&gt;&lt;code class=&quot;language-powershell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;Remove-Item&lt;/span&gt; env:\NODE_DEBUG&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[custom display time of notification]]></title><link>https://laysent.github.io/til/2019/05#2019-05-07</link><guid isPermaLink="false">https://laysent.github.io/til/2019/05#2019-05-07</guid><pubDate>Tue, 07 May 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;浏览器显示 Notification 默认是有一个自动消失时间的。不同的浏览器，这里的消失时间并不一致，从测试来看：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Chrome: ~6s&lt;/li&gt;
&lt;li&gt;Firefox: ~19s&lt;/li&gt;
&lt;li&gt;Edge: ~6s&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;从目前浏览器公开的 API 来看，并没有一个接口可以直观的修改这里的消失时间。一个可行的解决方案是：用 &lt;code class=&quot;language-text&quot;&gt;requireInteraction&lt;/code&gt; 来强制要求浏览器不自动关闭 Notification，然后设置 &lt;code class=&quot;language-text&quot;&gt;setTimeout&lt;/code&gt; 并在合适的时机手动关闭这个显示的 Notification。&lt;/p&gt;
&lt;p&gt;示例代码如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; delay &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
Notification&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;requestPermission&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;status&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;status &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;granted&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; notification &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Notification&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
      &lt;span class=&quot;token string&quot;&gt;&quot;Hi! &quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        requireInteraction&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; timer &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;setTimeout&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      notification&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; delay&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;目前 &lt;code class=&quot;language-text&quot;&gt;requireInteraction&lt;/code&gt; 的浏览器支持情况并不非常理想，只有 Chrome, Edge(17+) 和 Opera 做了支持。具体的支持列表，可以看&lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/API/Notification/requireInteraction&quot;&gt;这里&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;另外，从实际的使用上来看，Edge 浏览器中即使设置了 &lt;code class=&quot;language-text&quot;&gt;requireInteraction&lt;/code&gt;，notification 在一定时间之后也会消失，只是消失的时间会比原来默认的情况要长一些，大约是 25 秒。Chrome 的 Notification 如果设置了 &lt;code class=&quot;language-text&quot;&gt;requireInteraction&lt;/code&gt;，会多一个 Close 的按钮，展示效果和没有 &lt;code class=&quot;language-text&quot;&gt;requireInteraction&lt;/code&gt; 的情况有所不同。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[context menu of electron]]></title><link>https://laysent.github.io/til/2019/05#2019-05-06</link><guid isPermaLink="false">https://laysent.github.io/til/2019/05#2019-05-06</guid><pubDate>Mon, 06 May 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Electron 默认是没有右键支持的，右键点击也不会有效果。为了能够提供一些右键的行为，需要在合适的时间点，手动构造菜单并显示出来。&lt;/p&gt;
&lt;p&gt;这里对右键点击的判断，如果放在 render 层用 JavaScript 去监听 &lt;code class=&quot;language-text&quot;&gt;contextmenu&lt;/code&gt; 事件，虽然可以从 &lt;code class=&quot;language-text&quot;&gt;event.target&lt;/code&gt; 上拿到元素，但是要判断当前选择的位置、能否选择/黏贴、是否有拼写错误的单词等，都比较困难，很容易写出问题来。&lt;/p&gt;
&lt;p&gt;Electron 暴露了 Chromium 的数据，在 WebContents 中增加了 &lt;code class=&quot;language-text&quot;&gt;context-menu&lt;/code&gt; 的事件。在这个事件的回调函数中，提供了很多的数据，能够帮助更好的了解当前的右键点击状态，从而更好地显示右键菜单项。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;context-menu&lt;/code&gt; 的文档见&lt;a href=&quot;https://electronjs.org/docs/api/web-contents#event-context-menu&quot;&gt;这里&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;这个功能提交的 Pull Request 见 &lt;a href=&quot;https://github.com/electron/electron/pull/5379&quot;&gt;#5379&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;在 &lt;code class=&quot;language-text&quot;&gt;context-menu&lt;/code&gt; 的回调函数中，第二个参数提供了非常多有用的数据，比如：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;selectionText - 选中的文字&lt;/li&gt;
&lt;li&gt;misspelledWord - 当前的拼写错误单词（如果没有拼写错误，这里的返回是空字符串）&lt;/li&gt;
&lt;li&gt;editFlags - 包含了 &lt;code class=&quot;language-text&quot;&gt;canCut&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;canCopy&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;canPaste&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;canSelectAll&lt;/code&gt; 等各式布尔值，用于表示当前右键的位置是否允许剪切/复制/黏贴/全选等操作。完整的列表可以参考&lt;a href=&quot;https://electronjs.org/docs/api/web-contents#event-context-menu&quot;&gt;文档&lt;/a&gt;。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;一个例子：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; remote&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Menu &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;electron&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; webContents &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; remote&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getCurrentWebContents&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;buildMenuFromSuggestions&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;suggestions&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;suggestions&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; suggestions&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;suggestion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      label&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; suggestion&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token function-variable function&quot;&gt;click&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        webContents&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;replaceMisspelling&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;suggestion&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;concat&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; type&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;separator&apos;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

webContents&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;on&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;context-menu&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;event&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; info&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; canCut&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; canCopy&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; canPaste&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; canSelectAll &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; info&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;editFlags&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; misspelledWord &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; info&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// use your own function of `getCorrections`&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; suggestions &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getCorrections&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;misspelledWord&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; menuConfig &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;buildMenuFromSuggestions&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;suggestions&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;concat&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; label&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Cut&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; role&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;cut&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; enabled&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; canCut &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; label&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Copy&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; role&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;copy&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; enabled&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; canCopy &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; label&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Paste&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; role&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;paste&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; enabled&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; canPaste &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        label&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Select All&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        enabled&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; canSelectAll&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// role: &apos;selectAll&apos;&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// following shows an example of how to manually call the API&lt;/span&gt;
        click&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; webContents&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;selectAll&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; menu &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; remote&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Menu&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;buildFromTemplate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;menuConfig&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  menu&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;popup&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;remote&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getCurrentWindow&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[contenteditable style]]></title><link>https://laysent.github.io/til/2019/05#2019-05-05</link><guid isPermaLink="false">https://laysent.github.io/til/2019/05#2019-05-05</guid><pubDate>Sun, 05 May 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;style&lt;/code&gt; 本身是一个标准的 HTML 标签，在里面写的 CSS 样式，会被应用到页面上。同时，作为一个 HTML 标签，&lt;code class=&quot;language-text&quot;&gt;style&lt;/code&gt; 本身也可以被赋予一定的展示样式（比如将默认的 &lt;code class=&quot;language-text&quot;&gt;style { display: none; }&lt;/code&gt; 给覆盖掉）。加上 &lt;code class=&quot;language-text&quot;&gt;contenteditable&lt;/code&gt; 的属性，就会得到一个可编写的 &lt;code class=&quot;language-text&quot;&gt;style&lt;/code&gt; 标签。通过直接编写其中的 CSS 样式，页面会自动更新，展示应用样式后的效果。&lt;/p&gt;
&lt;style&gt;

.editable-style-indicator {
  width: 20px;
  height: 20px;
  border-radius: 20px;
  margin-left: 3px;
  background-color: #e65525;
  box-shadow: 0 0 0 3px #e78267;
}
.editable-style-indicator:hover + style.editable-style,
style.editable-style:focus,
style.editable-style:hover {
  display: block;
  min-height: 5rem;
  max-height: 10rem;
  overflow: auto;
  margin-top: -23px;
  background-color: #ccc;
}
&lt;/style&gt;
&lt;p&gt;&lt;/p&gt;
&lt;div class=&quot;editable-style-indicator&quot;&gt;&lt;/div&gt;
&lt;style contenteditable class=&quot;editable-style&quot;&gt;&lt;/style&gt;
&lt;p&gt;&lt;/p&gt;
&lt;p&gt;上面展示的这个圆点，鼠标悬停之后，就会显示一个可输入的框。在里面输入一些 CSS 可以看到对页面元素的修改。比如，可以试试输入：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;css&quot;&gt;&lt;pre class=&quot;language-css&quot;&gt;&lt;code class=&quot;language-css&quot;&gt;&lt;span class=&quot;token selector&quot;&gt;article small:nth-child(3)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token property&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; #007acc&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;几点注意：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;直接复制上面的 CSS 然后黏贴不会起效，因为样式也被黏贴到 &lt;code class=&quot;language-text&quot;&gt;style&lt;/code&gt; 里面去了，这会导致 &lt;code class=&quot;language-text&quot;&gt;style&lt;/code&gt; 里的内容不是合法的 CSS，无法应用样式&lt;/li&gt;
&lt;li&gt;CSS 需要写在一行里面，回车会导致插入 &lt;code class=&quot;language-text&quot;&gt;&amp;lt;br /&amp;gt;&lt;/code&gt;，同样会导致 CSS 语法错误，无法应用样式&lt;/li&gt;
&lt;/ol&gt;</content:encoded></item><item><title><![CDATA[css backdrop filter]]></title><link>https://laysent.github.io/til/2019/05#2019-05-04</link><guid isPermaLink="false">https://laysent.github.io/til/2019/05#2019-05-04</guid><pubDate>Sat, 04 May 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;传统的 CSS filter，可以对当前的元素应用指定的滤镜。以模糊（blur）滤镜为例，常常会被拿来实现毛玻璃的效果。然而，因为滤镜只能应用于元素自身，所以毛玻璃的效果也是局限性很大的。一个常见的做法是，背景图片在当前元素中用 background-image 的方式再赋值一次，然后通过定位对齐，再加上 blur 的效果。这样看上去，中间一块的图片就好像有了模糊的效果。&lt;/p&gt;
&lt;p&gt;一个例子：&lt;/p&gt;
&lt;style&gt;
.container {
  width: 620px;
  height: 414px;
  background-image: url(&quot;../../baseline-jpeg-demo.jpeg&quot;);
  background-size: 620px 414px;
  position: relative;
  margin: 0 auto;
}
.filter {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 310px;
  height: 207px;
}
@supports (-webkit-backdrop-filter: blur(10px)) or (-webkit-backdrop-filter: sepia() hue-rotate(120deg)) {
  span.not-supported {
    display: none;
  }
}
&lt;/style&gt;
&lt;p&gt;
  &lt;div class=&quot;filter-container&quot;&gt;
    &lt;div class=&quot;container&quot;&gt;
      &lt;div class=&quot;filter&quot;&gt;&lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/p&gt;
&lt;style&gt;
.filter-container .filter {
  background-image: url(&quot;../../baseline-jpeg-demo.jpeg&quot;);
  background-size: 620px 414px;
  background-position: -155px -103.5px;
  filter: sepia() hue-rotate(120deg);
}
.filter-container .filter:hover {
  filter: blur(10px);
}
&lt;/style&gt;
&lt;p&gt;HTML 结构是：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;html&quot;&gt;&lt;pre class=&quot;language-html&quot;&gt;&lt;code class=&quot;language-html&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;container&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;filter&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;CSS 是：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;css&quot;&gt;&lt;pre class=&quot;language-css&quot;&gt;&lt;code class=&quot;language-css&quot;&gt;&lt;span class=&quot;token selector&quot;&gt;.container&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;width&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 620px&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;height&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 414px&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;background-image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token url&quot;&gt;url(&quot;../../baseline-jpeg-demo.jpeg&quot;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;background-size&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 620px 414px&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;position&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; relative&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token selector&quot;&gt;.filter&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;position&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; absolute&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;top&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 50%&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;left&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 50%&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;transform&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;translate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;-50%&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; -50%&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;width&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 310px&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;height&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 207px&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token property&quot;&gt;background-image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token url&quot;&gt;url(&quot;../../baseline-jpeg-demo.jpeg&quot;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;background-size&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 620px 414px&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;background-position&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; -155px -103.5px&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;filter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;sepia&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;hue-rotate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;120deg&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token selector&quot;&gt;.filter:hover&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;filter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;blur&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;10px&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;然而，显然这样的局限性是很大的。css backdrop filter 就是为了打破这种局限性。有了 css backdrop filter，当前元素的滤镜会加到当前元素下面的所有元素上，而不仅仅是自身的元素。&lt;/p&gt;
&lt;p&gt;上面例子的改写&lt;span class=&quot;not-supported&quot;&gt;（注意：当前浏览器不支持 backdrop-filter 功能）&lt;/span&gt;：&lt;/p&gt;
&lt;p&gt;
  &lt;div class=&quot;backdrop-filter-container&quot;&gt;
    &lt;div class=&quot;container&quot;&gt;
      &lt;div class=&quot;filter&quot;&gt;&lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/p&gt;
&lt;style&gt;
.backdrop-filter-container .filter {
  -webkit-backdrop-filter: sepia() hue-rotate(120deg);
}
.backdrop-filter-container .filter:hover {
  -webkit-backdrop-filter: blur(10px);
}
&lt;/style&gt;
&lt;p&gt;HTML 保持不变，CSS 改动为：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;css&quot;&gt;&lt;pre class=&quot;language-css&quot;&gt;&lt;code class=&quot;language-css&quot;&gt;&lt;span class=&quot;token selector&quot;&gt;.filter&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;-webkit-backdrop-filter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;sepia&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;hue-rotate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;120deg&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token selector&quot;&gt;.filter:hover&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;-webkit-backdrop-filter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;blur&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;10px&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;可以看到，需要加 filter 的部分，没有做额外特殊的处理（比如背景图片的配适），就可以直接使用。简洁明了。&lt;/p&gt;
&lt;p&gt;另外，鼠标悬停之后可以看到模糊效果的展示。使用 filter 和使用 backdrop-filter 的展示效果也是略有不同的。主要是，用 filter 这种方案，背后还是有图片的，所以当前景图片模糊之后，边缘部分，后面背景的图片会显示出来，效果有折扣。（如果需要处理，简单的做法是，加大 blur 元素的宽高，然后用 &lt;code class=&quot;language-text&quot;&gt;overflow:hidden&lt;/code&gt; 把整体显示出来的大小限定回原来需要的大小，这样边缘部分相当于被裁剪了）&lt;/p&gt;
&lt;p&gt;当然，css backdrop filter 目前的支持还非常有限。除了 Safari 和 Edge，基本没有浏览器支持。具体可以看 &lt;a href=&quot;https://caniuse.com/#feat=css-backdrop-filter&quot;&gt;Caniuse&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;在 Electron 中，可以通过下面的方法让打开 backdrop-filter 的支持：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;BrowserWindow&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// ...&lt;/span&gt;
  webPreferences&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    enableBlinkFeatures&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;CSSBackdropFilter&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// ...&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Chrome 对 backdrop filter 的支持进展可以看这个 &lt;a href=&quot;https://bugs.chromium.org/p/chromium/issues/detail?id=520585&quot;&gt;Issue&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[restore source map]]></title><link>https://laysent.github.io/til/2019/05#2019-05-03</link><guid isPermaLink="false">https://laysent.github.io/til/2019/05#2019-05-03</guid><pubDate>Fri, 03 May 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;如果拿到了一份带有 source map 的 JavaScript 代码，那么理论上就可以通过这份 source map 去尽可能的还原出原始的文件内容。&lt;/p&gt;
&lt;p&gt;首先，source map 本质上是一个 JSON 文件。在其中，&lt;code class=&quot;language-text&quot;&gt;sourceContent&lt;/code&gt; 数组就记录了所有源文件的纯文本内容，而这些文件的文件路径及文件名则存放在了 &lt;code class=&quot;language-text&quot;&gt;sources&lt;/code&gt; 数组中。两者相互对应，理论上来说参照这两者的数据，就可以将源文件还原到原始的目录下。&lt;/p&gt;
&lt;p&gt;然而，Webpack 的打包结果，文件的路径名称都带上了 &lt;code class=&quot;language-text&quot;&gt;webpack:///&lt;/code&gt; 的前缀。在实际处理的过程中，可以直接使用已有的库，比如 &lt;a href=&quot;https://github.com/alexkuz/restore-source-tree&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;restore-source-tree&lt;/code&gt;&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;这个库因为已经比较老了，对 Webpack 3/4 等新版本的支持存在问题。在原库合并 PR 之前，可以先使用改进过的版本 &lt;a href=&quot;https://github.com/laysent/restore-source-tree&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;restore-source-tree&lt;/code&gt;&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;这个修改过的版本，除了修复对新版 Webpack 编译结果的支持外，也加入了 glob 的支持，可以更方便的进行批量 source map 还原。&lt;/p&gt;
&lt;p&gt;参考代码如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;restore-source-tree -o output_folder path/to/source-maps/*.map&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;最终生成的文件会存放在 output_folder 下。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[webpack dynmaic import]]></title><link>https://laysent.github.io/til/2019/05#2019-05-02</link><guid isPermaLink="false">https://laysent.github.io/til/2019/05#2019-05-02</guid><pubDate>Thu, 02 May 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;使用 &lt;code class=&quot;language-text&quot;&gt;import&lt;/code&gt; 函数引入的代码，在 Webpack 中会被编译到一个异步模块中。&lt;code class=&quot;language-text&quot;&gt;import&lt;/code&gt; 函数返回一个 Promise，会在异步模块
加载完毕后 resolve。&lt;/p&gt;
&lt;p&gt;Webpack 允许在调用 &lt;code class=&quot;language-text&quot;&gt;import&lt;/code&gt; 的时候加入注释来对异步加载进行配置。最常见的是指定新文件的 chunk name：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;module-path-here&apos;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;/* webpackChunkName: &quot;name&quot; */&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如果在 Webpack 的配置中指定了输出的文件名格式，比如 &lt;code class=&quot;language-text&quot;&gt;[name].js&lt;/code&gt;，那么最终输出的结果的文件名就会是 &lt;code class=&quot;language-text&quot;&gt;name.js&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;当然，&lt;code class=&quot;language-text&quot;&gt;import&lt;/code&gt; 输入的参数字符串可以不是一个固定值。比如：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;module-parent-path&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; moduleName&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;在这种情况下，Webpack 会尝试将 module-parent-path 下所有的文件都各自打包成一个异步模块。在这种情况下，显然 webpackChunkName 没法直接写死一个字符串了。Webpack 提供了 &lt;code class=&quot;language-text&quot;&gt;index&lt;/code&gt; 和 &lt;code class=&quot;language-text&quot;&gt;request&lt;/code&gt; 两个参数，可以用于动态生成的这些异步加载模块的命名。比如：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;token string&quot;&gt;&apos;module-parent-path&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; moduleName
  &lt;span class=&quot;token comment&quot;&gt;/* webpackChunkName: &quot;name-[index]-[request]&quot; */&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;其中，&lt;code class=&quot;language-text&quot;&gt;index&lt;/code&gt; 表示当前引用的文件的序号，&lt;code class=&quot;language-text&quot;&gt;request&lt;/code&gt; 则表示当前引用的模块中动态的部分。举例俩说，上面这里如果 &lt;code class=&quot;language-text&quot;&gt;moduleName&lt;/code&gt; 是 &lt;code class=&quot;language-text&quot;&gt;example&lt;/code&gt;，且配置生成的文件名是 &lt;code class=&quot;language-text&quot;&gt;[name].js&lt;/code&gt;，那么最终这个模块的文件名就是 &lt;code class=&quot;language-text&quot;&gt;name-0-example.js&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;当然，一次性将 module-parent-path 下所有的文件都打包成独立的异步模块可能会太多了，Webpack 提供了一些裁剪的方案：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;webpackInclude&lt;/code&gt;，允许配置一个正则表达式，匹配的部分才打包成异步模块，忽略其他的&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;webpackExclude&lt;/code&gt;，允许配置一个正则表达式，匹配的部分会被忽略，打包其他剩下的模块&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;webpackMode&lt;/code&gt;，默认的模式是 &lt;code class=&quot;language-text&quot;&gt;lazy&lt;/code&gt;，每一个文件都会打包成一个异步模块；&lt;code class=&quot;language-text&quot;&gt;lazy-once&lt;/code&gt; 则会要求 Webpack 将所有的文件打包到一个模块中；&lt;code class=&quot;language-text&quot;&gt;eager&lt;/code&gt; 会把模块打包到当前的 chunk 中，但是不执行，等到真正执行了 &lt;code class=&quot;language-text&quot;&gt;import&lt;/code&gt; 命令之后，才执行里面的代码（省去了网络请求），依然返回的是 promise；&lt;code class=&quot;language-text&quot;&gt;weak&lt;/code&gt; 不会产生网络请求，默认模块会由其他途径加载完成，如果其他途径没有事先加载过，那么此处调用就会造成 promise 的 reject。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;如果有多个配置，可以叠加写在一起。一个例子：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;token string&quot;&gt;&apos;module-parent-path&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; moduleName
  &lt;span class=&quot;token comment&quot;&gt;/* webpackChunkName: &quot;name-[index]-[request]&quot; */&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;/* webpackInclude: /include\.js$/ */&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;/* webpackExclude: /exclude\.js$/ */&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;/* webpackMode: &quot;lazy&quot; */&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;除了上述之外，Webpack 还支持一些模块加载相关的配置，比如：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;module-path-here&apos;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;/* webpackPrefetch: true */&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;可以指定当前的异步加载模块需要 prefetch 的支持。运行时，Webpack 会向 &lt;code class=&quot;language-text&quot;&gt;head&lt;/code&gt; 中插入一个 &lt;code class=&quot;language-text&quot;&gt;&amp;lt;link rel=prefetch /&amp;gt;&lt;/code&gt;。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;module-path-here&apos;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;/* webpackPreload: true */&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;可以指定当前的异步加载模块需要 preload 的支持。运行时，Webpack 会向 &lt;code class=&quot;language-text&quot;&gt;head&lt;/code&gt; 中插入一个 &lt;code class=&quot;language-text&quot;&gt;&amp;lt;link rel=preload /&amp;gt;&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;一个例子：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;/* webpackPreload: true */&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;/* webpackChunkName: &quot;name&quot; */&lt;/span&gt;
  &lt;span class=&quot;token string&quot;&gt;&apos;module-path-here&apos;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;注意到，这里配置注释写在前面还是写在后面都是不影响的。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://wanago.io/2018/08/20/webpack-4-course-part-eight-dynamic-imports-with-prefetch-and-preload/&quot;&gt;参考&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[use case of switch]]></title><link>https://laysent.github.io/til/2019/05#2019-05-01</link><guid isPermaLink="false">https://laysent.github.io/til/2019/05#2019-05-01</guid><pubDate>Wed, 01 May 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;在《JavaScript: The Good Parts》里，作者并不赞成 &lt;code class=&quot;language-text&quot;&gt;switch&lt;/code&gt; 语句的使用（主要是因为 fall-through 的情况很容易造成错误）。然而在实际的代码里，还是有不少地方可以看到 switch 的使用。目的各不相同，有不少可以借鉴的地方。&lt;/p&gt;
&lt;section&gt;&lt;h2&gt;默认值设置&lt;/h2&gt;&lt;p&gt;React 的 &lt;a href=&quot;https://github.com/facebook/react/blob/master/packages/scheduler/src/Scheduler.js#L220&quot;&gt;Scheduler&lt;/a&gt; 中，有这样一段代码：&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;switch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;priorityLevel&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; ImmediatePriority&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; UserBlockingPriority&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; NormalPriority&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; LowPriority&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; IdlePriority&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;default&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    priorityLevel &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; NormalPriority&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;不失为设置默认值的一种写法，看上去比使用 if 来得更明确一些：&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  priorityLevel &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; ImmediatePriority &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt;
  priorityLevel &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; UserBlockingPriority &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt;
  priorityLevel &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; NormalPriority &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt;
  priorityLevel &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; LowPriority &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt;
  priorityLevel &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; IdlePriority
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  priorityLevel &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; NormalPriority&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/section&gt;
&lt;section&gt;&lt;h2&gt;防止代码篡改的判定&lt;/h2&gt;&lt;p&gt;上面的需求，也很容易写成下面这种数组的方案：&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; allowedValues &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
  ImmediatePriority&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  UserBlockingPriority&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  NormalPriority&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  LowPriority&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  IdlePriority&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;isNot&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token parameter&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token parameter&quot;&gt;comparedTo&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; value &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; comparedTo&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;allowedValues&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;every&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isNot&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;priorityLevel&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  priorityLevel &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; NormalPriority&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;然而，这样的代码方式，可能存在被入侵的危险。不论是上面例子中的 &lt;code class=&quot;language-text&quot;&gt;every&lt;/code&gt; 函数，还是用 &lt;code class=&quot;language-text&quot;&gt;Array.prototype&lt;/code&gt; 上的任意函数，都有被篡改的可能性。如果其他地方的代码修改了 &lt;code class=&quot;language-text&quot;&gt;Array.prototype.every&lt;/code&gt; 的行为，让这里的返回值发生了变化，那么代码最终就会产生意料之外的行为。&lt;/p&gt;&lt;p&gt;在 Scheduler 中当然不需要考虑这个问题，但是在其他的应用场景下，这可能是不得不考虑的问题。举例来说，如果一个 Web 应用允许第三方脚本的运行，同时自身有对数据进行白名单检查的需求，那么就只能使用 switch 硬编码所有的情况，而不能使用数组或者对象，否则第三方的脚本有可能对最终的行为做篡改。&lt;/p&gt;&lt;p&gt;Microsoft Teams 的代码里，就有类似的应用场景（见 extracted/lib/renderer/preload_sandbox.js）：&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;isChannelAllowed&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;channel&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// ...&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; isAllowed &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// IMPORTANT - the allowList must be a hardcorded switch statement.&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// Array and object methods can be overridden and forced to return true.&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;switch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;channel&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; xxx&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// ...&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; zzz&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      isAllowed &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;default&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      isAllowed &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/section&gt;</content:encoded></item></channel></rss>
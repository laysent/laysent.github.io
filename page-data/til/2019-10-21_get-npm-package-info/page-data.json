{"componentChunkName":"component---src-templates-til-js","path":"/til/2019-10-21_get-npm-package-info","webpackCompilationHash":"d0c1c456129354e33ddb","result":{"data":{"markdownRemark":{"id":"c53d17b5-4c70-5421-bcc4-1ee6a0e8cffc","html":"<p>要获取一个 NPM 包所有的版本信息，可以使用 <code class=\"language-text\">npm view</code> 这个命令。比如，检查 React 这个包的所有版本，并输出成 JSON 格式：</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> view react versions --json</code></pre></div>\n<p>当然，以上只是 CLI 的操作方式，如果希望可以通过编程的方式去了解一个 NPM 包的相关信息，需要换一个方式。注意到 NPM 本身也是一个 <a href=\"https://www.npmjs.com/package/npm\">NPM 包</a>，对应的源码可以在 <a href=\"https://github.com/npm/cli\">GitHub</a> 上找到。其中，<code class=\"language-text\">npm view</code> 这个命令，对应的代码是 <a href=\"https://github.com/npm/cli/blob/c1522be2406a0ea4f14c85753edd42ddd8d7e180/lib/view.js\">lib/view.js</a>。</p>\n<p>通过观察这个文件，不难发现，NPM 底层依赖的其实是 <a href=\"https://www.npmjs.com/package/libnpm\">libnpm</a> 这个库。其中，获取包信息的部分，使用的是 <code class=\"language-text\">libnpm/packument</code> 这个部分。而根据文档，这里 <code class=\"language-text\">libnpm/packument</code> 本质上就是将 <a href=\"https://www.npmjs.com/package/pacote\">pacote</a> 中的 <code class=\"language-text\">packument</code> 接口开放了出来。</p>\n<p>实际的使用方法如下：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> packument <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'libnpm/packument'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">getVersions</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token keyword\">package</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> versions <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">packument</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">package</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// to use custom registry</span>\n    registry<span class=\"token punctuation\">:</span> <span class=\"token string\">'https://registry.npm.taobao.org'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// get all meta data</span>\n    fullMetadata<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// prefer to get latest online data</span>\n    <span class=\"token string\">'prefer-online'</span><span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> versions<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>其中，<code class=\"language-text\">packument</code> 这个 API 的返回数据格式，可以参考 <code class=\"language-text\">@types/pacote</code> 中的相关<a href=\"https://github.com/DefinitelyTyped/DefinitelyTyped/blob/25fe77861d42ff01903fe2e2d1014b3ed354bfde/types/pacote/index.d.ts#L98\">定义</a>。</p>\n<p>需要额外注意的一点是：npm 和一些 registry 服务使用的数据格式可能略有区别。举例来说，npm 的返回数据里，每个版本的 <code class=\"language-text\">dist</code> 中可能包含 <code class=\"language-text\">unpackedSize</code> 数据（optional），表示该版本文件实际的大小；而 <a href=\"https://github.com/npm/cli\">cnpm</a> 返回的数据中，<code class=\"language-text\">dist</code> 内包含的是 <code class=\"language-text\">size</code> 数据（<a href=\"https://github.com/cnpm/cnpmjs.org/blob/26d7147562a1ae21db8bfec26983daf311353d96/models/module.js#L74\">源代码</a>），表示该版本的压缩文件 tar 的大小。</p>","frontmatter":{"title":"Get Npm Package Info","category":"JavaScript","date":"2019-10-21"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"time":"2019-10-21","title":"Get Npm Package Info","previous":{"time":"2019-10-20","title":"back to previous folder"},"next":null}}}
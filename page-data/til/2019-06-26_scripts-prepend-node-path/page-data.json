{"componentChunkName":"component---src-templates-til-js","path":"/til/2019-06-26_scripts-prepend-node-path","webpackCompilationHash":"d0c1c456129354e33ddb","result":{"data":{"markdownRemark":{"id":"1362bb80-5413-560a-87cc-b09d62f95b50","html":"<p>在使用服务器编译上线包的过程中，可能会使用 nvm 来管理编译使用的 Node.js 版本。此时，运行时 Node.js 的二进制文件和实际服务器本身的 Node.js 文件将会是不同的。</p>\n<p>这样做的好处是可以隔离，保证编译的环境是稳定的。</p>\n<p>但是，当 npm 试图运行 Node.js 的时候，就要格外小心了。默认情况下，npm 会使用 path 中定义的 Node.js 版本。而对于打包服务器来说，这个 path 上的 Node.js 很可能并不是 nvm 管理的那个版本。</p>\n<p>举个例子，如果 <code class=\"language-text\">package.json</code> 中定义了 <code class=\"language-text\">postinstall</code> 的脚本，如下；</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"postinstall\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"some-cli\"</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>那么，在 <code class=\"language-text\">yarn install</code> 之后，执行这个 <code class=\"language-text\">postinstall</code> 的过程中，<code class=\"language-text\">some-cli</code> 需要 Node.js 来执行，而 npm 使用的 Node.js 是 path 上的默认版本，和 nvm 管理的并不是同一个。命令行会有如下的报错：</p>\n<blockquote>\n<p>npm WARN lifecycle The node binary used for scripts is xxx but npm is using xxx itself. Use the <code class=\"language-text\">--scripts-prepend-node-path</code> option to include the path for the node binary npm was executed with.</p>\n</blockquote>\n<p>正如报错指出的，为了修正这个问题，需要用到 <code class=\"language-text\">scripts-prepend-node-path</code>。这样，当 npm 需要 Node.js 来执行代码的时候，会选择和自身匹配的 Node.js 版本，而不是默认 path 上的版本。（<a href=\"https://docs.npmjs.com/cli/run-script.html\">文档</a>）</p>\n<p>除了每次运行时加上命令行参数之外，一个比较简单的方法是使用 npm config 设置相对应的参数：</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> config <span class=\"token keyword\">set</span> scripts-prepend-node-path<span class=\"token operator\">=</span>true</code></pre></div>\n<p>或是在 .npmrc 中加上</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">scripts-prepend-node-path true</code></pre></div>\n<p>设置完后，就不会再有报错了。</p>","frontmatter":{"title":"scripts-prepend-node-path","category":"Node.js","date":"2019-06-26"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"time":"2019-06-26","title":"scripts-prepend-node-path","previous":{"time":"2019-06-25","title":"Screenshot in Chrome"},"next":{"time":"2019-06-27","title":"Submit Button outside Form"}}}}
{"componentChunkName":"component---src-templates-til-js","path":"/til/2019-06-03_global-provider-for-storybook","webpackCompilationHash":"d0c1c456129354e33ddb","result":{"data":{"markdownRemark":{"id":"53185fcd-7279-570b-8a64-384a2f60382e","html":"<p>一个项目工程里的组件，很可能需要依赖于某些项目顶层定义的 <code class=\"language-text\">Provider</code> 才能正确使用。比如，mobx 的项目可能会在顶层通过 <code class=\"language-text\">mobx-react</code> 中的 <code class=\"language-text\">Provider</code> 提供 <code class=\"language-text\">store</code> 参数。</p>\n<p>如果需要在每一个 story 中都写：</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Provider</span></span> <span class=\"token spread\"><span class=\"token punctuation\">{</span><span class=\"token punctuation\">...</span><span class=\"token attr-value\">info</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n  </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ComponentForThisStory</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Provider</span></span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>显然太啰嗦了。</p>\n<p>storybook 提供了全局定义 decorator 的方法，可以以此来注册一些全局都用得到的改动。举例如下：</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> configure<span class=\"token punctuation\">,</span> addDecorator <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@storybook/react'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Provider <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'mobx-react'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">withProvider</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">story</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Provider</span></span> <span class=\"token spread\"><span class=\"token punctuation\">{</span><span class=\"token punctuation\">...</span><span class=\"token attr-value\">info</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">{</span><span class=\"token function\">story</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Provider</span></span><span class=\"token punctuation\">></span></span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">loadStories</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n  <span class=\"token function\">addDecorator</span><span class=\"token punctuation\">(</span>withProvider<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">configure</span><span class=\"token punctuation\">(</span>loadStories<span class=\"token punctuation\">,</span> module<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>这样，在 story 中，只需要简单的提供组件就可以了，<code class=\"language-text\">decorator</code> 会自动为组件加上合适的外层 <code class=\"language-text\">Provider</code>。</p>\n<p><a href=\"https://alligator.io/react/storybook-with-redux/\">参考文档</a></p>","frontmatter":{"title":"global Provider for storybook","category":"JavaScript","date":"2019-06-03"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"time":"2019-06-03","title":"global Provider for storybook","previous":{"time":"2019-06-02","title":"glob"},"next":{"time":"2019-06-04","title":"TextDecoder"}}}}
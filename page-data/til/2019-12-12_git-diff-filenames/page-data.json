{"componentChunkName":"component---src-templates-til-js","path":"/til/2019-12-12_git-diff-filenames","result":{"data":{"markdownRemark":{"id":"cb888251-ad71-502a-a55d-4f215d5bba15","html":"<p>在 <code class=\"language-text\">~/.gitconfig</code> 中进行如下配置（或者使用命令：<code class=\"language-text\">git config --global diff.noprefix true</code>）：</p>\n<div class=\"gatsby-highlight\" data-language=\"plain\"><pre class=\"language-plain\"><code class=\"language-plain\">[diff]\n    noprefix = true</code></pre></div>\n<p>之后，Git 输出的 diff 内容，比较的文件名前将不再包含 <code class=\"language-text\">a/</code> 和 <code class=\"language-text\">b/</code> 这样的前缀。</p>\n<p>举例来说，在配置前，使用 <code class=\"language-text\">git diff</code> 命令，看到的输出可能如下：</p>\n<div class=\"gatsby-highlight\" data-language=\"diff\"><pre class=\"language-diff\"><code class=\"language-diff\">diff --git a/package.json b/package.json\nindex ac6f0b2..f937b7b 100644\n<span class=\"token coord\">--- a/package.json</span>\n<span class=\"token coord\">+++ b/package.json</span>\n<span class=\"token coord\">@@ -13,7 +13,7 @@</span>\n<span class=\"token unchanged\">   \"bugs\": {\n     \"url\": \"https://github.com/laysent/some-codemod/issues\"\n   },\n</span><span class=\"token deleted-sign deleted\">-  \"version\": \"0.1.2\",\n</span><span class=\"token inserted-sign inserted\">+  \"version\": \"0.2.0\",\n</span><span class=\"token unchanged\">   \"license\": \"MIT\",\n   \"scripts\": {\n     \"test\": \"jest\"</span></code></pre></div>\n<p>而进行了配置之后，输出如下：</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"diff\"><pre class=\"language-diff\"><code class=\"language-diff\"><span class=\"gatsby-highlight-code-line\">diff --git package.json package.json</span>index ac6f0b2..f937b7b 100644\n<span class=\"token coord\">--- package.json</span>\n<span class=\"token coord\">+++ package.json</span>\n<span class=\"token coord\">@@ -13,7 +13,7 @@</span>\n<span class=\"token unchanged\">   \"bugs\": {\n     \"url\": \"https://github.com/laysent/some-codemod/issues\"\n   },\n</span><span class=\"token deleted-sign deleted\">-  \"version\": \"0.1.2\",\n</span><span class=\"token inserted-sign inserted\">+  \"version\": \"0.2.0\",\n</span><span class=\"token unchanged\">   \"license\": \"MIT\",\n   \"scripts\": {\n     \"test\": \"jest\"</span></code></pre></div>\n<p>此时，无论是直接在终端复制这个文件名，还是直接点击文件名跳转打开，都比较容易。</p>\n<p>（来源：<a href=\"https://twitter.com/brandur/status/1182066723337293828\">tweet</a> from <a href=\"https://twitter.com/brandur\">@brandur</a>）</p>\n<p>需要注意的一点是，如果配置了 <code class=\"language-text\">noprefix</code>，那么在进行 <code class=\"language-text\">git diff</code> 创建 Patch 文件并通过 <code class=\"language-text\">git apply</code> 提交修改的时候，可能会遇到 Git 的报错：</p>\n<blockquote>\n<p>error: git diff header lacks filename information when removing 1 leading pathname component (line 5)</p>\n</blockquote>\n<p>原因就是生成的 Patch 文件，目录名称没有了前缀。针对这种情况，可以改用下面的方案进行 <code class=\"language-text\">git apply</code>：</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">git</span> apply -p0 change.patch</code></pre></div>\n<p>这里，<code class=\"language-text\">-p0</code> 表示 Git 在进行补丁操作的时候，需要先删除<strong>零</strong>层前缀字符，然后再读取真实的目录地址。这里，Git 会根据 <code class=\"language-text\">/</code> 字符将目录地址拆分开来，然后删除必要的层数，将剩下的部分作为文件地址。默认值是 <code class=\"language-text\">1</code>，也就是会将 <code class=\"language-text\">a/package.json</code> 当作 <code class=\"language-text\">package.json</code> 目录进行处理。如果改成 <code class=\"language-text\">-p2</code>，那么 <code class=\"language-text\">a/dir/file</code> 会被当成 <code class=\"language-text\">file</code> 目录进行处理。</p>\n<p>相关的说明可以参考 <a href=\"https://git-scm.com/docs/git-apply#Documentation/git-apply.txt--pltngt\">Git 文档</a>。</p>","frontmatter":{"title":"Git Diff Filenames","category":"Git","date":"2019-12-12"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"time":"2019-12-12","title":"Git Diff Filenames","previous":{"time":"2019-12-11","title":"Apply Git Patch"},"next":{"time":"2019-12-15","title":"React Capture Event"}}}}
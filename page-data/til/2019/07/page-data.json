{"componentChunkName":"component---src-templates-til-per-month-js","path":"/til/2019/07","webpackCompilationHash":"687e338135c47159cd63","result":{"data":{"site":{"siteMetadata":{"title":"LaySent's Site"}},"allMarkdownRemark":{"edges":[{"node":{"id":"95e9a909-b17d-5d27-a0f1-f9ae9e02b984","html":"<p>在进行网络请求的时候，有可能会遇上服务器指定链接跳转的情况。此时，无论是 301（永久转移）还是 302（暂时转移），在请求页面的时候都需要根据服务器的指示，去访问下一个链接。当然，这里下一个链接依然有可能是跳转链接，需要继续执行跳转操作。</p>\n<p>一段可用的 Node.js 代码如下：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> http <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'http'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> https <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'https'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">link</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">get</span> <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> link<span class=\"token punctuation\">.</span><span class=\"token function\">startsWith</span><span class=\"token punctuation\">(</span><span class=\"token string\">'https'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> https <span class=\"token punctuation\">:</span> http<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span>link<span class=\"token punctuation\">,</span> <span class=\"token parameter\">response</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">.</span>statusCode <span class=\"token operator\">>=</span> <span class=\"token number\">300</span> <span class=\"token operator\">&amp;&amp;</span> response<span class=\"token punctuation\">.</span>statusCode <span class=\"token operator\">&lt;</span> <span class=\"token number\">400</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> location <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> response<span class=\"token punctuation\">.</span>headers<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>location<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>resolve<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">.</span>headers<span class=\"token punctuation\">[</span><span class=\"token string\">'set-cookie'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>这里，Node.js 处理 HTTP 和 HTTPs 请求使用的模块是不相同的，因而需要根据链接地址的 protocol 进行按需索取。同时，如果是 3xx 的 HTTP 结果，则需要进行链接跳转。可以直接读取 headers 中的 <code class=\"language-text\">location</code> 数据，找到下一步需要跳转到的位置。</p>","frontmatter":{"date":"2019-07-31","title":"Follow Redirection","category":"Node.js"}}},{"node":{"id":"bce782dd-1013-548b-a42e-8b7020a9a3c2","html":"<p>在 Docker 中使用 SSH 的功能时，发现 SSH 报错：</p>\n<div class=\"gatsby-highlight\" data-language=\"plain\"><pre class=\"language-plain\"><code class=\"language-plain\">Bad owner or permissions on ~/.ssh/config</code></pre></div>\n<p>通过 <code class=\"language-text\">ls -l</code> 查看 <code class=\"language-text\">~/.ssh/config</code>，得到如下结果：</p>\n<div class=\"gatsby-highlight\" data-language=\"plain\"><pre class=\"language-plain\"><code class=\"language-plain\">-rw------- 1 1000  1000   557 Jul 29 20:32 config</code></pre></div>\n<p>注意到给出的 User 和 Group 的值不是一个名字（如 <code class=\"language-text\">root</code>），而是一个数字。这说明，文件所属的 User / Group 无法找到。</p>\n<p>可以通过如下的命令查看当前 <code class=\"language-text\">root</code> 用户的 ID：</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">id</span> -u root <span class=\"token comment\"># output => 0</span></code></pre></div>\n<p>可以看到和 <code class=\"language-text\">ls</code> 列出的 ID 是不匹配的。这说明，导致 SSH 无法正常工作的主要原因，是 <code class=\"language-text\">~/.ssh/config</code> 文件权限的设置有问题。可以通过如下的命令将权限分配给当前的 <code class=\"language-text\">root</code> 用户：</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">chown</span> -R root:root /root/.ssh</code></pre></div>\n<p>再次运行 SSH 就可以正常工作了。</p>","frontmatter":{"date":"2019-07-30","title":"Bad owner or permissions","category":"Bash"}}},{"node":{"id":"6c27cfd3-d03c-5034-a29f-9ac99e7f51bf","html":"<p>当 Ant Design 和 Jest 一起使用的时候，在某些情况下（开启 coverage 的时候）会导致单元测试运行失败。一个可能造成问题的 Ant Design 代码如下：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Input <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'antd'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> TextArea <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> Input<span class=\"token punctuation\">;</span></code></pre></div>\n<p>Jest 会报错：</p>\n<div class=\"gatsby-highlight\" data-language=\"plain\"><pre class=\"language-plain\"><code class=\"language-plain\">ReferenceError: Input is not defined\n\n  1 | import { Input } from &#39;ant-design&#39;;\n  2 |\n&gt; 3 | const { TextArea } = Input;</code></pre></div>\n<p>报错的直接原因，是使用了 Ant Design 推荐的 <code class=\"language-text\">babel-plugin-import</code> 和 Jest 计算 coverage 使用的 <code class=\"language-text\">babel-plugin-istanbul</code> 造成的。在<a href=\"https://github.com/ant-design/babel-plugin-import/issues/172\">这里</a>、<a href=\"https://github.com/ant-design/babel-plugin-import/issues/189#issuecomment-445139343\">这里</a>等 GitHub Issue 中都有相应的讨论。</p>\n<p>要修复这个问题，只需要在 Jest 或者单元测试环境中，不使用 <code class=\"language-text\">babel-plugin-import</code> 这个转换插件就可以了。参考代码如下，在 <code class=\"language-text\">.babelrc</code> 中：</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"env\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"development\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"plugins\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">[</span>\n          <span class=\"token string\">\"import\"</span><span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">\"libraryName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"antd\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"style\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">]</span>\n      <span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"production\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// same as above</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"plugins\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token comment\">// rest of plugins...</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>如此一来，只有在 <code class=\"language-text\">NODE_ENV</code> 为 <code class=\"language-text\">production</code> 或 <code class=\"language-text\">development</code> 的情况下，Babel 才会启用 <code class=\"language-text\">babel-plugin-import</code> 这个转换插件。对于 Jest 来说，因为默认设置了环境变量 <code class=\"language-text\">NODE_ENV</code> 为 <code class=\"language-text\">test</code>，所以 Plugin 不会起效。</p>\n<p>这样造成的问题是 Jest 的运行速度会有所降低。</p>","frontmatter":{"date":"2019-07-29","title":"Jest with Ant Design","category":"JavaScript"}}},{"node":{"id":"111b032a-a1fc-57f1-8eed-7a908e9ee7e3","html":"<p>如果手上有多台设备在管理，SSH 的时候需要记住各个设备的 IP 地址、输入，总是很麻烦的。SSH 提供了配置文件的功能，可以为不同的 IP 设置别名，同时配置登陆需要用到的用户名和 RSA 私钥等。</p>\n<section><h2>配置方法</h2><p>修改 <code class=\"language-text\">~/.ssh/config</code> 文件，增加每个设备对应的配置数据。举例如下：</p><div class=\"gatsby-highlight\" data-language=\"plain\"><pre class=\"language-plain\"><code class=\"language-plain\">Host pi\n    Hostname 192.168.xx.xx\n    User pi\n    IdentityFile ~/.ssh/id_pi_rsa</code></pre></div><p>这样就配置好了一个 Raspberry Pi 的别名。接下来，可以直接使用如下的命令来访问设备：</p><div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">ssh</span> pi</code></pre></div><p>除了 SSH 之外，SCP 也可以使用同样的配置。比如：</p><div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">scp</span> -r /local/path pi:/remote/path</code></pre></div></section>","frontmatter":{"date":"2019-07-28","title":"SSH Host Config","category":"Bash"}}},{"node":{"id":"4aa86de8-f5ef-545f-82b2-a0200ca867de","html":"<p>默认情况下，Webapck 会用 Chunk ID 为 <code class=\"language-text\">import()</code> 产生的独立文件命名，最终的结果就是类似于 <code class=\"language-text\">0.bundle.js</code> 这样的文件。这样的文件并不方便理解和管理，所以一般会使用 <code class=\"language-text\">webpackChunkName</code> 这个注释来让 Webapck 使用更加有意义的命名。例子：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span><span class=\"token punctuation\">(</span><span class=\"token comment\">/* webpackChunkName: \"module-name\" */</span> <span class=\"token string\">'path-to-bundle'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>最终产生的文件为 <code class=\"language-text\">module-name.bundle.js</code>（这里假设在 Webpack 中配置了 <code class=\"language-text\">output.filename</code> 为 <code class=\"language-text\">[name].bundle.js</code>）。</p>\n<p>然而，每次要手写这样的注释有些麻烦。如果动态加载的模块本身存放位置有规律可循（比如是在 pages 目录下，每个目录有一个入口文件），那么也可以考虑使用 Babel 插件的方式，自动为每个 <code class=\"language-text\">import()</code> 增加合适的 bundle name。</p>\n<p>参考代码如下：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">addComments</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">arg<span class=\"token punctuation\">,</span> name</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// only add leading comment when not found</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>arg<span class=\"token punctuation\">.</span>leadingComments<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n  arg<span class=\"token punctuation\">.</span>leadingComments <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span>\n    type<span class=\"token punctuation\">:</span> <span class=\"token string\">'CommentBlock'</span><span class=\"token punctuation\">,</span>\n    value<span class=\"token punctuation\">:</span> <span class=\"token template-string\"><span class=\"token string\">` webpackChunkName: '</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>name<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">' `</span></span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">getChunkNameFromImportPath</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">importPath</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// find a way to transform from import path to chunk name</span>\n  <span class=\"token comment\">// example: from 'path/to/file' to 'path.to.file' as chunk name</span>\n  <span class=\"token keyword\">return</span> importPath<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\">/\\//g</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\nmodule<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">exports</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">babel</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> types<span class=\"token punctuation\">:</span> t <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> babel<span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    name<span class=\"token punctuation\">:</span> <span class=\"token string\">'add-bundle-name'</span><span class=\"token punctuation\">,</span>\n    visitor<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function-variable function\">CallExpression</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">path</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> node <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> path<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>t<span class=\"token punctuation\">.</span><span class=\"token function\">isImport</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">.</span>callee<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>firstArg<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> node<span class=\"token punctuation\">.</span>arguments<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">const</span> importPath <span class=\"token operator\">=</span> firstArg<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">;</span>\n        <span class=\"token function\">addComments</span><span class=\"token punctuation\">(</span>firstArg<span class=\"token punctuation\">,</span> <span class=\"token function\">getChunkNameFromImportPath</span><span class=\"token punctuation\">(</span>importPath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>","frontmatter":{"date":"2019-07-26","title":"Import Chunkname with Babel Plugin","category":"JavaScript"}}},{"node":{"id":"e021306b-55f0-5457-9892-4bc9c1e12835","html":"<p>在 Docker 开发的过程中，有时会有脚本出错，导致执行结果不及预期的情况。这种错误有时是环境导致的，在非 Docker 环境下无法重现。如果需要通过构建 Docker 添加诸如日志之类的信息来了解具体可能出错的原因，不免有些曲折。可以考虑直接在 Docker 环境下运行 Bash 命令，通过执行脚本中的语句，来查找可能出现问题的原因。</p>\n<p>要在 Docker 环境下执行 Bash 脚本，可以遵循以下的步骤：</p>\n<ol>\n<li>首先，需要知道当前运行 Docker 的容器 ID</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">docker container <span class=\"token function\">ls</span></code></pre></div>\n<p>上述命令会列出所有的容器，找到需要调试的那一个即可。</p>\n<ol start=\"2\">\n<li>在该容器环境内执行 Bash 命令</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">docker <span class=\"token function\">exec</span> -ti xxx /bin/bash</code></pre></div>\n<p>这里，<code class=\"language-text\">xxx</code> 就是第一步找到的 Container ID。上述命令用到了两个参数，<code class=\"language-text\">-t</code> 和 <code class=\"language-text\">-i</code>。<code class=\"language-text\">-t</code> 是 <code class=\"language-text\">--tty</code> 的缩写，用于让 Docker 将用户的终端和 stdin/stdout 关联起来；<code class=\"language-text\">-i</code> 是 <code class=\"language-text\">--interactive</code> 的缩写，用于让 Docker 在执行命令的时候允许用户进行交互式的输入输出。</p>\n<p>如果只是希望执行一个语句并输出结果（比如 <code class=\"language-text\">echo</code> 一个字符串），那么 <code class=\"language-text\">-t</code> 就足够了，不需要 <code class=\"language-text\">-i</code>。但是对于需要在 Docker 环境下输入 Bash 命令并检查执行结果的情况来说，<code class=\"language-text\">-i</code> 就是必须的。</p>\n<p>一个输出 Hello World 的简单例子：</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">docker <span class=\"token function\">exec</span> -t <span class=\"token keyword\">echo</span> <span class=\"token string\">\"hello world\"</span></code></pre></div>\n<p>另外，可以通过如下的命令知道，<code class=\"language-text\">docker exec</code> 运行的默认环境是在 <code class=\"language-text\">/</code> 下：</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">docker <span class=\"token function\">exec</span> -t <span class=\"token function\">pwd</span> <span class=\"token comment\"># output: /</span></code></pre></div>\n<p>如需修改这一默认行为，可以通过 <code class=\"language-text\">-w</code> 参数（或 <code class=\"language-text\">--workdir</code>）来执行：</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">docker <span class=\"token function\">exec</span> -w /root -t xxx <span class=\"token function\">pwd</span> <span class=\"token comment\"># output: /root</span></code></pre></div>","frontmatter":{"date":"2019-07-25","title":"Execute Bash in Docker","category":"Docker"}}},{"node":{"id":"32799a20-826d-5a55-8cdc-d47c46c6d61d","html":"<p>Alpine 是 Docker 中非常流行的镜像，因为它体积小（5 MB 左右），且包管理机制友善。然而即使体积小，一旦网络条件受到限制，使用 Alpine 安装依赖依然十分费劲。这让 Docker 镜像的安装变得非常缓慢且容易失败。</p>\n<p>假设原先的 Dockerfile 如下：</p>\n<div class=\"gatsby-highlight\" data-language=\"dockerfile\"><pre class=\"language-dockerfile\"><code class=\"language-dockerfile\"><span class=\"token keyword\">FROM</span> alpine<span class=\"token punctuation\">:</span>edge\n\n<span class=\"token keyword\">RUN</span> apk update &amp;&amp; \\\n  <span class=\"token comment\"># ...</span></code></pre></div>\n<p>那么可以考虑改用国内的镜像源来加速网络下载过程：</p>\n<div class=\"gatsby-highlight\" data-language=\"dockerfile\"><pre class=\"language-dockerfile\"><code class=\"language-dockerfile\"><span class=\"token keyword\">FROM</span> alpine<span class=\"token punctuation\">:</span>edge\n\n<span class=\"token keyword\">RUN</span> echo <span class=\"token string\">'http://mirrors.aliyun.com/alpine/edge/community/'</span> <span class=\"token punctuation\">></span> \\\n    /etc/apk/repositories &amp;&amp; \\\n  echo <span class=\"token string\">'http://mirrors.aliyun.com/alpine/edge/main/'</span> <span class=\"token punctuation\">></span><span class=\"token punctuation\">></span> \\\n    /etc/apk/repositories &amp;&amp; \\\n  apk update &amp;&amp; \\\n  <span class=\"token comment\"># ...</span></code></pre></div>\n<p>除了上面提到的<a href=\"https://mirrors.aliyun.com/alpine/\">阿里镜像</a>之外，<a href=\"https://mirrors.tuna.tsinghua.edu.cn/alpine/\">清华</a>、<a href=\"https://mirrors.nju.edu.cn/alpine/\">南大</a>、<a href=\"https://mirrors.ustc.edu.cn/alpine/\">中科大</a>等镜像也可以考虑。更多镜像及其对应的网络状态可以在<a href=\"https://mirrors.alpinelinux.org/\">这里</a>找到。</p>\n<p>注意使用的镜像版本必须与 Docker 需要使用的版本保持一致。如上例中，Docker 需要基于 <code class=\"language-text\">alpine:edge</code>，那么在设置镜像的使用，也应该使用 <code class=\"language-text\">edge</code> 的版本（在 URL 中可以找到 <code class=\"language-text\">/alpine/edge/</code>）。</p>","frontmatter":{"date":"2019-07-24","title":"Alpine Mirror","category":"Docker"}}},{"node":{"id":"352b533c-1fcc-5f3a-b42e-91d6ebd88751","html":"<p>以下介绍一些系统上安装 Docker 的步骤。</p>\n<section><h2>Raspberry Pi</h2><ol>\n<li>安装一些前置依赖</li>\n</ol><div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">apt-get</span> <span class=\"token function\">install</span> \\\n  apt-transport-https ca-certificates software-properties-common -y</code></pre></div><ol start=\"2\">\n<li>安装 Docker</li>\n</ol><div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">curl</span> -fsSL get.docker.com -o get-docker.sh <span class=\"token operator\">&amp;&amp;</span> sh get-docker.sh</code></pre></div><p>这里直接使用了 <a href=\"http://get-docker.sh\">get-docker.sh</a> 提供的安装脚本。</p><ol start=\"3\">\n<li>让当前用户可以使用 Docker</li>\n</ol><div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">usermod</span> -aG docker pi</code></pre></div><ol start=\"4\">\n<li>导入 Docker CPG key</li>\n</ol><div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">curl</span> https://download.docker.com/linux/raspbian/gpg</code></pre></div><ol start=\"5\">\n<li>设置 Docker Repo 地址</li>\n</ol><p>在 <code class=\"language-text\">/etc/apt/sources.list</code> 中增加如下行：</p><div class=\"gatsby-highlight\" data-language=\"plain\"><pre class=\"language-plain\"><code class=\"language-plain\">deb https://download.docker.com/linux/raspbian/ stretch stable</code></pre></div><ol start=\"6\">\n<li>更新系统</li>\n</ol><div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">apt-get</span> update\n<span class=\"token function\">sudo</span> <span class=\"token function\">apt-get</span> upgrade</code></pre></div><ol start=\"7\">\n<li>启动 Docker 服务</li>\n</ol><div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">systemctl start docker.service</code></pre></div></section>\n<section><h2>MacOS</h2><p>可以直接使用 Homebrew 进行安装：</p><div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">brew cask <span class=\"token function\">install</span> docker</code></pre></div><p>安装完成后，在 Application 中找到 Docker 并启动，按提示信息一步步走就可以了。</p></section>\n<section><h2>运行</h2><p>完成后，可以试试如下的 Docker 命令，如果可以正常输出内容，安装本身就没有问题了：</p><div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">docker info</code></pre></div></section>\n<section><h2>参考</h2><ul>\n<li><a href=\"https://blog.docker.com/2019/03/happy-pi-day-docker-raspberry-pi/\">https://blog.docker.com/2019/03/happy-pi-day-docker-raspberry-pi/</a></li>\n</ul></section>","frontmatter":{"date":"2019-07-23","title":"Docker Installation","category":"Docker"}}},{"node":{"id":"8c6005a3-3513-5d50-9b6a-4d3bacfd6b81","html":"<p>可以使用 Git 命令行工具获取到当前使用的分支名称，最新的 Git Commit ID 等信息。然而，在不借助 Git 命令的情况下，依然可以通过 .git 文件，找到这些信息。</p>\n<p>在 .git 文件夹中，<code class=\"language-text\">HEAD</code> 文件记录了当前分支的指向。文件内容 <code class=\"language-text\">refs</code> 后面跟着的就是分支名。这个分支名亦是一个路径，在 .git 目录下使用这个相对路径可以得到当前分支指向的头部 Commit ID。</p>\n<p>举个例子：</p>\n<p>发现 <code class=\"language-text\">./.git/HEAD</code> 中的内容是：<code class=\"language-text\">ref: refs/heads/master</code>，通过查看 <code class=\"language-text\">./.git/refs/heads/master</code> 文件中的内容，就可以知道当前的头部 Commit ID。同样，去除 <code class=\"language-text\">refs/heads</code> 之后，就可以得到当前的分支名称，即 <code class=\"language-text\">master</code>。</p>\n<p>对应的 Node.js 代码如下：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> git <span class=\"token operator\">=</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span><span class=\"token function\">cwd</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'.git'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> head <span class=\"token operator\">=</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>git<span class=\"token punctuation\">,</span> <span class=\"token string\">'HEAD'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> ref <span class=\"token operator\">=</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">readFileSync</span><span class=\"token punctuation\">(</span>head<span class=\"token punctuation\">,</span> <span class=\"token string\">'utf8'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">substr</span><span class=\"token punctuation\">(</span><span class=\"token string\">'ref: '</span><span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> commit <span class=\"token operator\">=</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">readFileSync</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>git<span class=\"token punctuation\">,</span> ref<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'utf8'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> branch <span class=\"token operator\">=</span> ref<span class=\"token punctuation\">.</span><span class=\"token function\">substr</span><span class=\"token punctuation\">(</span><span class=\"token string\">'refs/heads/'</span><span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>branch<span class=\"token punctuation\">,</span> commit<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>","frontmatter":{"date":"2019-07-22","title":"Get Branch Name & Commit ID without Git","category":"Git"}}},{"node":{"id":"933770d1-f4e7-5ab2-b4d5-bcc903ddd048","html":"<p>在 Node.js 中，可以通过 <code class=\"language-text\">os.cpus()</code> 这个函数，来了解当前状态下，计算机 CPU 的一些状态。以 MacBookPro 2019 款为例，以下是一份输出的结果：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token punctuation\">[</span>\n  <span class=\"token punctuation\">{</span>\n    model<span class=\"token punctuation\">:</span> <span class=\"token string\">'Intel(R) Core(TM) i7-8750H CPU @ 2.20GHz'</span><span class=\"token punctuation\">,</span>\n    speed<span class=\"token punctuation\">:</span> <span class=\"token number\">2200</span><span class=\"token punctuation\">,</span>\n    times<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n      user<span class=\"token punctuation\">:</span> <span class=\"token number\">239572260</span><span class=\"token punctuation\">,</span>\n      nice<span class=\"token punctuation\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n      sys<span class=\"token punctuation\">:</span> <span class=\"token number\">133555650</span><span class=\"token punctuation\">,</span>\n      idle<span class=\"token punctuation\">:</span> <span class=\"token number\">644681690</span><span class=\"token punctuation\">,</span>\n      irq<span class=\"token punctuation\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">// 省略类似的其他十一个...</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n<p>在这个返回的数组中，每一个元素代表一个 CPU 的线程。这台 MacBookPro 是六核（core）十二线程（processor），所以返回的数组长度是十二。具体来看每一个元素：</p>\n<ul>\n<li>\n<p><code class=\"language-text\">model</code>，表示了当前 CPU 的型号</p>\n</li>\n<li>\n<p><code class=\"language-text\">speed</code>，表示 CPU 的运算速度，单位是 MHz</p>\n</li>\n<li>\n<p><code class=\"language-text\">times</code> 表示 CPU 的使用情况，分别记录了一些时间（单位是毫秒）：</p>\n<ul>\n<li><code class=\"language-text\">user</code> 表示进程在用户模式（user mode）下使用的时间；</li>\n<li><code class=\"language-text\">nice</code> 表示被调整优先级（nice）的进程在用户模式下使用的时间。这里，nice 用于表示执行的优先级，从 -20（最高优先级）到 19（最低优先级）。默认的程序，优先级是 0；（注：这是一个 Unix 特有的功能，对于 Windows 用户来说，这个值永远是 0）</li>\n<li><code class=\"language-text\">sys</code> 表示进程在内核模式下使用的时间；</li>\n<li><code class=\"language-text\">idle</code> 表示空闲的时间；</li>\n<li><code class=\"language-text\">irq</code> 表示硬中断请求花费的时间。硬中断也叫外部中断，由外部硬件产生，如鼠标、键盘等。</li>\n</ul>\n</li>\n</ul>\n<p>有了以上的数据，就可以在 Node / Electron 程序中查看 CPU 的使用，从而对当前程序的执行情况有一个客观的了解。</p>","frontmatter":{"date":"2019-07-19","title":"CPU Usage via Nodejs","category":"Node.js"}}},{"node":{"id":"cab35168-e827-5863-bde2-8bc6e260c818","html":"<p><code class=\"language-text\">navigator.platform</code> 可以获取到当前浏览器所在的操作系统信息。一般来说会得到一个字符串用以表示操作系统，但某些情况下也可能会拿到空字符串（浏览器拒绝或不能给出操作系统信息）。</p>\n<p>需要注意的一点是，即使是 64 位的 Windows 操作系统，得到的结果很可能是 <code class=\"language-text\">Win32</code> 而不是 <code class=\"language-text\">Win64</code>。根据 <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/NavigatorID/platform\">MDN</a> 的数据，Internet Explorer 和 v63 前的 Firefox 会使用 <code class=\"language-text\">Win64</code>，其他的一般返回 <code class=\"language-text\">Win32</code>。</p>\n<p>综上，可以使用如下的方法检测当前是否是 Windows 系统：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> isWindows <span class=\"token operator\">=</span> navigator<span class=\"token punctuation\">.</span>platform<span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Win'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><code class=\"language-text\">navigator.platform</code> 基本没有浏览器兼容性问题，可以放心使用。</p>","frontmatter":{"date":"2019-07-18","title":"navigator.platform","category":"JavaScript"}}},{"node":{"id":"900daf81-1953-57db-a53b-e4d1a9eee083","html":"<p>console 中可以通过 <code class=\"language-text\">console.count</code> 来进行记数。</p>\n<p>简单的使用方法如下：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">callMe</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">count</span><span class=\"token punctuation\">(</span><span class=\"token string\">'callMe func'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">countReset</span><span class=\"token punctuation\">(</span><span class=\"token string\">'callMe func'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">callMe</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// output => callMe func: 1</span>\n<span class=\"token function\">callMe</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// output => callMe func: 2</span>\n<span class=\"token function\">callMe</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// output => callMe func: 3</span></code></pre></div>\n<p>几点说明：</p>\n<ul>\n<li><code class=\"language-text\">console.countReset</code> 函数可以用于清空记数</li>\n<li>传递的参数可以用于标记 <code class=\"language-text\">count</code> 的类别，如果不传就是默认的 default</li>\n<li>不同类别之间的 <code class=\"language-text\">count</code> 不会共享数据</li>\n</ul>","frontmatter":{"date":"2019-07-17","title":"console.count","category":"JavaScript"}}},{"node":{"id":"e01ed2b5-4f98-54e9-9733-f531d4d08472","html":"<p>在 Windows 上，很多文本文件并不是以 UTF-8 的格式进行存储的。比如，中文可能的存储格式是 GB2312 或是 BIG5。这导致，在其他系统中，如果直接以 UTF-8 的格式打开对应的文本文件，就会得到一串乱码。</p>\n<p>如果不知道之前是以什么格式存储的文件，这时就会有点束手无策了。</p>\n<p>一个可行的简单方法是用 VSCode 的“猜测”功能。在 VSCode 中，如果选择 <code class=\"language-text\">Reopen with Encoding</code>，会得到 VSCode 猜测的当前文本编码格式。如果使用新的编码重新打开文本，看到的不再是乱码，那么很可能 VSCode 就猜测正确了。一般建议再以 UTF-8 的格式保存一下，以后再次打开就不会有乱码的困扰了。</p>\n<p>然而，这个方法不适应大规模批量修改的需求。既然如此，不如直接从 VSCode 的源码入手，看看这个文本编码检测的功能是如何实现的。</p>\n<p>VSCode 相关的代码，可以在 <code class=\"language-text\">src/vs/base/node/encoding.ts</code> 中找到，GitHub 的代码在<a href=\"https://github.com/microsoft/vscode/blob/HEAD/src/vs/base/node/encoding.ts\">这里</a>。</p>\n<p>精简后的代码如下：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> fs <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> jschardet <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'jschardet'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> iconv <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'iconv-lite'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token constant\">JSCHARDET_TO_ICONV_ENCODINGS</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token string\">'ibm866'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'cp866'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'big5'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'cp950'</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> fromPath <span class=\"token operator\">=</span> <span class=\"token string\">'/path/to/read/file'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> toPath <span class=\"token operator\">=</span> <span class=\"token string\">'/path/to/save/file'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> buffer <span class=\"token operator\">=</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">readFileSync</span><span class=\"token punctuation\">(</span>fromPath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> encoding <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> jschardet<span class=\"token punctuation\">.</span><span class=\"token function\">detect</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> iconvEncoding <span class=\"token operator\">=</span> <span class=\"token constant\">JSCHARDET_TO_ICONV_ENCODINGS</span><span class=\"token punctuation\">[</span>encoding<span class=\"token punctuation\">]</span> <span class=\"token operator\">||</span> encoding<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> content <span class=\"token operator\">=</span> iconv<span class=\"token punctuation\">.</span><span class=\"token function\">decode</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">,</span> iconvEncoding<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nfs<span class=\"token punctuation\">.</span><span class=\"token function\">writeFileSync</span><span class=\"token punctuation\">(</span>filename<span class=\"token punctuation\">,</span> content<span class=\"token punctuation\">,</span> <span class=\"token string\">'utf8'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>这里主要用到了两个库，<code class=\"language-text\">jschardet</code> 和 <code class=\"language-text\">iconv-lite</code>。</p>\n<p><a href=\"https://github.com/aadsm/jschardet\">jschardet</a> 是 Python <a href=\"https://github.com/chardet/chardet\">chardet</a> 的一个 JavaScript 移植版本，用于检测当前的二进制流（Buffer）是什么类型的编码。检测的大致原理，可以在 chardet 的网站上找到（<a href=\"https://chardet.readthedocs.io/en/latest/how-it-works.html\">这里</a>）。</p>\n<p><a href=\"https://github.com/ashtuchkin/iconv-lite\">iconv-lite</a> 用于将二进制流转化成指定编码格式的字符串，是一个纯 JavaScript 的 <code class=\"language-text\">iconv</code> 库。这里 <code class=\"language-text\">iconv</code> 的全称是 internationalization conversion，在类 Unix 系统中，这是一个用于转换不同编码字符串的命令行工具。</p>\n<p>需要注意的是，<code class=\"language-text\">iconv-lite</code> 并不通过编码来区分 UTF-8 和 UTF-8 with BOM，而是通过第二个参数 <code class=\"language-text\">{ addBOM }</code> 来完成的。因此，转化 UTF-8 with BOM 的时候，需要稍微手动处理一下。（处理的方法可以参考 VSCode 中的相关函数，比如 <code class=\"language-text\">encode</code>）</p>\n<p>另外，<code class=\"language-text\">jschardet</code> 和 <code class=\"language-text\">iconv-lite</code> 对编码的命名有些不同，使用前需要转化。上面示例代码中的 <code class=\"language-text\">JSCHARDET_TO_ICONV_ENCODINGS</code> 就是做的这个事情。</p>","frontmatter":{"date":"2019-07-16","title":"Detect True Encoding of File and Convert","category":"JavaScript"}}},{"node":{"id":"acadd93d-6abc-5e90-b874-bb7d929aac85","html":"<p>在 Chrome 中，如果当前的光标在地址栏上，可以通过快捷键 <code class=\"language-text\">Cmd + Enter</code> 来打开一个和当前页面一样的新标签页（焦点依然在当前标签页上）。如果光标不在地址栏上，可以先使用 <code class=\"language-text\">Cmd + L</code> 来将光标移动到地址栏，然后再 <code class=\"language-text\">Cmd + Enter</code>。</p>\n<p>如果改用 <code class=\"language-text\">Option + Enter</code>，则可以新创建同一个 URL 地址的标签页，并将焦点定位到新打开的标签页上。</p>\n<p>如果改用 <code class=\"language-text\">Shift + Enter</code>，则可以在一个新窗口打开当前的 URL 地址。</p>","frontmatter":{"date":"2019-07-15","title":"Clone Current Tab in Chrome","category":"Chrome"}}},{"node":{"id":"6242dab1-e98d-5c2a-8c64-e29049a8e192","html":"<p>在 Git 的一些操作中，可能会中途停下来，等待用户输入的操作。比如，<code class=\"language-text\">git rebase -i</code> 或 <code class=\"language-text\">git ammend</code> 的时候。在完成操作前，Git 会打开 Vim（或其他默认的编辑器）等待用户对 commit message 做最后的处理。只要用户保存并退出，rebase 的过程就完成了。</p>\n<p>如果在这个等待确认的过程中，希望可以中断整个过程，使用 <code class=\"language-text\">Ctrl+C</code> 是不行的。如果使用 <code class=\"language-text\">Ctrl+C</code>，Vim 可能会提示用 <code class=\"language-text\">qa!</code> 来放弃所有修改并退出 Vim。但这个只是退出了 Vim，Git 依然会继续接下来的流程，并没有真正达到中断 Git 的目的。</p>\n<p>事实上，Vim 允许以 error code 退出，使用如下的命令：<code class=\"language-text\">:cq</code>。</p>\n<p>更多关于这个命令的说明，可以使用  <code class=\"language-text\">:help cq</code> 来查看。以 error code 退出之后，Git 就不会再继续接下来的流程了。</p>","frontmatter":{"date":"2019-07-14","title":"Abort Git Rebase Process","category":"Git"}}},{"node":{"id":"df225d39-2efc-5060-9023-320d0e57bda2","html":"<p>在 React 开发过程中，使用 Facebook 提供的官方 Chrome DevTool Extension 可以很方便的查看，修改页面上的 React 组件。然而，有时候也需要在没有 DevTool 的情况下，对 React 组件进行 Debug。比如：在测试电脑上查看一个即时出现的问题，或是在 Internet Explorer / Safari 上调试一个出现的问题等。</p>\n<p>以下介绍如何在不借助 Chrome DevTool Extension 的情况下，完成对当前 React 组件的检查。</p>\n<p>首先，需要获取到某个需要查看的 DOM 元素。可以用 <code class=\"language-text\">querySelector</code> 或是在 Chrome DevTool 中选中某个元素，然后在 Console 中使用 <code class=\"language-text\">$0</code> 获得该元素。</p>\n<p>React 会在元素上添加额外的属性，用于记录当前这个 React 节点的相关数据。可以通过下面的代码来获取这个属性数据：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">getInstance</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">element</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> key <span class=\"token operator\">=</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span>element<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">key</span> <span class=\"token operator\">=></span> key<span class=\"token punctuation\">.</span><span class=\"token function\">startsWith</span><span class=\"token punctuation\">(</span><span class=\"token string\">'__reactInternalInstance$'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>key<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> element<span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>React 在添加属性的时候，属性名称会增加一个随机字符串作为后缀（各个 React Node 使用的随机字符串是一致的）。所以需要通过检查 <code class=\"language-text\">startsWith</code> 来判断当前属性是否是 React 使用的属性。</p>\n<p>拿到的这个对象，有一些有用的数据，包括：</p>\n<ul>\n<li>child - 当前元素子元素的头个元素</li>\n<li>elementType/type - 该 React 节点对应的类型。如果是 HTML Element，那么就是一个字符串，比如 <code class=\"language-text\">&quot;div&quot;</code>；如果是一个自定义的 React 元素，则是一个函数（class 或 function）。也就是 <code class=\"language-text\">React.createElement</code> 函数的第一个参数。</li>\n<li>memoizedProps - 当前元素使用的 props。对于任何一个 React 生成的 HTML 元素，对会有对应的 Props。（写 JSX 的时候，每一个属性，包括 children，都是一个 Props 的属性值）</li>\n<li>memoizedState - 当前元素使用的 state</li>\n<li>return - 当前元素所在双向链表的上一个元素</li>\n<li>sibling - 当前元素下一个兄弟元素</li>\n<li>stateNode - 当前元素在组件内可以用的 <code class=\"language-text\">this</code>，包含了 <code class=\"language-text\">props</code>，<code class=\"language-text\">refs</code>，<code class=\"language-text\">state</code>，<code class=\"language-text\">context</code> 以及其他 React Component 的方法。在这个对象的原型链上，还有 React Component 组件的各个方法（比如生命周期函数如 <code class=\"language-text\">componentDidMount</code>）以及 <code class=\"language-text\">setState</code> 等可用方法。换句话说，这里的对象就是一个 React Component Class 生成的实例。如果组件是一个 Functional Component，那么这里就是 <code class=\"language-text\">null</code> 了。</li>\n</ul>\n<p>根据 React 16 中 Fiber 的设计，元素之间是一个双向链表的关系，每一个节点会连结其上一个元素（<code class=\"language-text\">return</code>），子元素的首个元素（<code class=\"language-text\">child</code>），下一个兄弟元素（<code class=\"language-text\">sibling</code>），因而从任意一个中间的 HTML 元素开始，都可以遍历整个 React 树。</p>\n<p>注：从一个元素 A 的 <code class=\"language-text\">sibling</code> 抵达下一个元素 B 后，该元素 B 的 <code class=\"language-text\">return</code> 是他的上一个兄弟元素，也就是 A，而不是真正意义上 React / HTML 树的父元素。只有当 B 是 A 的第一个子元素的时候，B 的 <code class=\"language-text\">return</code> 才是它在树上的父元素。</p>","frontmatter":{"date":"2019-07-11","title":"Inspect React Node without DevTool","category":"JavaScript"}}},{"node":{"id":"a34f7707-539c-5098-991d-c87e8cc4a7e2","html":"<p>在 React 16 中（包括 React 15.6 及之后的版本），如果想要用 JavaScript 在外部触发一个 <code class=\"language-text\">input</code> 组件的 <code class=\"language-text\">onChange</code> 事件，需要做如下的几个事情：</p>\n<ol>\n<li>首先，让 React 记录下新的 <code class=\"language-text\">value</code> 值。React 通过 <code class=\"language-text\">defineProperty</code> 封装了 <code class=\"language-text\">value</code> 的 <code class=\"language-text\">set</code> 方法，因而直接调用 <code class=\"language-text\">input.value = xxx</code> 并不能达到预期的效果（实际触发的是 React 封装的 setter，而不是实际 DOM 的 setter）。为此，可以使用如下的方法绕过去：</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> input <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.xxx'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> originalSetter <span class=\"token operator\">=</span>\n  Object<span class=\"token punctuation\">.</span><span class=\"token function\">getOwnPropertyDescriptor</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HTMLInputElement</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">,</span> <span class=\"token string\">'value'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>set<span class=\"token punctuation\">;</span>\n<span class=\"token function\">originalSetter</span><span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span>input<span class=\"token punctuation\">,</span> <span class=\"token string\">'your value here'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ol start=\"2\">\n<li>其次，需要触发一次 <code class=\"language-text\">onChange</code> 的事件，好让 React 的组件可以在原来既定的回调函数中处理新的数据：</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> event <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Event</span><span class=\"token punctuation\">(</span><span class=\"token string\">'input'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> bubbles<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ninput<span class=\"token punctuation\">.</span><span class=\"token function\">dispatchEvent</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>以下是一个完整可用的方法：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">change</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">input<span class=\"token punctuation\">,</span> value</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> setter <span class=\"token operator\">=</span>\n    Object<span class=\"token punctuation\">.</span><span class=\"token function\">getOwnPropertyDescriptor</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HTMLInputElement</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">,</span> <span class=\"token string\">'value'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>set<span class=\"token punctuation\">;</span>\n  <span class=\"token function\">setter</span><span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span>input<span class=\"token punctuation\">,</span> value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> event <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Event</span><span class=\"token punctuation\">(</span><span class=\"token string\">'input'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> bubbles<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  input<span class=\"token punctuation\">.</span><span class=\"token function\">dispatchEvent</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>","frontmatter":{"date":"2019-07-10","title":"Trigger onChange for React Input","category":"JavaScript"}}},{"node":{"id":"e497aca9-18d8-5eae-b4ba-18e04bdeb631","html":"<p><a href=\"http://www.ecma-international.org/ecma-262/9.0/#sec-object-initializer\">ES2018</a> 增加了 Object Spread 操作符的官方支持。Object Spread 操作符和 <code class=\"language-text\">Object.assign</code> 的一些区别，可以参考<a href=\"https://2ality.com/2016/10/rest-spread-properties.html#spread-defines-properties-objectassign-sets-them\">这篇文章</a>。</p>\n<p>在 JavaScript 执行 Object Spread 操作符的时候，需要进行如下的几步操作：</p>\n<ol>\n<li>确定对象有哪些自己的属性。原型链上的部分是不会被 Object Spread 操作符接收的，举个例子：</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> obj <span class=\"token operator\">=</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span>\n  <span class=\"token punctuation\">{</span> parent<span class=\"token punctuation\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span>\n    current<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n      enumerable<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n      value<span class=\"token punctuation\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token operator\">...</span>obj <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// output => { current: 2 }</span></code></pre></div>\n<ol start=\"2\">\n<li>确定第一步拿到的属性中，有那些是可枚举的（enumerable）。不可枚举的部分，不会被接收，举个例子：</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> obj <span class=\"token operator\">=</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span>\n  <span class=\"token punctuation\">{</span> parent<span class=\"token punctuation\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span>\n    current<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n      enumerable<span class=\"token punctuation\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n      value<span class=\"token punctuation\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token operator\">...</span>obj <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// output => { }</span></code></pre></div>\n<ol start=\"3\">\n<li>分别获取到这些属性的值</li>\n</ol>\n<p>根据以上的规则，现在可以考虑这样一个场景：假设需要一个 Proxy 来修改访问对象属性的行为，比如对对象任意属性的取值，都从它的某一个子属性中去拿。例子：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> obj <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> key<span class=\"token punctuation\">:</span> <span class=\"token string\">'value'</span><span class=\"token punctuation\">,</span> child<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> key<span class=\"token punctuation\">:</span> <span class=\"token string\">'inner-value'</span> <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> handler <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">/* todo */</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> proxy <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Proxy</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">,</span> handler<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>proxy<span class=\"token punctuation\">.</span>key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// => output: inner-value</span></code></pre></div>\n<p>这里的 handler 并不难写，只需要：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> handler <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> target<span class=\"token punctuation\">.</span>child<span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// or:</span>\n    <span class=\"token comment\">// return Reflect.get(target.child, key);</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>现在，如果需要 Proxy 也同样可以支持 Object Spread 的功能，那么就需要对 <code class=\"language-text\">handler</code> 做更多的处理。从上面的分析来看，第一步获取自有属性，需要用到 <code class=\"language-text\">ownKeys</code>；第二步获取可枚举属性，需要用到 <code class=\"language-text\">getOwnPropertyDescriptor</code>；最后一步获得属性值，依然需要 <code class=\"language-text\">get</code>。</p>\n<p>代码如下：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> obj <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> key<span class=\"token punctuation\">:</span> <span class=\"token string\">'value'</span><span class=\"token punctuation\">,</span> child<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> key<span class=\"token punctuation\">:</span> <span class=\"token string\">'inner-value'</span> <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> handler <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> Reflect<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">.</span>child<span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function\">ownKeys</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">target</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> Reflect<span class=\"token punctuation\">.</span><span class=\"token function\">ownKeys</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">.</span>child<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function\">getOwnPropertyDescriptor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">target<span class=\"token punctuation\">,</span> key</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> Reflect<span class=\"token punctuation\">.</span><span class=\"token function\">getOwnPropertyDescriptor</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">.</span>child<span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> proxy <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Proxy</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">,</span> handler<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token operator\">...</span>proxy <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// => output: { key: 'inner-value' }</span></code></pre></div>","frontmatter":{"date":"2019-07-09","title":"Object Spread and Proxy","category":"JavaScript"}}},{"node":{"id":"e5213af7-1346-54d5-b4ad-fcac44ca51e5","html":"<p><code class=\"language-text\">rev-parse</code> 并不是 Git 中一个不常用的命令。Git 的一些命令底层会使用 <code class=\"language-text\">rev-parse</code> 来处理输入的参数。</p>\n<p>通过 <code class=\"language-text\">rev-parse</code> 可以获得一些有用的 Git 数据，比如：</p>\n<ul>\n<li>获取当前的 commit id</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">git</span> rev-parse HEAD</code></pre></div>\n<ul>\n<li>获取当前的分支名</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">git</span> rev-parse --symbolic-full-name --abbrev-ref HEAD</code></pre></div>","frontmatter":{"date":"2019-07-08","title":"git rev-parse","category":"Git"}}},{"node":{"id":"44a44e87-4670-5fe2-9e4a-b05b1e1a928d","html":"<p>在 TypeScript 中，如果希望一个变量只能取某几个固定值中的一个，可以这么写：</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">type</span> Type <span class=\"token operator\">=</span> <span class=\"token string\">'a'</span> <span class=\"token operator\">|</span> <span class=\"token string\">'b'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> a<span class=\"token punctuation\">:</span> Type <span class=\"token operator\">=</span> <span class=\"token string\">'a'</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// ✔</span>\n<span class=\"token keyword\">const</span> c<span class=\"token punctuation\">:</span> Type <span class=\"token operator\">=</span> <span class=\"token string\">'c'</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// ✖</span></code></pre></div>\n<p>然而，在实际的开发过程中，可能会遇到这样的需求：希望 TypeScript 可以限定某一个类型只能取某几个固定的值，同时这几个值又可以组成一个数组，方便 JavaScript 在运行时动态的执行匹配功能（如 <code class=\"language-text\">Array.prototype.some</code>）。</p>\n<p>如果直接尝试在 TypeScript 中写数组，实际无法达到预想的效果：</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">const</span> list <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'a'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'b'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">type</span> Type <span class=\"token operator\">=</span> list<span class=\"token punctuation\">[</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Type = string</span></code></pre></div>\n<p>这是因为，TypeScript 默认 <code class=\"language-text\">list</code> 的类型是 <code class=\"language-text\">string[]</code>，而不是 <code class=\"language-text\">(&#39;a&#39; | &#39;b&#39;)[]</code>。因此，在转化成 <code class=\"language-text\">Type</code> 的时候，得到的结果是更宽泛的字符串类型，而不是限定死的两个固定值。这其中，一个很重要的原因是 JavaScript 语言的动态性。数组随时可以被加入/删除元素，因而默认只能假设这是一个字符串类型的数组，而不能过多约束。</p>\n<p>为了达到目的，有以下几个变通的写法：</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">const</span> list<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'a'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'b'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'a'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'b'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">type</span> Type <span class=\"token operator\">=</span> list<span class=\"token punctuation\">[</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Type = 'a' | 'b';</span></code></pre></div>\n<p>这种写法比较啰嗦，重新写了一遍完整的数组用于定死类型的选择范围。</p>\n<p>也可以通过写一个辅助函数来达到类似的效果：</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">declare</span> <span class=\"token keyword\">const</span> tupleStr<span class=\"token punctuation\">:</span> <span class=\"token operator\">&lt;</span><span class=\"token constant\">T</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">string</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token operator\">...</span>args<span class=\"token punctuation\">:</span> <span class=\"token constant\">T</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token constant\">T</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> list <span class=\"token operator\">=</span> <span class=\"token function\">tupleStr</span><span class=\"token punctuation\">(</span><span class=\"token string\">'a'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'b'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">type</span> Type <span class=\"token operator\">=</span> list<span class=\"token punctuation\">[</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Type = 'a' | 'b';</span></code></pre></div>\n<p>在 Ant Design 中可以找到<a href=\"https://github.com/ant-design/ant-design/blob/65eb713fe897f65bbf187e215c664e5f9b468252/components/_util/type.ts#L5\">类似的写法</a>。这里也有一个类似的 <a href=\"https://gist.github.com/jcalz/381562d282ebaa9b41217d1b31e2c211\">gist</a>。</p>\n<p>注：上述这种写法需要 TypeScript 3.0 的<a href=\"https://github.com/Microsoft/TypeScript/pull/24897\">支持</a>。</p>\n<p>当然，上述的方案或多或少都需要额外写一些东西，有些麻烦。在 TypeScript 3.4 中，可以通过 <code class=\"language-text\">as const</code> 这个语法来告知 TypeScript 数组是静态的、并不会增加或者减少内容。有了这样的前提假设，TypeScript 就可以更好的进行类型推导，把实际的类型结果限制到已知的几个有限的值范围内。例子如下：</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">const</span> list1 <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'a'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'b'</span><span class=\"token punctuation\">]</span> <span class=\"token keyword\">as</span> <span class=\"token keyword\">const</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> list2 <span class=\"token operator\">=</span> <span class=\"token operator\">&lt;</span><span class=\"token keyword\">const</span><span class=\"token operator\">></span> <span class=\"token punctuation\">[</span><span class=\"token string\">'a'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'b'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">type</span> Type1 <span class=\"token operator\">=</span> list1<span class=\"token punctuation\">[</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">type</span> Type2 <span class=\"token operator\">=</span> list2<span class=\"token punctuation\">[</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>上述两种写法是等价的（参考<a href=\"https://github.com/Microsoft/TypeScript/pull/29510\">这里</a>），都可以达到目的。另外，由于在 TypeScript 中限制了数组，之后想要在数组中做改动都是会导致编译器报错的。</p>\n<p><a href=\"https://stackoverflow.com/questions/45251664/typescript-derive-union-type-from-tuple-array-values\">参考</a></p>","frontmatter":{"date":"2019-07-04","title":"Derive Union Type from Tuple/Array","category":"TypeScript"}}},{"node":{"id":"1f24180f-de0f-5c60-a61f-cfafaf908186","html":"<p><code class=\"language-text\">tldr</code> 是一个社区维护的命令工具，可以用于输出某一个命令的说明文档。相比于 <code class=\"language-text\">man</code> 详尽的文档，<code class=\"language-text\">tldr</code> 更侧重于例子。通过具体的使用场景，介绍该命令一些常用的方法。</p>\n<p><code class=\"language-text\">tldr</code> 相关的一些链接地址：<a href=\"https://github.com/tldr-pages/tldr\">GitHub</a>，<a href=\"https://tldr.sh/\">官方网站</a>。</p>\n<p>安装 <code class=\"language-text\">tldr</code> 可以使用 <code class=\"language-text\">brew</code>：</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">brew <span class=\"token function\">install</span> tldr</code></pre></div>\n<p>比如，需要了解 <code class=\"language-text\">tar</code> 的使用方法，可以运行下面的命令：</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">tldr <span class=\"token function\">tar</span></code></pre></div>\n<p>运行的结果如下：</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/afb42628221addee006643b75e3c5988/04a72/2019-07-03-tldr-screenshot.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 74.28571428571428%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsSAAALEgHS3X78AAABrklEQVQ4y5WTaVLrQAyEc554t2dfnUDgwf3v00+SYyoUAcKPrvEkVe2v1fLBBw/jNKZpwrFp0HXdF7Vte/f3ezo452CMxjiOmOcZfd+jIeOmbcSoub6Enx8xPtRa8f7+hsvlGW//XlFLgTUGgcitNXDW/o2QqVJyyDWinDLyVetzhQ8Oy7L80ZBmF6xCjB55zQjJI+QAR2ZMyIa3sR8yTN4gR4fTZRXKtCY4Z6GVkviKzubG7CfjA7frrN5EpiF7KckTqYsWnu5c2F7KbvadKc2QCB0RUsx6rogc2Vs8vZwxLRNmvTXf9d2m3wjZsBBZYcOnKrFjDZjUhMUsUDRf7Uheix4yTMEikSnPrp6LxGay3VDZ7eT7x0527felRJpZopipJBRqOhJtP/YYpgHjPIokvpo/Ed7OdZeUEqhlnhsTRtpHLoIpPVFvd9rHK6Gi+K44OXWgIrOFCQYmGrmLYTS0h1RMWQtRRlnolKMo0H5qSsCFcDn9QOSkj+dxkHOXfClcykokp8tJvhCOxjOcSMfjURb7Xry7kcdhRN+0GDp+84CB3ix/Npse/eR2/Qc7FNr+H6tgOQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"tldr command result\"\n        title=\"\"\n        src=\"/static/afb42628221addee006643b75e3c5988/b9e4f/2019-07-03-tldr-screenshot.png\"\n        srcset=\"/static/afb42628221addee006643b75e3c5988/cf440/2019-07-03-tldr-screenshot.png 148w,\n/static/afb42628221addee006643b75e3c5988/d2d38/2019-07-03-tldr-screenshot.png 295w,\n/static/afb42628221addee006643b75e3c5988/b9e4f/2019-07-03-tldr-screenshot.png 590w,\n/static/afb42628221addee006643b75e3c5988/04a72/2019-07-03-tldr-screenshot.png 840w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>注：<code class=\"language-text\">tldr</code> 的全称是 Too Long; Don’t Read。可以理解成“摘要”的意思。</p>","frontmatter":{"date":"2019-07-03","title":"Command `tldr`","category":"Bash"}}},{"node":{"id":"5bb9d635-989c-55ca-a8fb-22fa80fe2738","html":"<p><code class=\"language-text\">Array.from</code> 是 JavaScript 中一个较新的 API，可以将一个类数组或可迭代对象转化成一个真正的数组。</p>\n<p>类数组（array-like）常见于 DOM API 中取到的数据，比如 <code class=\"language-text\">.querySelectorAll</code>。得到的结果有 <code class=\"language-text\">.length</code> 属性，也可以通过下标获取到数据，但是本身却不是一个数组，没有 <code class=\"language-text\">Array.prototype</code> 上的 API 可以直接用。</p>\n<p>可迭代对象则是指那些定义了 <code class=\"language-text\">Symbol.iterator</code> 属性的对象。</p>\n<p><code class=\"language-text\">Array.from</code> 可以将上述的两种对象直接转化成一个标准的数组：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> iterable <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">*</span><span class=\"token punctuation\">[</span>Symbol<span class=\"token punctuation\">.</span>iterator<span class=\"token punctuation\">]</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">yield</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">yield</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>Array<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>iterable<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// => [1, 2];</span>\n\n<span class=\"token keyword\">const</span> arrayLike <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelectorAll</span><span class=\"token punctuation\">(</span><span class=\"token string\">'span'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>Array<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>arrayLike<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// => [span, span, ...]</span></code></pre></div>\n<p>除了上述常见的应用之外，<code class=\"language-text\">Array.from</code> 还有一些特殊的应用。</p>\n<p>首先，只要指定了 <code class=\"language-text\">length</code> 属性，<code class=\"language-text\">Array.from</code> 就可以创建一个数组。这一行为可以用来创建一个指定长度的数组：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">Array<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> length<span class=\"token punctuation\">:</span> <span class=\"token number\">5</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">_<span class=\"token punctuation\">,</span> i</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// => [0, 1, 2, 3, 4]</span></code></pre></div>\n<p>其次，<code class=\"language-text\">Array.from</code> 函数其实接受不止一个参数。第二个参数是一个 map 函数，第三个参数是 <code class=\"language-text\">thisArg</code>，用于指定 map 函数的 <code class=\"language-text\">this</code> 对象。有了这个 map 函数的支持，上面这个例子就可以进一步改写成：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">Array<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> length<span class=\"token punctuation\">:</span> <span class=\"token number\">5</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">_<span class=\"token punctuation\">,</span> i</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>在转化 DOM 类数组的时候，直接通过指定 map 函数进行进一步的转化，是比较方便的。可以省略一个 <code class=\"language-text\">.map</code> 函数的嵌套，也节省一个中间数组对象的创建。</p>\n<p><code class=\"language-text\">Array.prototype.map</code> 函数可以指定 <code class=\"language-text\">thisArg</code>，在 <code class=\"language-text\">Array.from</code> 中也可以通过第三个参数指定 <code class=\"language-text\">thisArg</code>。以下是一个例子：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> mapper <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  shift<span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">_<span class=\"token punctuation\">,</span> i</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>shift <span class=\"token operator\">+</span> i<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\nArray<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> length<span class=\"token punctuation\">:</span> <span class=\"token number\">5</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> mapper<span class=\"token punctuation\">.</span>run<span class=\"token punctuation\">,</span> mapper<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// => [1, 2, 3, 4, 5];</span></code></pre></div>\n<p>上述写法等价于：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">Array<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> length<span class=\"token punctuation\">:</span> <span class=\"token number\">5</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>mapper<span class=\"token punctuation\">.</span>run<span class=\"token punctuation\">,</span> mapper<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>","frontmatter":{"date":"2019-07-02","title":"Array.from","category":"JavaScript"}}},{"node":{"id":"943188f5-0036-5109-b270-5aa0df3bc68a","html":"<p><code class=\"language-text\">object-fit</code> 这个 CSS 样式，是针对<strong>可替换元素</strong>（replaced element）设计的。一般来说，常见的可替换元素包含图片（<code class=\"language-text\">img</code>）或是视频（<code class=\"language-text\">video</code>）。这些可替换元素的大小是事先不确定的，在实际展示的时候，需要一定的规则来决定元素实际如何被放置到元素框中去。</p>\n<p>以下是几种 <code class=\"language-text\">object-fit</code> 的值及对应的显示效果（每种类型显示两个图片，第一张图片的原始尺寸大于元素显示的尺寸，第二张图片的原始尺寸小于元素显示的尺寸）：</p>\n<style>\np.container-2019-07-01 {\n  display: flex;\n  justify-content: center;\n}\np.container-2019-07-01 a {\n  box-shadow: none;\n}\np.container-2019-07-01 a img {\n  width: 500px;\n  height: 400px;\n  border: 3px solid red;\n  display: block;\n}\n</style>\n<section><h2>fill</h2><p class=\"container-2019-07-01\">\n  <a href=\"../../baseline-jpeg-demo.jpeg\" target=\"_blank\">\n    <img src=\"../../baseline-jpeg-demo.jpeg\" title=\"big image\" alt=\"big image\" style=\"object-fit:fill\" />\n  </a>\n</p>\n<p class=\"container-2019-07-01\">\n  <a href=\"../../favicon.ico\" target=\"_blank\">\n    <img src=\"../../favicon.ico\" title=\"small image\" alt=\"small image\" style=\"object-fit:fill\" />\n  </a>\n</p><ul>\n<li>宽高比例：不保持</li>\n<li>显示范围：占满元素</li>\n<li>可能影响：显示结果宽高比失真；显示结果比原始尺寸大</li>\n</ul></section>\n<section><h2>contain</h2><p class=\"container-2019-07-01\">\n  <a href=\"../../baseline-jpeg-demo.jpeg\" target=\"_blank\">\n    <img src=\"../../baseline-jpeg-demo.jpeg\" title=\"big image\" alt=\"big image\" style=\"object-fit:contain\" />\n  </a>\n</p>\n<p class=\"container-2019-07-01\">\n  <a href=\"../../favicon.ico\" target=\"_blank\">\n    <img src=\"../../favicon.ico\" title=\"small image\" alt=\"small image\" style=\"object-fit:contain\" />\n  </a>\n</p><ul>\n<li>宽高比例：保持</li>\n<li>显示范围：至少一轴占满，整体（另一轴）不超过元素</li>\n<li>可能影响：出现黑边（<a href=\"https://en.wikipedia.org/wiki/Letterboxing_(filming)\">letterboxed</a>）；显示结果比原始尺寸大</li>\n</ul></section>\n<section><h2>cover</h2><p class=\"container-2019-07-01\">\n  <a href=\"../../baseline-jpeg-demo.jpeg\" target=\"_blank\">\n    <img src=\"../../baseline-jpeg-demo.jpeg\" title=\"big image\" alt=\"big image\" style=\"object-fit:cover\" />\n  </a>\n</p>\n<p class=\"container-2019-07-01\">\n  <a href=\"../../favicon.ico\" target=\"_blank\">\n    <img src=\"../../favicon.ico\" title=\"small image\" alt=\"small image\" style=\"object-fit:cover\" />\n  </a>\n</p><ul>\n<li>宽高比例：保持</li>\n<li>显示范围：至少一轴占满，整体（另一轴）可以超过元素</li>\n<li>可能影响：超出显示范围；显示结果比原始尺寸大</li>\n</ul></section>\n<section><h2>none</h2><p class=\"container-2019-07-01\">\n  <a href=\"../../baseline-jpeg-demo.jpeg\" target=\"_blank\">\n    <img src=\"../../baseline-jpeg-demo.jpeg\" title=\"big image\" alt=\"big image\" style=\"object-fit:none\" />\n  </a>\n</p>\n<p class=\"container-2019-07-01\">\n  <a href=\"../../favicon.ico\" target=\"_blank\">\n    <img src=\"../../favicon.ico\" title=\"small image\" alt=\"small image\" style=\"object-fit:none\" />\n  </a>\n</p><ul>\n<li>宽高比例：保持</li>\n<li>显示范围：原始尺寸</li>\n<li>可能影响：超出显示范围</li>\n</ul></section>\n<section><h2>scale-down</h2><p class=\"container-2019-07-01\">\n  <a href=\"../../baseline-jpeg-demo.jpeg\" target=\"_blank\">\n    <img src=\"../../baseline-jpeg-demo.jpeg\" title=\"big image\" alt=\"big image\" style=\"object-fit:scale-down\" />\n  </a>\n</p>\n<p class=\"container-2019-07-01\">\n  <a href=\"../../favicon.ico\" target=\"_blank\">\n    <img src=\"../../favicon.ico\" title=\"small image\" alt=\"small image\" style=\"object-fit:scale-down\" />\n  </a>\n</p><p>使用 <code class=\"language-text\">none</code> 或者 <code class=\"language-text\">contain</code> 的规则进行显示。具体选择哪个规则，要看两个规则生成的最终效果，哪一个更小。换句话说，如果元素的原始尺寸两轴都小于元素的显示范围，就使用 <code class=\"language-text\">none</code> 进行显示，显示结果是原始元素的原始尺寸；否则就是用 <code class=\"language-text\">contain</code> 的方式进行显示，用黑边的方式将元素压缩到显示范围内完整显示。</p></section>","frontmatter":{"date":"2019-07-01","title":"object-fit","category":"CSS"}}}]}},"pageContext":{"isCreatedByStatefulCreatePages":false,"startInMonth":"2019-07-01","endInMonth":"2019-07-31","time":"2019-07","previous":"2019-06","next":"2019-08"}}}
{"componentChunkName":"component---src-templates-til-per-month-js","path":"/til/2019/06","webpackCompilationHash":"687e338135c47159cd63","result":{"data":{"site":{"siteMetadata":{"title":"LaySent's Site"}},"allMarkdownRemark":{"edges":[{"node":{"id":"ee62200f-3890-54ec-a825-283a2607d0fc","html":"<p><a href=\"https://www.desmos.com/calculator\">desmos</a> 是一个在线的网站，可以用于绘制数学表达式对应的函数图像。</p>\n<p>生成的结果可以通过链接分享，也可以生成 PNG 格式的图片下载到本地。</p>\n<p>以下是一个例子：</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8e68ad8bbebf7e4cb6b0be8fc408023d/8ff1e/2019-06-30-desmos-graph.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsSAAALEgHS3X78AAACmklEQVQ4y41U2W7TQBTN/38C4qWAStNstPACEryCQKSqVJoFozTx1ixOHK/jJT3cO/ZYk1IED1ee8dx75tzlTCvPc+iWpimKhwd4377C6pzBvhjg+vkz3PU6sGnvDb+jBJAmCbIsQ1kUSNIM1jpAQesWg/ABmwQkx5wC/NsfsM7P4L69wLx7jjsym0D98RgFnScx+eUZgQmYqwCpEDiU5V8AywMiy4Td78K5fFMBdtpwBj1EroP8cEAmUsQJga0ZLENBsQ3DxynndCDCEPagD5dSXhAzCUjgIopQHkpExNBc7SGISFFUpEpmKIgqg7DxOo7jak9M3Q/vYRHL6ekr/CK7//SRfFICSzFzPAmaafEM2lLpKksISDBLasxGNqYNo/0axssT+NdXSKgc5tKXYDn5izqOyRw1RU+Zb+XCh7OZbMSi38OcQP35AtYukcHsI7S4JuU/mlKnzmuul/PuksBOYXS7MO/9pgFJfbGenWTIqLxQpoBl15jl7Q2MFycYfRnSfILmLj/202IP1P3Wfr8HWxAE0nzfR/UvQBSF2O18XH0ewl0uERNj5bvb7Y7i1Lo1nU5hWVZzYJom7W1ENDYbbwvDXGH804Dr2M2F/HUcR5r6xzYajaouK+qcPteGFSCyHPYmlDMZBlUWnJJKT9T101NmnKOmSONZZAXQ0KYkK9YqgzEDVTs2NXe6NV2uQHMZfKSAmnlU105vhgLUVdYoRY0Ag+kKSOoRsm0bnuc1zJSiWARKJUdK4ZqpNB8rgM11XdlVvXZSUdocNkqp3rPq1RB1DZUCVNH/J+Wmhvw4Vu9Z9WrojgpQjca/ACVDa109jkX9U9VIl+N2u30SUDwlPSmZWn5MWZ8t3nPgZDKRLNUc6n66dPn8Nwam94/N3nKrAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"desmos-graph\"\n        title=\"\"\n        src=\"/static/8e68ad8bbebf7e4cb6b0be8fc408023d/b9e4f/2019-06-30-desmos-graph.png\"\n        srcset=\"/static/8e68ad8bbebf7e4cb6b0be8fc408023d/cf440/2019-06-30-desmos-graph.png 148w,\n/static/8e68ad8bbebf7e4cb6b0be8fc408023d/d2d38/2019-06-30-desmos-graph.png 295w,\n/static/8e68ad8bbebf7e4cb6b0be8fc408023d/b9e4f/2019-06-30-desmos-graph.png 590w,\n/static/8e68ad8bbebf7e4cb6b0be8fc408023d/8ff1e/2019-06-30-desmos-graph.png 800w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>对应的在线观看地址：<a href=\"https://www.desmos.com/calculator/zthodlfe0t\">这里</a></p>","frontmatter":{"date":"2019-06-30","title":"Draw Math Equation","category":"Service"}}},{"node":{"id":"dae8ea5b-aac6-5242-9b7c-16546d92ecb3","html":"<p>在一个表单中敲击回车按钮，默认会触发 <code class=\"language-text\">&lt;form&gt;</code> 的 submit 事件。当 <code class=\"language-text\">&lt;form&gt;</code> 里面有 <code class=\"language-text\">&lt;button type=&quot;submit&quot;&gt;</code> 按钮的时候，敲击回车会先触发 <code class=\"language-text\">button</code> 的 click 事件，再触发 <code class=\"language-text\">form</code> 的 submit 事件。</p>\n<p>因为有了这样的机制，在一个表单中，只要指定了 submit 按钮，那么不论是点击按钮还是直接按回车，都可以触发相同的 click 事件，达到同样的代码提交功能。这使得代码可以很容易的复用，不需要额外的工作量就可以让鼠标和键盘都能够方便的提交表单。</p>\n<p>然而在实际开发的过程中，因为组件的划分，有时候不能做到 <code class=\"language-text\">&lt;button type=&quot;submit&quot;&gt;</code> 放在 <code class=\"language-text\">&lt;form&gt;</code> 中。HTML5 中，增加了 <code class=\"language-text\">button</code> 的 <code class=\"language-text\">form</code> 属性，可以用于关联表单和表单外的提交按钮。</p>\n<p>举例如下：</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>form</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>form-id<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>text<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>name<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>form</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>submit<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">form</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>form-id<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Submit<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>在上述代码中，button 存在于 form 的外面，理论上和 form 是没有关联的。但是，因为 <code class=\"language-text\">form</code> 字段的存在，使得 form 和 button 被关联了起来。这样，和 button 在 form 中的表现形式一样，在 form 内敲击回车，就可以触发 button 的 click 事件。</p>\n<p>注：如果 click 事件和 submit 事件（如果定义了）都没有 <code class=\"language-text\">event.preventDefault()</code>，那么就会触发默认的 form 提交流程，会造成页面提交。如果 form 没有指定提交的地址，那么就会提交到当前页面。这可能并不是预期中的行为。</p>","frontmatter":{"date":"2019-06-27","title":"Submit Button outside Form","category":"HTML"}}},{"node":{"id":"e2e9cf08-6feb-5a45-82e0-3b6c74f31459","html":"<p>在使用服务器编译上线包的过程中，可能会使用 nvm 来管理编译使用的 Node.js 版本。此时，运行时 Node.js 的二进制文件和实际服务器本身的 Node.js 文件将会是不同的。</p>\n<p>这样做的好处是可以隔离，保证编译的环境是稳定的。</p>\n<p>但是，当 npm 试图运行 Node.js 的时候，就要格外小心了。默认情况下，npm 会使用 path 中定义的 Node.js 版本。而对于打包服务器来说，这个 path 上的 Node.js 很可能并不是 nvm 管理的那个版本。</p>\n<p>举个例子，如果 <code class=\"language-text\">package.json</code> 中定义了 <code class=\"language-text\">postinstall</code> 的脚本，如下；</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"postinstall\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"some-cli\"</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>那么，在 <code class=\"language-text\">yarn install</code> 之后，执行这个 <code class=\"language-text\">postinstall</code> 的过程中，<code class=\"language-text\">some-cli</code> 需要 Node.js 来执行，而 npm 使用的 Node.js 是 path 上的默认版本，和 nvm 管理的并不是同一个。命令行会有如下的报错：</p>\n<blockquote>\n<p>npm WARN lifecycle The node binary used for scripts is xxx but npm is using xxx itself. Use the <code class=\"language-text\">--scripts-prepend-node-path</code> option to include the path for the node binary npm was executed with.</p>\n</blockquote>\n<p>正如报错指出的，为了修正这个问题，需要用到 <code class=\"language-text\">scripts-prepend-node-path</code>。这样，当 npm 需要 Node.js 来执行代码的时候，会选择和自身匹配的 Node.js 版本，而不是默认 path 上的版本。（<a href=\"https://docs.npmjs.com/cli/run-script.html\">文档</a>）</p>\n<p>除了每次运行时加上命令行参数之外，一个比较简单的方法是使用 npm config 设置相对应的参数：</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> config <span class=\"token keyword\">set</span> scripts-prepend-node-path<span class=\"token operator\">=</span>true</code></pre></div>\n<p>或是在 .npmrc 中加上</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">scripts-prepend-node-path true</code></pre></div>\n<p>设置完后，就不会再有报错了。</p>","frontmatter":{"date":"2019-06-26","title":"scripts-prepend-node-path","category":"Node.js"}}},{"node":{"id":"dda454b0-1228-5832-8ce6-c393e0a32cd8","html":"<p>在 Chrome 浏览器中，有专门用于页面截屏的扩展应用。其实 Chrome 自身也提供了截屏的工具。</p>\n<p>要使用 Chrome 自带的页面截屏方案，首先需要打开 Chrome DevTools。接下来，按 Cmd + Shift + P 打开指令搜索框。在搜索框中，搜索 <code class=\"language-text\">screenshots</code> 就可以找到和截屏相关的各个命令：</p>\n<ul>\n<li>Capture area screenshot - 可以截取<strong>页面</strong>某一个区域的图像（用鼠标选择）</li>\n<li>Capture full size screenshot - 可以截取整个页面的图像</li>\n<li>Capture node screenshot - 可以截取当前 DevTool 中选中的元素的图像</li>\n<li>Capture screenshot - 可以截取当前可视区域的图像</li>\n</ul>\n<p>其中，<code class=\"language-text\">Capture node screenshot</code> 是一个比较有意思的功能。在 DevTool 中选定了某一个元素（Element）之后，执行这个命令，就会将这个元素自身的区域截图。当然，元素所在区域内，由于排版的缘故，还存在父元素，子元素或是其他什么元素的内容。在执行截图命令的时候，这些内容也会被包含进去。</p>","frontmatter":{"date":"2019-06-25","title":"Screenshot in Chrome","category":"Chrome"}}},{"node":{"id":"4bc0e336-b99c-5347-b119-ad58c0421c36","html":"<p>前端的开发工程，经常需要开启一些调试用的服务器，一旦调试的服务器多了，难免会出现网络端口号的冲突；类似的，如果在一台开发机上有多个人同时开发，开发脚本也就不能写死一个固定的端口号了。在这类情况下，如果要手动解决这些冲突（修改端口号或者手写端口号的分配规则），不免有些麻烦。</p>\n<p>事实上，创建服务的时候，可以设置 <code class=\"language-text\">0</code> 作为端口号。这样的话，系统就会指定一个当前空闲可用的端口号，以保证不发生端口号冲突的情况。</p>\n<p>下面是一段 Node.js 的示意代码：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> http <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'http'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> server  <span class=\"token operator\">=</span> http<span class=\"token punctuation\">.</span><span class=\"token function\">createServer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">request<span class=\"token punctuation\">,</span> response</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  response<span class=\"token punctuation\">.</span><span class=\"token function\">writeHead</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token string\">'Content-Type'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'text/html'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  response<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n    <span class=\"token string\">'&lt;html>'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'&lt;head>&lt;title>Node.js Server&lt;/title>&lt;/head>'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'&lt;body>&lt;h1>Hello World&lt;/h1>&lt;/body>'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'&lt;/html>'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  response<span class=\"token punctuation\">.</span><span class=\"token function\">end</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// ask for an available port</span>\nserver<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nserver<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'listening'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ask for actually used port</span>\n  <span class=\"token keyword\">var</span> port <span class=\"token operator\">=</span> server<span class=\"token punctuation\">.</span><span class=\"token function\">address</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>port<span class=\"token punctuation\">;</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token string\">`server is listening: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>port<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>其中，<code class=\"language-text\">server.address().port</code> 可以拿到当前系统具体分配的端口号。有了这个端口号，就可以自动/手动的打开对应的 URL 地址以访问新生成的服务了。</p>","frontmatter":{"date":"2019-06-24","title":"Get Available Port Number","category":"JavaScript"}}},{"node":{"id":"18aa2911-dacb-5204-afab-7932344f61e3","html":"<p>下面展示的这段 CSS 设置非常常见，可以让文字超过宽度的时候，显示 <code class=\"language-text\">...</code>：</p>\n<div class=\"gatsby-highlight\" data-language=\"css\"><pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">.ellipsis</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">white-space</span><span class=\"token punctuation\">:</span> nowrap<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">overflow</span><span class=\"token punctuation\">:</span> hidden<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">text-overflow</span><span class=\"token punctuation\">:</span> ellipsis<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>在实际业务中，经常会碰到这样的需求：只有当显示出 <code class=\"language-text\">...</code> 的时候，才做某些事情（比如，才在鼠标悬停的时候展示 Tooltip，用以显示完整的文字内容）。CSS 本身并没有提供足够的接口，让开发者可以直观的了解到当前的文字内容是否已经超出了可以显示的范围。如果需要判断当前内容是否超出了元素的宽度（因而让 CSS 渲染出 <code class=\"language-text\">...</code>），可以用下面的 JavaScript 代码：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">isOverflow</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">element</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> element<span class=\"token punctuation\">.</span>scrollWidth <span class=\"token operator\">!==</span> element<span class=\"token punctuation\">.</span>clientWidth<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>根据 <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Element/scrollWidth\">MDN</a> 的介绍，<code class=\"language-text\">scrollWidth</code> 是一个制度元素，其值等于该元素实际的宽度（包含了元素因为 <code class=\"language-text\">overflow</code> 没有展示出来的部分）；而于此相对的，<code class=\"language-text\">clientWidth</code> 是元素实际展示的宽度。注，对行内元素和没有 CSS 的元素来说，<code class=\"language-text\">clientWidth</code> 是 0，具体见 <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Element/clientWidth\">MDN</a>。针对判断是否出 <code class=\"language-text\">...</code> 的情况，这里不需要考虑 <code class=\"language-text\">clientWidth</code> 的特殊情况。因为 <code class=\"language-text\">scrollWidth</code> 实际给出的值包含了被隐去的部分，因而当 <code class=\"language-text\">scrollWidth</code> 和 <code class=\"language-text\">clientWidth</code> 不想等的时候，就可以认定当前有部分内容被隐去了，因而 <code class=\"language-text\">...</code> 也出现了。</p>","frontmatter":{"date":"2019-06-21","title":"Detect Overflow","category":"JavaScript"}}},{"node":{"id":"7af47dbb-98f2-5ad0-83e2-9fff13e3fec2","html":"<p>在 TypeScript 中，常常存在一个对象可能是 <code class=\"language-text\">undefined</code> 或 <code class=\"language-text\">null</code> 的情况。如果试图直接使用这样的对象，很可能会造成 TypeScript 的报错（在 <code class=\"language-text\">--strictNullChecks</code> 开启的情况下）。这本身是一个正确的行为，也可以在编译时帮助开发者避免一些不必要的错误。</p>\n<p>然而，在实际的开发中，不免遇到这样的情况：在某些特定的生命周期中，开发者可以很明确的知道某一个值不会是 <code class=\"language-text\">undefined</code> 或者 <code class=\"language-text\">null</code>。然而，这样的前置条件 TypeScript 本身并不知情。此时，为了防止 TypeScript 报错，就需要通过某些显式的方法，声明这一情况。</p>\n<p>最常见的方案，是通过 <code class=\"language-text\">as</code> 来强制类型转化。比如：</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">function</span> <span class=\"token function\">throwIfUndefined</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">input<span class=\"token punctuation\">:</span> <span class=\"token builtin\">any</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> input <span class=\"token operator\">===</span> <span class=\"token string\">'undefined'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Undefined!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">handler</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">optional<span class=\"token operator\">?</span><span class=\"token punctuation\">:</span> <span class=\"token builtin\">string</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">throwIfUndefined</span><span class=\"token punctuation\">(</span>optional<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>optional <span class=\"token keyword\">as</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>TypeScript 提供了一个 Non-null assertion 运算符：<code class=\"language-text\">!.</code>，就是用于上述情景的。具体来说：</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">function</span> <span class=\"token function\">handler</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">optional<span class=\"token operator\">?</span><span class=\"token punctuation\">:</span> <span class=\"token builtin\">string</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">throwIfUndefined</span><span class=\"token punctuation\">(</span>optional<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>optional<span class=\"token operator\">!</span><span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>上面这样写之后，TypeScript 就不会报错了。<code class=\"language-text\">optional</code> 被认为一定是非 <code class=\"language-text\">undefined</code> 或 <code class=\"language-text\">null</code> 类型的。（至于 TypeScript 会认为这个变量是什么类型的，就要看这个变量除了 <code class=\"language-text\">undefined | null</code> 的类型之外，还可能是什么类型的了）</p>\n<p>当然，不难看出，这个运算符只是一个编译时帮助编译器理解类型用的辅助手段，本身并不是一个语法糖。因此，在 TypeScript 转化成 JavaScript 的过程中，这里的运算符会直接被去掉。<code class=\"language-text\">optional!.length</code> 生成的就是 <code class=\"language-text\">optional.length</code>，没有生成任何额外的东西。</p>","frontmatter":{"date":"2019-06-20","title":"TypeScript Non-null Assertion","category":"TypeScript"}}},{"node":{"id":"76b4970a-3a72-54b4-a5ac-d4aa0700717f","html":"<p><code class=\"language-text\">Record</code> 是 TypeScript 中一个很实用的范型类型。它需要两个具体的参数类型，<code class=\"language-text\">Record&lt;K, V&gt;</code>，用于指定一个对象的类型。其中，对象的所有 key 都是 <code class=\"language-text\">K</code> 类型的，而这些 key 对应的值则都是 <code class=\"language-text\">V</code> 类型的。如果不使用 <code class=\"language-text\">Record</code> 类型，可能需要用如下的方法来达到同等的效果：</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">type</span> RecordExample <span class=\"token operator\">=</span> Record<span class=\"token operator\">&lt;</span><span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">number</span><span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">interface</span> <span class=\"token class-name\">EquivalentExample</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>显然，等价的写法更为的复杂，看起来也不那么清晰。</p>\n<p>当然，对于 JavaScript 来说，对象的属性其实只能是 <code class=\"language-text\">string</code> 类型的。虽然有时候也会直接使用 <code class=\"language-text\">number</code> 作为值（TypeScript 里面也可以专门这么来做类型强制），但是其实在用作 key 的时候，会经过一步 toString 的转化。比如：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> obj <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> key<span class=\"token punctuation\">:</span> <span class=\"token string\">'value'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> key <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> <span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> <span class=\"token string\">'key'</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// output: value</span></code></pre></div>\n<p>这么看起来，<code class=\"language-text\">Record</code> 的应用场景似乎非常有限，只有 <code class=\"language-text\">Record&lt;string, xxx&gt;</code> 或者 <code class=\"language-text\">Record&lt;number, xxx&gt;</code> 两种可能性。然而，TypeScript 中除了可以使用一些泛用的类型之外，也可以对类型做更进一步的限定。比如，指定类型只能是 <code class=\"language-text\">&#39;apple&#39; | &#39;banana&#39; | &#39;orange&#39;</code>。如此一来，<code class=\"language-text\">Record</code> 就有了更多的应用场景。</p>\n<p>举例来说，如果希望写一个函数，可以将参数对象中所有的值都转化成对应的数字，就可以这么写：</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">type</span> Input <span class=\"token operator\">=</span> Record<span class=\"token operator\">&lt;</span><span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">string</span><span class=\"token operator\">></span>\n<span class=\"token keyword\">function</span> transform<span class=\"token operator\">&lt;</span><span class=\"token constant\">T</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Input</span><span class=\"token operator\">></span><span class=\"token punctuation\">(</span>input<span class=\"token punctuation\">:</span> <span class=\"token constant\">T</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> Record<span class=\"token operator\">&lt;</span><span class=\"token keyword\">keyof</span> <span class=\"token constant\">T</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">number</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> keys<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">keyof</span> <span class=\"token constant\">T</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span>input<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> keys<span class=\"token punctuation\">.</span><span class=\"token function\">reduce</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">acc<span class=\"token punctuation\">,</span> key</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    acc<span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token operator\">+</span>input<span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> acc<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span> <span class=\"token keyword\">as</span> Record<span class=\"token operator\">&lt;</span><span class=\"token keyword\">keyof</span> <span class=\"token constant\">T</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">number</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>这样，就可以保证输入和输出的对象，有相同的 key。</p>","frontmatter":{"date":"2019-06-19","title":"Record in TypeScript","category":"TypeScript"}}},{"node":{"id":"4fe8f16e-9662-54c0-b9b6-ebb5d07592cc","html":"<p><code class=\"language-text\">ssh</code> 自带跳板机功能：<code class=\"language-text\">-J</code>。示例代码如下：</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">ssh</span> -J userA@a.xxx.com userB@b.xxx.com</code></pre></div>\n<p>命令会需要依次输入 a.xxx.com 和 b.xxx.com 两台机器的登陆信息。校验通过之后，就会登陆 b.xxx.com 这台机器，登陆的用户是 userB。并且，登陆是通过 a.xxx.com 这台机器的 userA 完成的。a.xxx.com 在这里就是一个跳板机的功能。</p>\n<p><a href=\"https://github.com/hardenedlinux/Debian-GNU-Linux-Profiles/blob/master/docs/ssh_and_cluster/powerful-ssh-options-you-dont-know.md\">参考文档</a></p>","frontmatter":{"date":"2019-06-18","title":"SSH ProxyJump","category":"Bash"}}},{"node":{"id":"64057483-960f-55c2-9a47-511df964882f","html":"<p>使用 JavaScript 库 <a href=\"https://www.npmjs.com/package/jszip\">jszip</a> 可以对传入的本地 zip 包进行解压缩并读取其中的文件。</p>\n<p>一段参考代码如下：</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">const</span> filename <span class=\"token operator\">=</span> <span class=\"token string\">'example.txt'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">onDrop</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">event<span class=\"token punctuation\">:</span> DragEvent<span class=\"token operator\">&lt;</span>HTMLDivElement<span class=\"token operator\">></span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> file<span class=\"token punctuation\">:</span> File <span class=\"token operator\">=</span> event<span class=\"token punctuation\">.</span>dataTransfer<span class=\"token punctuation\">.</span>files<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> zip <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> jszip<span class=\"token punctuation\">.</span><span class=\"token function\">loadAsync</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> content <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> zip<span class=\"token punctuation\">.</span>files<span class=\"token punctuation\">[</span>filename<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">async</span><span class=\"token punctuation\">(</span><span class=\"token string\">'text'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'content of example.txt: '</span><span class=\"token punctuation\">,</span> content<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>这里，<code class=\"language-text\">loadAsync</code> 函数接受的参数是一个 <code class=\"language-text\">Blob</code>，而无论是 <code class=\"language-text\">input[type=file]</code> 还是通过 drag-n-drop 得到的文件（<code class=\"language-text\">File</code>），都是一种特殊的 <code class=\"language-text\">Blob</code>，因而可以直接传递给 <code class=\"language-text\">loadAsync</code> 使用。</p>\n<p><code class=\"language-text\">.async(&#39;text&#39;)</code> 可以将结果异步转化成字符串。API 也支持其他的格式类型，比如 ArrayBuffer 等。（<a href=\"https://stuk.github.io/jszip/documentation/api_zipobject/async.html\">文档</a>）</p>\n<p>除了读取内容之外，jszip 也支持创建修改 zip 包的内容。完整的 API 文档可以参考<a href=\"https://stuk.github.io/jszip/documentation/api_jszip.html\">这里</a>。</p>","frontmatter":{"date":"2019-06-17","title":"Unzip using JavaScript","category":"JavaScript"}}},{"node":{"id":"2dfbdd79-0774-5256-a7e3-b9b58d4434b6","html":"<p>react-router 底层使用了 history 库来处理路由。一般有两种选择，一种是使用 <code class=\"language-text\">BrowserHistory</code>（背后的实现依赖了 History API），一种是使用 <code class=\"language-text\">HashHistory</code>（背后的实现主要依赖 <code class=\"language-text\">window.location.hash</code>）。</p>\n<p>如果尝试在 HashHistory 上调用 <code class=\"language-text\">push</code> API 并传递 state 参数：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> history <span class=\"token operator\">=</span> <span class=\"token function\">HashHistory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nhistory<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token string\">'path'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> state<span class=\"token punctuation\">:</span> <span class=\"token string\">'value'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>会在 console 看到如下的报错，并且 state 并没有传递成功：</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Hash history cannot push state; it is ignored</code></pre></div>\n<p>这个是 history 库的默认行为，具体的代码可以参考 <code class=\"language-text\">modules/createHashHistory.js</code> 中 <code class=\"language-text\">push</code> 的代码：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">path<span class=\"token punctuation\">,</span> state</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">warning</span><span class=\"token punctuation\">(</span>\n    state <span class=\"token operator\">===</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'Hash history cannot push state; it is ignored'</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> action <span class=\"token operator\">=</span> <span class=\"token string\">'PUSH'</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> location <span class=\"token operator\">=</span> <span class=\"token function\">createLocation</span><span class=\"token punctuation\">(</span>\n    path<span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">,</span>\n    history<span class=\"token punctuation\">.</span>location\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// ...</span></code></pre></div>\n<p>上面的代码可以看到，如果传递了第二个参数 state，那么就会输出报错。同时，在 createLocation 函数调用的时候，第二个参数本来应该是 state，这里显式地写成了 <code class=\"language-text\">undefined</code>，明确拒绝了传递 state 的做法。</p>\n<p>然而，这并不意味着就完全不能传递 <code class=\"language-text\">state</code> 了。</p>\n<p>事实上，<code class=\"language-text\">push</code> 函数有两种 API 可供选择，一种是 path 是字符串，然后 state 作为第二个参数传递；另一种则第一个参数就是一个对象，其中一个属性就是 state。</p>\n<p>如果使用下面的方法调用，state 就可以在 react-router 中被传递了：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">hashHistory<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> path<span class=\"token punctuation\">:</span> <span class=\"token string\">'path'</span><span class=\"token punctuation\">,</span> state<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> state<span class=\"token punctuation\">:</span> <span class=\"token string\">'value'</span> <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>但是，需要指出的是。这个只是 <code class=\"language-text\">state</code> 被<strong>传递</strong>了，并不代表 <code class=\"language-text\">state</code> 真的被存储了下来。事实上，HashHistory 并没有依赖浏览器的 History API 功能。因此，这里的 <code class=\"language-text\">state</code> 传递之后，会出现在 <code class=\"language-text\">history.location.state</code> 中，但是在浏览器前进/后退的操作中，数据会被丢弃，无法找到。</p>\n<p>一个简单的例子是：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> h <span class=\"token operator\">=</span> <span class=\"token function\">createHashHistory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nh<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">location</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>location<span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nh<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> pathname<span class=\"token punctuation\">:</span> <span class=\"token string\">'a'</span><span class=\"token punctuation\">,</span> state<span class=\"token punctuation\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// output: 1</span>\nh<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> pathname<span class=\"token punctuation\">:</span> <span class=\"token string\">'b'</span><span class=\"token punctuation\">,</span> state<span class=\"token punctuation\">:</span> <span class=\"token number\">2</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// output: 2</span>\nh<span class=\"token punctuation\">.</span><span class=\"token function\">goBack</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// output: undefined</span>\nh<span class=\"token punctuation\">.</span><span class=\"token function\">goForward</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// output: undefined</span></code></pre></div>\n<p>如果将 HashHistory 改成 BrowserHistory，则可以正确输出：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> h <span class=\"token operator\">=</span> <span class=\"token function\">createBrowserHistory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nh<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">location</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>location<span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nh<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> pathname<span class=\"token punctuation\">:</span> <span class=\"token string\">'a'</span><span class=\"token punctuation\">,</span> state<span class=\"token punctuation\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// output: 1</span>\nh<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> pathname<span class=\"token punctuation\">:</span> <span class=\"token string\">'b'</span><span class=\"token punctuation\">,</span> state<span class=\"token punctuation\">:</span> <span class=\"token number\">2</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// output: 2</span>\nh<span class=\"token punctuation\">.</span><span class=\"token function\">goBack</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// output: 1</span>\nh<span class=\"token punctuation\">.</span><span class=\"token function\">goForward</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// output: 2</span></code></pre></div>","frontmatter":{"date":"2019-06-16","title":"HashHistory & State","category":"JavaScript"}}},{"node":{"id":"8e361e16-3729-59e9-b133-dc50498a2a39","html":"<p><code class=\"language-text\">Command-Shift-4</code> 可以截取部分屏幕。截取之后的结果会保存到桌面。</p>\n<section><h2>一些技巧</h2><p>在点击 <code class=\"language-text\">Command-Shift-4</code> 之后，如果单击 <code class=\"language-text\">Space</code>，会转化成对某一个窗口进行截屏（再次点击 <code class=\"language-text\">Space</code> 可以切换回部分屏幕截取模式）。</p><p>保存后的结果，会短暂的以预览图的形式出现在屏幕的右下角。和 iPhone 上的操作类似，点击这个预览图，可以打开截图并进行图片的修改操作，比如增加一些提示性的标识。</p><p>注：在进行上述修改的时候，如果点击右上角的垃圾桶按钮，就不会将最终结果保存；如果点击右上角的关闭按钮，则是会保存的。</p><p>另外，在截取的时候，按住 <code class=\"language-text\">Option</code> 可以按比例缩放选取的范围；按住 <code class=\"language-text\">Shift</code> 则可以固定上下或左右方向，只在一个轴上选取截取区域。</p><p>如果不希望保存到本地桌面，可以使用 <code class=\"language-text\">Command-Control-Shift-4</code>。截取后的结果会存放到剪贴板中。保存到剪贴板的这个操作，是不会在右下角生成预览图的，因而也不能直接对截屏结果进行二次操作。</p></section>\n<section><h2>其他相关操作</h2><ul>\n<li><code class=\"language-text\">Command-Shift-3</code> 截取当前整个屏幕，并保存到本地</li>\n<li><code class=\"language-text\">Command-Control-Shift-3</code> 截取当前整个屏幕，并保存到剪贴板中</li>\n</ul></section>\n<section><h2>修改默认配置</h2><p>默认情况下，截图是保存到桌面的。可以执行以下的命令行改变这个默认行为：</p><div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">defaults <span class=\"token function\">write</span> com.apple.screencapture location ~/Pictures/\n<span class=\"token function\">killall</span> SystemUIServer</code></pre></div><p>其中第一行是将默认地址改到 <code class=\"language-text\">Pictures</code> 下面；第二行则是让配置当即生效。注：需要确保保存到的位置是存在的，如果不存在，最终保存的结果还是会放到桌面下。</p><p>同时，默认保存的图片格式是 <code class=\"language-text\">.png</code>，也可以通过下面的方式改成 <code class=\"language-text\">.jpg</code> 或其图片格式：</p><div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">defaults <span class=\"token function\">write</span> com.apple.screencapture <span class=\"token function\">type</span> jpg\n<span class=\"token function\">killall</span> SystemUIServer</code></pre></div><p>取决于屏幕显示的内容类型，有时候 <code class=\"language-text\">.jpg</code> 的结果会比 <code class=\"language-text\">.png</code> 更小。</p></section>","frontmatter":{"date":"2019-06-13","title":"Capture Screen Shot with Mac OS","category":"MacOS"}}},{"node":{"id":"e29947ad-7b7e-5f6b-8fbd-7e5b832e5e67","html":"<p><a href=\"https://gist.github.com/jed/982883\">这里</a>有一段生成 UUID v4 非常短小的 JavaScript 代码。虽然有一些注释，但总体上并不是非常的好理解。</p>\n<p>首先，用 TypeScript 翻译一遍原始的代码：</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">const</span> slot <span class=\"token operator\">=</span> <span class=\"token string\">'10000000-1000-4000-8000-100000000000'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">rand</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token keyword\">from</span><span class=\"token punctuation\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">,</span> to<span class=\"token punctuation\">:</span> <span class=\"token builtin\">number</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span>to <span class=\"token operator\">-</span> <span class=\"token keyword\">from</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token keyword\">from</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">getRandomChar</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">input<span class=\"token punctuation\">:</span> <span class=\"token builtin\">number</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> seed <span class=\"token operator\">=</span> input <span class=\"token operator\">===</span> <span class=\"token number\">8</span> <span class=\"token operator\">?</span> <span class=\"token function\">rand</span><span class=\"token punctuation\">(</span><span class=\"token number\">8</span><span class=\"token punctuation\">,</span> <span class=\"token number\">11</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> <span class=\"token function\">rand</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">15</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> seed<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token number\">16</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">uuidReplacer</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">char<span class=\"token punctuation\">:</span> <span class=\"token builtin\">string</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token function\">getRandomChar</span><span class=\"token punctuation\">(</span><span class=\"token operator\">+</span>char<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">uuid</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> slot<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\">/[018]/g</span><span class=\"token punctuation\">,</span> uuidReplacer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>接下来对原始的代码中的部分做一些解释：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">a <span class=\"token operator\">^</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">16</span> <span class=\"token operator\">>></span> a<span class=\"token operator\">/</span><span class=\"token number\">4</span></code></pre></div>\n<p>这个部分的代码不太好理解。首先，先根据运算符的<a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Operator_Precedence\">优先级</a>，给上面这个算式加上帮助理解的括号：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">a <span class=\"token operator\">^</span> <span class=\"token punctuation\">(</span> <span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">16</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">>></span> <span class=\"token punctuation\">(</span>a <span class=\"token operator\">/</span> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span></code></pre></div>\n<p>接下来，再来看每个部分都是什么意思：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">16</span></code></pre></div>\n<p>创建了一个 <code class=\"language-text\">0~16</code> 范围内的随机数，<code class=\"language-text\">&gt;&gt; (a / 4)</code> 这个运算之后，会得到几种不同的结果（注意，这里 <code class=\"language-text\">a</code> 只可能是 <code class=\"language-text\">&#39;0&#39;</code>，<code class=\"language-text\">&#39;1&#39;</code>，<code class=\"language-text\">&#39;8&#39;</code> 三种情况）：</p>\n<ul>\n<li><code class=\"language-text\">&#39;0&#39;</code> 或 <code class=\"language-text\">&#39;1&#39;</code> 的时候，结果是 <code class=\"language-text\">0~15</code> 的随机数（整数）</li>\n<li><code class=\"language-text\">&#39;8&#39;</code> 的时候，等价于 <code class=\"language-text\">&gt;&gt; 2</code>，所以结果是一个 <code class=\"language-text\">0~3</code> 的随机数（整数）</li>\n</ul>\n<p>最后一步异或运算 <code class=\"language-text\">^</code>，得到的可能结果分别是：</p>\n<ul>\n<li><code class=\"language-text\">&#39;0&#39;</code> 的时候，异或结果不变，是 <code class=\"language-text\">0~15</code> 的随机数（整数）</li>\n<li><code class=\"language-text\">&#39;1&#39;</code> 的时候，异或结果最后一个比特位的值正好相反，最终的结果仍然是 <code class=\"language-text\">0~15</code> 的随机数（整数）</li>\n<li><code class=\"language-text\">&#39;8&#39;</code> 的时候，最终结果是 <code class=\"language-text\">8~11</code> 的随机数（整数）。因为 <code class=\"language-text\">8</code> 的第四位二进制是 <code class=\"language-text\">1</code> 其他都是 <code class=\"language-text\">0</code>，而 <code class=\"language-text\">0~3</code> 这几个数的二进制位数不超过两位，所以位数之间不存在交集，异或运算相当于是 <code class=\"language-text\">8 + n</code>，<code class=\"language-text\">n</code> 是 <code class=\"language-text\">0~3</code> 中的某一个数。最终得到的就是 <code class=\"language-text\">8~11</code> 的随机数（整数）。</li>\n</ul>\n<p>最终，将生成的不超过 16 的整数转化成十六进制的对应字符。</p>\n<p>第二部分的代码用到了正则匹配和替换（注意，这里 <code class=\"language-text\">&#39;4&#39;</code> 没有被替换，依然保留），主要不容易理解的是下面这个部分：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token punctuation\">[</span><span class=\"token number\">1e7</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">+</span> <span class=\"token operator\">-</span><span class=\"token number\">1e3</span> <span class=\"token operator\">+</span> <span class=\"token operator\">-</span><span class=\"token number\">4e3</span> <span class=\"token operator\">+</span> <span class=\"token operator\">-</span><span class=\"token number\">8e3</span> <span class=\"token operator\">+</span> <span class=\"token operator\">-</span><span class=\"token number\">1e11</span>    </code></pre></div>\n<p>这里用到了 JavaScript 比较奇怪的类型转化功能。因为最开始是一个数组，所以这里的相加实际上是字符串的拼接。等价于 <code class=\"language-text\">&#39;10000000-1000-4000-8000-100000000000&#39;</code> 这个字符串。上面这样写主要是字符数上比较少。</p>","frontmatter":{"date":"2019-06-12","title":"Generate v4 UUID","category":"JavaScript"}}},{"node":{"id":"a5786b23-a33c-5ec4-8045-1b5072ed598a","html":"<p>当用 JavaScript 去访问 HTML 中的元素的时候，实际访问到的是 DOM 元素。比如，访问 <code class=\"language-text\">div</code> 元素，实际拿到的是 <code class=\"language-text\">HTMLDivElement</code>；访问 <code class=\"language-text\">span</code> 元素，实际拿到的是 <code class=\"language-text\">HTMLSpanElement</code>。</p>\n<p>大多数情况下，不同的 HTML 元素有不同的 DOM interface 对应，因为不同的元素很可能有一些行为/属性上的不同。</p>\n<p>但是也存在一些 HTML 元素，并没有特定的 DOM interface 对应，直接使用了 HTMLElement 这个基类。常见的例子有 <code class=\"language-text\">i</code>，<code class=\"language-text\">b</code> 或者 <code class=\"language-text\">ruby</code> 等。</p>\n<p>注：根据 <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTML/Element/i\">MDN</a> 的说明，Firefox 中 <code class=\"language-text\">i</code> 对应的 DOM 是 <code class=\"language-text\">HTMLSpanElement</code>。但实际测试下来，最新版本的 Firefox 实现和标准是一致的，使用的 DOM interface 是 <code class=\"language-text\">HTMLElement</code> 而不是 <code class=\"language-text\">HTMLSpanElement</code>。</p>\n<p>可以用下面的方法简单的查看具体使用的是哪一个 DOM interface：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// should be: HTMLElement</span>\ndocument<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'i'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>constructor<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// should be: HTMLSpanElement</span>\ndocument<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'span'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>constructor<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">;</span></code></pre></div>","frontmatter":{"date":"2019-06-11","title":"DOM Interface","category":"HTML"}}},{"node":{"id":"de6d0e6a-fdca-5e8e-9624-3c7269632aac","html":"<p>HTML 中的 <code class=\"language-text\">input</code> 组件，如果设置成 <code class=\"language-text\">type=file</code>，就可以变成一个文件选择控件。</p>\n<p>默认情况下，系统默认打开的这个文件选择框，可以接受任意的文件选择。如果需要指定可以选择的文件类型，可以使用 <code class=\"language-text\">accept</code> 参数：</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span>file</span> <span class=\"token attr-name\">accept</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>image/x-png,image/gif,image/jpeg<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span></code></pre></div>\n<p>上面这个例子中，浏览器将会只接受 png / gif 或 jpg 的输入。</p>\n<p>也可以写:</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span>file</span> <span class=\"token attr-name\">accept</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>image/*<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span></code></pre></div>\n<p>以支持任意类型的图片格式输入。同理，类似的比如 <code class=\"language-text\">video/*</code> 将会只接受任意类型的视频；<code class=\"language-text\">audio/*</code> 将会只接受任意类型的音频文件。</p>\n<p>除了指定 <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types\">MIME</a> 类型之外，也可以指定后缀。比如：</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span>file</span> <span class=\"token attr-name\">accept</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>.pdf,.doc,.docx<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span></code></pre></div>\n<p>将会只允许以 pdf / doc / docx 这三种名称作为后缀的文件被选择。</p>\n<p>各个浏览器的支持情况可以看<a href=\"http://caniuse.com/#feat=input-file-accept\">这里</a>。</p>\n<p>（当然，这个只是前端的一个校验，后端依然需要重新对前端给的输入进行检查才行）</p>","frontmatter":{"date":"2019-06-10","title":"Read certain type of files","category":"HTML"}}},{"node":{"id":"f250e3dd-829b-5367-86cc-6b466b4a73af","html":"<p>由于系统的差异，不同的电脑上存在的字体是不一样的。为了网站的效果可以兼顾各个设备，一般在写 CSS 的时候，<code class=\"language-text\">font-family</code> 总是很长的一串。通过字体 fallback 的功能，让浏览器自行选择最先能匹配到的字体文件，从而保证显示的效果大体上接近于视觉效果图。在实际书写中，有一个值得注意的细节：<strong>英文字体应该在中文字体的前面</strong>。</p>\n<p>中文字体文件往往包含英文字符，但是这些英文字符的样式很可能并不是设计师希望看到的。如果中文字体展示在英文字体的前面，英文字体就没法被使用到，导致最终的效果略有偏差。下面展示了中文字体 PingFang SC 和苹果默认英文系统字体（SF NS Display）针对英文字母的渲染效果（需要在 MacOS 下查看）：</p>\n<style>\n.pingfang-sc {\n  font-family: 'PingFang SC';\n  font-size: 3em;\n}\n.default-font {\n  font-family: -apple-system, BlinkMacSystemFont;\n  font-size: 3em;\n}\n</style>\n<p><span class=\"pingfang-sc\">ffi</span></p>\n<p><span class=\"default-font\">ffi</span></p>\n<p>所以，应该写：</p>\n<div class=\"gatsby-highlight\" data-language=\"css\"><pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">.example</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">font-family</span><span class=\"token punctuation\">:</span>\n    -apple-system<span class=\"token punctuation\">,</span> BlinkMacSystemFont<span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'Segoe UI'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Helvetica Neue'</span><span class=\"token punctuation\">,</span> Helvetica<span class=\"token punctuation\">,</span> Arial<span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'PingFang SC'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Microsoft YaHei'</span><span class=\"token punctuation\">,</span>\n    sans-serif<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>而不是：</p>\n<div class=\"gatsby-highlight\" data-language=\"css\"><pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">.example</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">font-family</span><span class=\"token punctuation\">:</span>\n    <span class=\"token string\">'PingFang SC'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Microsoft YaHei'</span><span class=\"token punctuation\">,</span>\n    -apple-system<span class=\"token punctuation\">,</span> BlinkMacSystemFont<span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'Segoe UI'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Helvetica Neue'</span><span class=\"token punctuation\">,</span> Helvetica<span class=\"token punctuation\">,</span> Arial<span class=\"token punctuation\">,</span>\n    sans-serif<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>这里，<code class=\"language-text\">-apple-system, BlinkMacSystemFont</code> 针对苹果下的 Safari 和 Chrome 内核调用系统自带字体，对应到的英文字体是 SF (SF NS Display)，中文字体是 PingFang (PingFang SC)。</p>","frontmatter":{"date":"2019-06-05","title":"Order of font-family","category":"CSS"}}},{"node":{"id":"0c3ae05e-8152-547d-a215-f6c934709b88","html":"<p>在 JavaScript 中，如果得到了一串字节（比如 <code class=\"language-text\">Uint8Array</code>），要转化成对应的字符串，就可以用到 <code class=\"language-text\">TextDecoder</code>。简单的使用方法如下：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> decoder <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TextDecoder</span><span class=\"token punctuation\">(</span><span class=\"token string\">'utf-8'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> bytes <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Uint8Array</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n  <span class=\"token number\">104</span><span class=\"token punctuation\">,</span> <span class=\"token number\">101</span><span class=\"token punctuation\">,</span> <span class=\"token number\">108</span><span class=\"token punctuation\">,</span> <span class=\"token number\">108</span><span class=\"token punctuation\">,</span> <span class=\"token number\">111</span><span class=\"token punctuation\">,</span> <span class=\"token number\">32</span><span class=\"token punctuation\">,</span> <span class=\"token number\">119</span><span class=\"token punctuation\">,</span> <span class=\"token number\">111</span><span class=\"token punctuation\">,</span> <span class=\"token number\">114</span><span class=\"token punctuation\">,</span> <span class=\"token number\">108</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> decoder<span class=\"token punctuation\">.</span><span class=\"token function\">decode</span><span class=\"token punctuation\">(</span>bytes<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// => \"hello world\"</span></code></pre></div>\n<p>当然，上面的这个例子是比较简单的。不使用 <code class=\"language-text\">TextDecoder</code> 也可以直接转化成字符串：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> bytes <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Uint8Array</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n  <span class=\"token number\">104</span><span class=\"token punctuation\">,</span> <span class=\"token number\">101</span><span class=\"token punctuation\">,</span> <span class=\"token number\">108</span><span class=\"token punctuation\">,</span> <span class=\"token number\">108</span><span class=\"token punctuation\">,</span> <span class=\"token number\">111</span><span class=\"token punctuation\">,</span> <span class=\"token number\">32</span><span class=\"token punctuation\">,</span> <span class=\"token number\">119</span><span class=\"token punctuation\">,</span> <span class=\"token number\">111</span><span class=\"token punctuation\">,</span> <span class=\"token number\">114</span><span class=\"token punctuation\">,</span> <span class=\"token number\">108</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> String<span class=\"token punctuation\">.</span><span class=\"token function\">fromCharCode</span><span class=\"token punctuation\">(</span><span class=\"token operator\">...</span>bytes<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// => \"hello world\"</span></code></pre></div>\n<p><code class=\"language-text\">TextDecoder</code> 的主要优势，需要在非 ASCII 码范围内才体现出来。特别是 utf-8 这类变长字符串编码，直接处理比较困难。交给现成的 API 来处理，简单方便。</p>\n<p>参考文档：<a href=\"https://developer.mozilla.org/en-US/docs/Web/API/TextDecoder\">MDN</a></p>","frontmatter":{"date":"2019-06-04","title":"TextDecoder","category":"JavaScript"}}},{"node":{"id":"7e3dc97b-93d3-5067-acb4-ba2d4a1c51b6","html":"<p>一个项目工程里的组件，很可能需要依赖于某些项目顶层定义的 <code class=\"language-text\">Provider</code> 才能正确使用。比如，mobx 的项目可能会在顶层通过 <code class=\"language-text\">mobx-react</code> 中的 <code class=\"language-text\">Provider</code> 提供 <code class=\"language-text\">store</code> 参数。</p>\n<p>如果需要在每一个 story 中都写：</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Provider</span></span> <span class=\"token spread\"><span class=\"token punctuation\">{</span><span class=\"token punctuation\">...</span><span class=\"token attr-value\">info</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n  </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ComponentForThisStory</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Provider</span></span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>显然太啰嗦了。</p>\n<p>storybook 提供了全局定义 decorator 的方法，可以以此来注册一些全局都用得到的改动。举例如下：</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> configure<span class=\"token punctuation\">,</span> addDecorator <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@storybook/react'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Provider <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'mobx-react'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">withProvider</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">story</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Provider</span></span> <span class=\"token spread\"><span class=\"token punctuation\">{</span><span class=\"token punctuation\">...</span><span class=\"token attr-value\">info</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">{</span><span class=\"token function\">story</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Provider</span></span><span class=\"token punctuation\">></span></span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">loadStories</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n  <span class=\"token function\">addDecorator</span><span class=\"token punctuation\">(</span>withProvider<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">configure</span><span class=\"token punctuation\">(</span>loadStories<span class=\"token punctuation\">,</span> module<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>这样，在 story 中，只需要简单的提供组件就可以了，<code class=\"language-text\">decorator</code> 会自动为组件加上合适的外层 <code class=\"language-text\">Provider</code>。</p>\n<p><a href=\"https://alligator.io/react/storybook-with-redux/\">参考文档</a></p>","frontmatter":{"date":"2019-06-03","title":"global Provider for storybook","category":"JavaScript"}}},{"node":{"id":"fc2b5db1-9791-5601-b7d9-a24fedd9376d","html":"<p>Glob 类似于 Regular Expression，主要的使用场景是用于批量的文件匹配，在 bash 或是配置文件中常常被使用。下面列举了一些常见的语法规则：</p>\n<ul>\n<li><code class=\"language-text\">*</code> 匹配任意多个字符（包括匹配零个）</li>\n<li><code class=\"language-text\">?</code> 匹配任意一个字符</li>\n<li><code class=\"language-text\">[abc]</code> 匹配方括号中的任意一个字符</li>\n<li><code class=\"language-text\">[!abc]</code> 或 <code class=\"language-text\">[^abc]</code> 匹配除了方括号中定义的三个字符外的任意字符</li>\n<li><code class=\"language-text\">[a-z]</code> 匹配方括号定义范围内的任意一个字符</li>\n<li><code class=\"language-text\">[!a-z]</code> 或 <code class=\"language-text\">[^a-z]</code> 匹配除了方括号定义范围内的任意一个字符</li>\n<li><code class=\"language-text\">{ab,cd,ef}</code> 匹配花括号中定义的三个字符串中的任意一个</li>\n</ul>\n<p>举个例子，如果 Jest 的单元测试文件命名规范的正则表达式是：<code class=\"language-text\">.+\\.(?:test|spec)\\.[tj]sx?$</code>，也就是匹配下面的这些文件：</p>\n<ul>\n<li>a.test.js</li>\n<li>b.test.jsx</li>\n<li>c.test.ts</li>\n<li>d.test.tsx</li>\n<li>e.spec.js</li>\n<li>f.spec.jsx</li>\n<li>g.spec.ts</li>\n<li>h.spec.tsx</li>\n</ul>\n<p>那么，相应的 Glob 可以写：<code class=\"language-text\">*.{test,spec}.{js,jsx,ts,tsx}</code>。</p>\n<p>如果不涉及到 React 的代码（没有 jsx），可以写成：<code class=\"language-text\">*.{test,spec}.[tj]s</code>。</p>\n<p>参考文档：</p>\n<ul>\n<li><a href=\"https://en.wikipedia.org/wiki/Glob_(programming)\">Wikipedia</a></li>\n<li><a href=\"http://www.jedit.org/users-guide/globs.html\">Glob Patterns</a></li>\n<li><a href=\"http://www.globtester.com/\">globtester</a></li>\n</ul>","frontmatter":{"date":"2019-06-02","title":"glob","category":"Bash"}}}]}},"pageContext":{"isCreatedByStatefulCreatePages":false,"startInMonth":"2019-06-01","endInMonth":"2019-06-31","time":"2019-06","previous":"2019-05","next":"2019-07"}}}
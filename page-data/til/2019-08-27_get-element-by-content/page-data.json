{"componentChunkName":"component---src-templates-til-js","path":"/til/2019-08-27_get-element-by-content","result":{"data":{"markdownRemark":{"id":"2a1226e2-04b0-5235-8aa7-3324e1cb244f","html":"<p>在 Cypress 中可以通过字符串来查找和定位元素，常用的命令包括 <code class=\"language-text\">get</code>，<code class=\"language-text\">find</code> 等。这里以 <code class=\"language-text\">get</code> 命令为例，在其<a href=\"https://docs.cypress.io/api/commands/get.html#Syntax\">文档</a>可以看到一些用法的说明。</p>\n<p>JavaScript 中支持的 selector 在 <code class=\"language-text\">get</code> 中都是可以使用的，除此之外，文档指出所有 jQuery 支持的也同样支持。（事实上，在 Cypress 注册命令的<a href=\"https://github.com/cypress-io/cypress/blob/a038e7f5d4c56d3efa844e745da40a3d917fefea/packages/driver/src/cy/commands/traversals.coffee\">代码</a>处可以，可以找到和 DOM 相关的代码，这部分代码中不难发现 jQuery 的<a href=\"https://github.com/cypress-io/cypress/blob/0e3289debd1323ad7c6b5f11a573685f24d56629/packages/driver/src/dom/jquery.js\">影子</a>）。</p>\n<p>有了 jQuery 的强力支持，就可以写出复杂的选择条件。比如，选取含有某一文案的 HTML 组件。</p>\n<p>在 jQuery 中，提供了 <code class=\"language-text\">:contains</code> 这个选择器（<a href=\"https://api.jquery.com/contains-selector/\">文档</a>），可以找出所有包含某一指定字符串的所有元素。</p>\n<p>于是，想要找出弹出层中的 Submit 按钮，就可以这么写：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">Cypress<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'[role=dialog] button:contains(\"Submit\")'</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>这里，使用了 <code class=\"language-text\">[role=dialog]</code> 来找到弹出层（dialog 相关的介绍可以看 <a href=\"https://developer.mozilla.org/en-US/docs/Web/Accessibility/ARIA/Roles/dialog_role\">MDN</a>），然后再通过 <code class=\"language-text\">button</code> 找到按钮，最后用 <code class=\"language-text\">:contains(&quot;Submit&quot;)</code> 来找到 Submit 按钮。</p>\n<p>当然，如果一个产品本身支持 i18n，那么 <code class=\"language-text\">:contains</code> 后面的部分就不好写了。一个可行的方案，是通过当前页面的语言，从一组文案中找到合适的文案，再调用 <code class=\"language-text\">:contains</code> 选择器。比如，写一个简单的 Cypress 命令，如下：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">Cypress<span class=\"token punctuation\">.</span>Commands<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token string\">'getByText'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">query<span class=\"token punctuation\">,</span> texts</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n  cy<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'html'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">first</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">html</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> lang <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> html<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> cy<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>query<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">:contains('</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>texts<span class=\"token punctuation\">[</span>lang<span class=\"token punctuation\">]</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">')</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>这里，通过 HTML 上的 <code class=\"language-text\">lang</code> 标记来确定当前页面所选用的语言（<code class=\"language-text\">lang</code> 的一些细节可以参考 <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTML/Global_attributes/lang\">MDN</a>），然后再根据语言，从一组文案（即 <code class=\"language-text\">texts</code> 这个对象）中选取当前需要使用的文案。</p>\n<p>命令的使用方法：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">cy<span class=\"token punctuation\">.</span><span class=\"token function\">getByText</span><span class=\"token punctuation\">(</span><span class=\"token string\">'[role=dialog] button'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> en<span class=\"token punctuation\">:</span> <span class=\"token string\">'Submit'</span><span class=\"token punctuation\">,</span> zh<span class=\"token punctuation\">:</span> <span class=\"token string\">'提交'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">first</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">click</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>","frontmatter":{"title":"Get Element by Content","category":"Cypress","date":"2019-08-27"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"time":"2019-08-27","title":"Get Element by Content","previous":{"time":"2019-08-26","title":"Get Yesterday Date in Bash"},"next":{"time":"2019-08-28","title":"Cypress No Internet"}}}}
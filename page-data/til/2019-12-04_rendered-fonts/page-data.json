{"componentChunkName":"component---src-templates-til-js","path":"/til/2019-12-04_rendered-fonts","result":{"data":{"markdownRemark":{"id":"6f7bce64-d072-5ef5-abd7-98cd4c6118b3","html":"<p>要知道一个网页中的文本，具体是使用什么字体渲染出来的，并不是非常简单的事情，可以有以下一些方案进行尝试。</p>\n<section><h2>getComputedStyle</h2><p>使用 <code class=\"language-text\">window.getComputedStyle</code> 属性获取对应元素的 <code class=\"language-text\">font-family</code> 字段。因为字体的设置一般是通过顶层配置，子元素继承的方式完成的，因此在大多数的元素上，并没有 <code class=\"language-text\">font-family</code> 设置。即使有，大概率也是通过 CSS 完成的，因此从 <code class=\"language-text\">.style</code> 或者 <code class=\"language-text\">.attributeStyleMap</code> 无法拿到需要的数据。<code class=\"language-text\">getComputedStyle</code> 可以获取当前元素上样式的最终计算值，因此即使字体实际来自于继承或者系统默认字体，都可以通过该 API 获取到。比如，在一个没有 CSS 设置的页面上，可以通过下面的代码知道具体使用的系统默认字体是什么：</p><div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">window<span class=\"token punctuation\">.</span><span class=\"token function\">getComputedStyle</span><span class=\"token punctuation\">(</span>document<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>fontFamily<span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// MacOS (Chrome): Times</span>\n<span class=\"token comment\">// Windows (Chrome): Microsoft YaHei</span></code></pre></div><p>非编程的方案，可以在 Chrome DevTools 中直接找到 Elements 下的 Computed 部分，查看实际使用的 CSS 属性值。注：如果 <code class=\"language-text\">font-family</code> 并没有被定义过，可以勾选 All 来查看系统默认的属性值。</p><p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2f6b9b41cfadb16613696e96a940262e/cb0d3/2019-12-04-computed-style.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 130.95975232198143%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAaCAYAAAC3g3x9AAAACXBIWXMAABYlAAAWJQFJUiTwAAAD40lEQVRIx5WVi2/aVhjF+Uv336ybFjKSNMnWbR1dq6pb1ocqVVMndWuabqFZIh62IZSHedoY24BtwOAXZ9+9EAYk1VpLB/va3OPfvd/1uTHXddFut1EsFlEqlTAYDKB1VOQlAYW8CLlawXg0Qr3egCSJME0ThmHw84juO47Dxfr1ej3EuIGmodPpoKt1oOs6qi0TUrmNS7mDgtyF0u1B73b5i9lz1rHf73MT27ZhWRZvM8UajQYymQw3VDUDFxkRZ2kJqQsBTdVEvalAlPKQ5Srevy8in5egKHNjBjIcDrnplWKe52E6nXIZtgfN8qDbPp199IYBgsCH7/vwvIX8FVHfTcVw0xF59BMAMx9R4GEW+iRvTez+TUdsNpthKboRei5aJ0mkn+9C/uM79M9+gn6ahJFKwkzdo/M99E7vwkw/5f9f609aErIGh/MnUI73UX71JaTfvoB5tgcnvY/B+W3YF/v82kxtQ0vdX/a76ssJNw1DbwLt7SE0cR9/v72FdOoWikIc8mWC9DUqhV30hD0yfPDxhuqbA7TEBB78voOthwfYe3yA5Mvvcfflj3iR2oOajn+aoXJMhsI2Hh0nkXj2DIknjxA/eoivjh7j+V930ElvoXP6CYbaySEU6TZSmS2c57bwTy6Oc4GJXW+jm91F991HGrKitGnIjkTKf0vnb2CJh1w2XQ8LdzDI7KLzoSGvlnxOOIZGVe4eJ6C/2eHSXieovbNoE92fcRjv7vNlg81ls/mGKAzg6jI8s/afDGrr1YUqXK5Rx2xldNfWYRRFcy3MZ/+jqz7XvhSWGCalx9KQFBIlF33HIZsGpYrw9RHCFz8g/HUX0eefIfplGz49sxZptUwbhxKiT9kW0MceBswoXBd7wdRFaCgI60WEpTSCVz/Dz57AJ1SWlSwfWaTxtDFbLYwokgYUYXa5jAklhjuZzEXhyzWZwvVpbsMILBKafQdCpU5G5iKJVtKmryoY5/MYCgJ8wmeUAZkt6VZpA5ZAEQ9bQZCIyOGFCFZGFtObDViZNCwhB7t4yc+WKGA86GNCGTkhwgm9YLIgZkTliox6o8mJ3JXnTLGBqmIsinzYbqOOMe0rXr/Hq705n0EY8krKtL+0FXW+bjf+E9Mbc8JBLgunViNCAQ7FPadbefMVISteqVzlhIz2ZkJJwpCG6ZIhI+TV3pw/RsjmkA5m1mi2rq8IRmjQTuaQoV0uwcpmiE5em7dNQjZvakdDJieiVKEvx5tuENJuxwgZ3Yh2NZeK9CFCJvbtdnUDWapyrd7kVV4jNInQpqI4NXk5H8v1d4PY7qjTQs4XiqjKNd5eff4vE5Ka/A6hyHoAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"Screenshot of Chrome DevTools > Elements > Computed\"\n        title=\"\"\n        src=\"/static/2f6b9b41cfadb16613696e96a940262e/b9e4f/2019-12-04-computed-style.png\"\n        srcset=\"/static/2f6b9b41cfadb16613696e96a940262e/cf440/2019-12-04-computed-style.png 148w,\n/static/2f6b9b41cfadb16613696e96a940262e/d2d38/2019-12-04-computed-style.png 295w,\n/static/2f6b9b41cfadb16613696e96a940262e/b9e4f/2019-12-04-computed-style.png 590w,\n/static/2f6b9b41cfadb16613696e96a940262e/cb0d3/2019-12-04-computed-style.png 646w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p></section>\n<section><h2>Rendered Fonts</h2><p>使用 <code class=\"language-text\">getComputedStyle</code> 只能得到实际使用的 CSS 属性值，有时候并不能准确表达实际真实使用的具体字体类型。</p><p>举例来说，一个 <code class=\"language-text\">font-family</code> 定义可能是：</p><div class=\"gatsby-highlight\" data-language=\"css\"><pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">body</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">font-family</span><span class=\"token punctuation\">:</span>\n    <span class=\"token string\">'Rubik'</span><span class=\"token punctuation\">,</span>\n    -apple-system<span class=\"token punctuation\">,</span> <span class=\"token string\">'system-ui'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'BlinkMacSystemFont'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'PingFang SC'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'Segoe UI'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Roboto'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Oxygen'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'Ubuntu'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Cantarell'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Fira Sans'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Droid Sans'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'Helvetica Neue'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Helvetica'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Arial'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Hiragino Sans GB'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'Microsoft Yahei'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'WenQuanYi Micro Hei'</span><span class=\"token punctuation\">,</span> sans-serif；\n<span class=\"token punctuation\">}</span></code></pre></div><p>在如此众多的定义中，具体浏览器使用了哪一款字体，并不容易知道。这其中涉及到了大量的变量。用户使用的系统环境、字体下载情况、正在阅读的文字是中文还是英文等，这些都有可能影响到最终浏览器所选用的字体。甚至在不复杂的 <code class=\"language-text\">font-family</code> 设置下，最终的选用字体依然可能并不直观。举例来说，如果设置 CSS 为：<code class=\"language-text\">font-family: system-ui</code>，具体使用的字体并没有从设置的字段中直观的反馈出来。</p><p>Chrome DevTools 提供了一个 Rendered Fonts 功能，可以帮助开发者了解当前真实使用的字体。示意图如下：</p><p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/dc6b98d142218bfc4e588ffbe34ab2d0/26dcc/2019-12-04-rendered-fonts.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 538px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 187.36059479553904%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAlCAYAAABCr8kFAAAACXBIWXMAABYlAAAWJQFJUiTwAAAFB0lEQVRIx51WyW4bRxCdjw5yygfkB5KD7zkFCAIYQbwFgeEttixS3HeJ5HAdchbOvvLlVZMjUbJkC27goXt6ZqpreVXVWhAE2Gw26PV6GI1GGA6H0HUdnh9gZjj4XO/hvN5HpdHHYLyC4/pYr1YIwxDyr+d52O12sCxLydGWyyUGgwEmk4l6sd0YuLocot/voUohnaGO+cZFpTnEh/M2qvUWut0uqtUqarUarq6ulKDFYqGEa9vtVmk36PdhmhauZgZqrQEq9S7RRrM7xMa00e92UK9dUFgHrVZLCRSMx2Ol3Ypa+74PLc9zlCPNcpgB4EQH7GLAljks8NAoigJZll3Pmmzu93tCrbAvMs65Whd5gjyLOadI0+QWkkSQqn9Ph3YQdtiUE1zXw2K1wehqBj/kT+keYZwjIuK0QJwckGYFgxJSeIobpfY3GsoQ813XRaf+Bp/fP8V08B/MRQ3bWRXm/AIW1/JsLWswZnX4DEKaZTiVcUug+MG2LTjT59Dbf6BX+R3R6iUK818k65dIN6+QGv8g5+zpTxlEg0oUDwvMRaBlwtFfIfaXGF1ekgFdzGa68qP4MxP/RQ682QtY5gbZ1wQWxZ4UOAiMfAMrw8RkqqM/GMFxdjBJDz+IKNA7CvyGhiJwu93AHL9A6K4YkAxbc0vyjrE2eMB6Ta4FCDybbnnGJFg9wmT60J6+Qp44KsLCzYwRTdJyZoSTEO7s5eNNdvVn2NtvkFsfUNgfkJrvkJnvkXOtYL1FMP/r2yYfaLODMT2DM38He0ZwtvS3CuqZkHfG5D1z36HW+W2Bd4kdhpEyL4i4FsQZCZ4iIGQdHvfjhGSPoq8TW+YojhETScI5KdfJzd7JHFKgcPcLDcsNeVme9BjcNzQpkpZpImLBFB+K2QK1Vs/59b7MYqJAtJYia9ukkOOolBVoATcnrNA+1T+q+mCpuquVPM/nM2bSTNVDg1zVRGrIhT+dIuBJEUuSaCsOP4VYIi5pt9t4/fo1ib7BJQlv2w7Jb1LgmpSzoRlkv91swm2werD6xqy6ydGkU0gQZEi1/vvZc3S6fZWWko4GW4BkkgjXXPYRj/0jYAvwW01E1DSnQIFoJH4rISa6no/Fco2pPlN7KsongdWkg1ntFmz2ix2ri/nxI6xKBTtqGx5NLRHHkTKt0WxTwx5anS4Lx1AV5fIbRZuc2ZFRdcGpw++jSRwnLBKG4ut932oBfebQ0Q59s2P3c6Wdsk0GrMaioVCj7MHiS302R6PVVi2z3C+/EWgZfeV3OtidfYLXaChfevUaYgYr54klL7NjqZ/Pl8rkIs9v8baEllB1f0Q/NBvwhwNWkTmCxRwhfZsKkZPkmsgSgDUPavaGvFn41yQ/hSacC8ijgA0/pBkxT4n4QuGEj2J+HAbYRTHmrRqW0wn34i/4eqg2pXPvOPh2Rz9eCFYT4O2fN1l1ty/jUeP4U+gBv/0MRMGDX2oWk1vYLrMwXa2ZQnJxKqMoDT0MfGS//ICw9g4iLjhG+S60erOFT2fn+Fyp4rxygWa7g8pFDbV6U1Vvhwfs2EeSX39E/OQn2BTmsHE5PFCqjKUUuIEmoV6S/XNexwTS2URbOU0iqa541NhsVeCy38heeSf074m0un1VLuoqjc7Oq7igZv3hSHFMTB9djjEYXmKoL7DZmtiwCMxJLYFJdnzhw/1X6t+jwnUnPbXvLf8PtQHte4Q8BFHqf1USFQCODxGiAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"Screenshot of Chrome DevTools > Elements > Computed > Rendered Fonts\"\n        title=\"\"\n        src=\"/static/dc6b98d142218bfc4e588ffbe34ab2d0/26dcc/2019-12-04-rendered-fonts.png\"\n        srcset=\"/static/dc6b98d142218bfc4e588ffbe34ab2d0/cf440/2019-12-04-rendered-fonts.png 148w,\n/static/dc6b98d142218bfc4e588ffbe34ab2d0/d2d38/2019-12-04-rendered-fonts.png 295w,\n/static/dc6b98d142218bfc4e588ffbe34ab2d0/26dcc/2019-12-04-rendered-fonts.png 538w\"\n        sizes=\"(max-width: 538px) 100vw, 538px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p><p>Chrome 会将当前选中元素真实使用的所有字体都列出来。需要注意两点：</p><ol>\n<li>需要选中一个有文字内容的元素，不然这里并不会显示；</li>\n<li>\n<p>选中的文字内容可能需要多种字体类型共同配合渲染，Chrome 会讲所有用到的元素都列举出来。</p>\n<p>比如，<code class=\"language-text\">笑，😊，smile</code> 这样一段文字，在 MacOS Chrome 下，默认就需要以下三种字体来进行渲染：</p>\n<ul>\n<li>Times（渲染英文）</li>\n<li>Songti SC（渲染中文）</li>\n<li>Apple Color Emoji（渲染 emoji）</li>\n</ul>\n<p>以上三种字体在 Rendered Fonts 中都会被列举出来。</p>\n</li>\n</ol><p>Chrome 的 Blog 介绍可以查看<a href=\"https://developers.google.com/web/updates/2013/09/DevTools-answers-What-font-is-that\">这里</a>。</p><p>这一方案暂时没有 JavaScript API 可以直接调用，无法在程序运行时进行自动的判断。</p></section>","frontmatter":{"title":"Rendered Fonts","category":"Chrome","date":"2019-12-04"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"time":"2019-12-04","title":"Rendered Fonts","previous":{"time":"2019-12-03","title":"Cost of parsing JSON"},"next":{"time":"2019-12-05","title":"Export was Not Found"}}}}